"use strict";var events=require("../../../lib/events.js"),utils=require("../../../lib/utils.js"),dom=require("../../../lib/dom.js"),timeline=require("./timeline.js"),randomTitle=require("../random.title.js"),spritesheetExportApp=new Vue({el:"#spritesheetExportApp",data:{hidden:!0},methods:{show:function(){var s=this;this.hidden=!1,this.$nextTick(function(){s.$el.style.opacity="1",dom.query("#spritesheetExportApp .drag").draggable({restrict:!0,root:s.$el}),dom.query("#spritesheetExportApp .custom-checkbox",!0).on("click",function(e){dom.query(e.target).query(".checkbox").toggleClass("checked")}),dom.query("#spritesheetName").value(randomTitle.generate());var e=timeline.graph.playbackHandle.start.mark+1,t=timeline.graph.playbackHandle.end.mark+1,r=rigModel.bounds,a=r.max.x-r.min.x,i=r.max.y-r.min.y,r=Math.ceil(Math.sqrt(t-e));dom.query("#spritesheetStart").value(e),dom.query("#spritesheetEnd").value(t),dom.query("#spritesheetCellWidth").value(a.toFixed(2)),dom.query("#spritesheetCellHeight").value(i.toFixed(2)),dom.query("#spritesheetRowCount").value(r),setTimeout(function(){document.getElementById("spritesheetName").focus()},100),events.emit("renderSleep")})},hide:function(){this.hidden=!0,events.emit("renderFocus")},validateFormat:function(e){e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e)},validateAmount:function(e){this.validateMin(e),this.validateMax(e)},validateMax:function(e){var t=e.target.value,r=e.target.dataset.max;"spritesheetRowCount"==e.target.id&&(r=1+(parseInt(dom.query("#spritesheetEnd").value())-parseInt(dom.query("#spritesheetStart").value()))),"spritesheetStart"==e.target.id&&(r=parseInt(dom.query("#spritesheetEnd").value())),"spritesheetEnd"==e.target.id&&(r=timeline.app.totalFrames),parseInt(t)>r&&(e.target.value=r.toString())},validateMin:function(e){var t=e.target.value,r=e.target.dataset.min;"spritesheetEnd"==e.target.id&&(r=parseInt(dom.query("#spritesheetStart").value())),parseInt(t)<r&&(e.target.value=r.toString())},toggleAmount:function(e){var t,r;e.target==document.activeElement&&(e.target.value.length||(e.target.value=1),t=e.wheelDeltaY<0,r=parseFloat(e.target.value),t?r--:r++,"spritesheetCellWidth"!=e.target.id&&"spritesheetCellHeight"!=e.target.id||(r=r.toFixed(2)),e.target.value=r.toString(),this.validateAmount(e))},validate:function(){var e=dom.query("#spritesheetName").value(),t=parseInt(dom.query("#spritesheetStart").value()),r=parseInt(dom.query("#spritesheetEnd").value()),a=r-t+1,i=parseFloat(dom.query("#spritesheetCellWidth").value()),s=parseFloat(dom.query("#spritesheetCellHeight").value()),l=parseInt(dom.query("#spritesheetRowCount").value()),o=dom.query("#spritesheetShowSkin").query(".checkbox").hasClass("checked"),n=dom.query("#spritesheetShowBones").query(".checkbox").hasClass("checked"),u=Math.ceil(a/l);events.emit("exportSpritesheet",{name:e.length?e:utils.uid(),start:t,end:r,totalFrames:a,cellWidth:i,cellHeight:s,rows:l,cols:u,showSkin:o,showBones:n})}}});module.exports=spritesheetExportApp;