"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var lastActiveJointId,lastActiveJointSub,selectedKeyframe,keyframeClipboard,clonedeep=require("lodash.clonedeep"),events=require("../../../lib/events.js"),mouse=require("../../../lib/mouse.js"),config=require("../../../lib/config.js"),utils=require("../../../lib/utils.js"),vector=require("../../../lib/vector.js"),rigModel=require("../rig.model.js"),contextMenuApp=require("./contextMenu.js"),history=require("../history.js"),timelineApp=new Vue({el:"#timelineApp",data:{hidden:!1,totalFrames:parseInt(document.getElementById("frameCount").value),animationSpeed:parseInt(document.getElementById("animationSpeed").value),currentFrame:0},methods:{fixData:function(){this.animationSpeed=parseInt(document.getElementById("animationSpeed").value),this.totalFrames=parseInt(document.getElementById("frameCount").value),timeline.hatchMark.spacing=timeline.canvas.width/this.totalFrames,timeline.snap(),timeline.redraw(),timeline.playbackHandle.end.mark>=this.totalFrames&&1!=this.totalFrames&&(timeline.playbackHandle.end.mark=this.totalFrames-1,timeline.playbackHandle.end._x=timeline.markToX(timeline.playbackHandle.end.mark),timeline.redraw());var e={frameCount:this.totalFrames,animationSpeed:this.animationSpeed};localStorage.setItem(config.autosave.label+".frames.config",JSON.stringify(e))},validateFormat:function(e){timeline.redraw(),e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e),this.fixData()},validateAmount:function(e){this.validateMin(e),this.validateMax(e),this.fixData()},validateMax:function(e){var t=e.target.value,a=config.animation.frameCount.max;"animationSpeed"==e.target.id&&(a=config.animation.speed.max),parseInt(t)>a&&(e.target.value=a.toString()),this.fixData()},validateMin:function(e){var t=e.target.value,a=config.animation.frameCount.min;"animationSpeed"==e.target.id&&(a=config.animation.speed.min),parseInt(t)<a&&(e.target.value=a.toString()),this.fixData()},addToHistory:function(){this.totalFrames!=this._previousTotalFrames&&history.add({label:"Change frame count",value:this.totalFrames,group:"input"}),this.animationSpeed!=this._previousAnimationSpeed&&history.add({label:"Change animation speed",value:this.animationSpeed,group:"input"}),this._previousTotalFrames=this.totalFrames,this._previousAnimationSpeed=this.animationSpeed},toggleAmount:function(e){var t,a;e.target==document.activeElement&&(t=e.wheelDeltaY<0,a=parseInt(e.target.value),t?a--:a++,e.target.value=a.toString(),timelineApp.validateAmount(e),this.fixData())},setCurrentFrame:function(e){this.currentFrame=e}}});function getFrames(){for(var e=timelineApp.totalFrames,t=timeline.state.currentMark,a=null,i=parseInt(t);0<=i;i--){var r=rigModel.keyframes[i];if(r&&"head"==r.type){a=r.index;break}}for(var n=null,i=parseInt(t)+1;i<e;i++){var s=rigModel.keyframes[i];if(s&&"head"==s.type){n=s.index;break}}for(var l=null,i=a-1;0<=i;i--){var o=rigModel.keyframes[i];if(o&&"head"==o.type){l=o.index;break}}return{current:a,next:n,previous:l}}function mouseInside(e){if(e=document.getElementById(e.id)){e=e.getBoundingClientRect();return mouse.x>=e.x&&mouse.x<=e.x+e.width&&mouse.y>=e.y&&mouse.y<=e.y+e.height}return!1}timelineApp._previousTotalFrames=timelineApp.totalFrames,timelineApp._previousAnimationSpeed=timelineApp.animationSpeed,timelineApp.$el.addEventListener("focusout",function(){});var Timeline=function(){function e(){var t=this;_classCallCheck(this,e),this.canvas=document.getElementById("timelineGraph"),this.context=this.canvas.getContext("2d"),this.buttons={previous:document.getElementById("lastFrame"),play:document.getElementById("playStop"),next:document.getElementById("nextFrame"),add:document.getElementById("addKeyframe"),delete:document.getElementById("deleteKeyframe"),zoomIn:document.getElementById("zoomInTimeline"),zoomOut:document.getElementById("zoomOutTimeline"),minimize:document.getElementById("minimize"),scrollbar:document.getElementById("timelineScrollbar")},this.state={isPlaying:!1,isDragging:!1,isMinimized:!1,currentMark:0,currentFrame:0,nextFrame:null,previousFrame:null,_x:0},this.hatchMark={spacing:this.canvas.width/timelineApp.totalFrames,height:4},this.scrollbar={},this.playbackHandle={start:{mark:0,_x:0},end:{mark:timelineApp.totalFrames-1,_x:0},width:2,offset:6},this.bounds=this.canvas.getBoundingClientRect(),this.loop=null,this.addButtonEvents(),this.addMouseEvents(),this.addKeyboardEvents(),this.updateSize(),addEventListener("resize",function(){t.updateSize(),t.scrollbar.left=utils.clamp(t.scrollbar.left,0,t.canvas.width-t.scrollbar.minWidth),t.scrollbar.right=utils.clamp(t.scrollbar.right,t.scrollbar.minWidth,t.canvas.width),t.scrollbar.width=t.scrollbar.right-t.scrollbar.left,t.redraw()}),addEventListener("load",function(e){t.updateSize(),t.redraw()}),this.scrollbar={x:0,y:0,width:this.canvas.width,height:void 0,color:config.render.timeline.scrollbar.color.default,left:0,right:this.canvas.width,minWidth:50,zoomSensitivity:10},this._timelineHeight=void 0}return _createClass(e,[{key:"storeSelectedKeyframe",value:function(){for(var e=Object.keys(rigModel.keyframes),t=0;t<e.length;t++){var a=e[t],a=rigModel.keyframes[a];a.index==this.state.currentMark?a.selected=!0:a.selected=!1}}},{key:"markToX",value:function(e,t){var a=utils.map(this.scrollbar.left,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity),i=Math.round(utils.clamp(a-this.hatchMark.spacing/2,0,Number.MAX_SAFE_INTEGER)/this.hatchMark.spacing),a=a%this.hatchMark.spacing,a=(e-i)*this.hatchMark.spacing+this.hatchMark.spacing/2-a;return t?a:utils.clamp(a,this.hatchMark.spacing/2,this.canvas.width-this.hatchMark.spacing/2)}},{key:"xToMark",value:function(e){var t=utils.map(this.scrollbar.left,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity),a=Math.round(utils.clamp(t-this.hatchMark.spacing/2,0,Number.MAX_SAFE_INTEGER)/this.hatchMark.spacing),t=t%this.hatchMark.spacing,a=Math.round((e+t+this.hatchMark.spacing/2)/this.hatchMark.spacing)-1+a;return utils.clamp(a,0,timelineApp.totalFrames-1)}},{key:"addKeyboardEvents",value:function(){var t=this;addEventListener("keydown",function(e){Object.keys(rigModel.keyframes);t.storeSelectedKeyframe(),e.ctrlKey&&(67==e.keyCode&&(rigModel.copiedKeyframe=clonedeep(rigModel.getKeyframe("selected",!0))),86!=e.keyCode||(e=rigModel.copiedKeyframe)&&rigModel.setKeyframe(t.state.currentMark,{position:vector(t.state.currentMark*t.hatchMark.spacing+t.hatchMark.spacing/2,0),locked:0==t.state.currentMark,id:utils.uid(),joints:e.joints}))})}},{key:"addMouseEvents",value:function(){var u=this;this.canvas.addEventListener("contextmenu",function(e){var t,a;mouse.x,u.bounds.x,mouse.y,u.bounds.y;mouseInside(u.canvas)&&(u.storeSelectedKeyframe(),t=mouse.x+contextMenuApp.width>innerWidth?-contextMenuApp.width:0,a=mouse.y+contextMenuApp.height>innerHeight?-contextMenuApp.height:0,contextMenuApp.show(mouse.x+t,mouse.y+a))});var p,g,f,k,v,y,b,x,M,w=!1,H=null,S=0;this.redraw(),addEventListener("mouseup",function(){var e;w=!1,events.emit("renderFocus"),"playbackHandleStart"!=H&&"playbackHandleEnd"!=H||(e={start:u.playbackHandle.start.mark,end:u.playbackHandle.end.mark},localStorage.setItem(config.autosave.label+".playback.config",JSON.stringify(e))),H=null,p&&(e=u.xToMark(u.state._x),u.setCurrentMark(e),rigModel.deleteKeyframe(p.id),rigModel.setKeyframe(e,{position:p.position,joints:p.joints,locked:0==e})),u.scrollbar.color=config.render.timeline.scrollbar.color.default,u.snap(),u.state.isDragging=!1,u.playbackHandle.start.isDragging=!1,u.playbackHandle.end.isDragging=!1,p=null,u.canvas.style.cursor="default",u.redraw()}),addEventListener("mousedown",function(){var e,t,a;mouseInside(u.canvas)&&(w=!0,events.emit("renderSleep"),u.playbackHandle.end.mark>=timelineApp.totalFrames&&1!=timelineApp.totalFrames&&(u.playbackHandle.end.mark=timelineApp.totalFrames-1,u.playbackHandle.end._x=u.markToX(u.playbackHandle.end.mark),u.redraw()),w&&!H&&(k?(S=u.scrollbar.left-g,H="scrollbar"):v?(H="timeline",e=u.markToX(u.playbackHandle.start.mark,!0),t=u.markToX(u.playbackHandle.end.mark,!0),e-(a=u.playbackHandle.width/2+u.playbackHandle.offset/2)<=g&&g<=e+a?H="playbackHandleStart":t-a<=g&&g<=t+a&&(H="playbackHandleEnd")):y&&(H="keyframe")),"timeline"==H&&(u.state.isDragging=!0,u.state._x=utils.clamp(g,u.hatchMark.spacing/2,u.canvas.width-u.hatchMark.spacing/2),0<=(a=u.xToMark(g))&&a<=timelineApp.totalFrames&&u.setCurrentMark(a)),contextMenuApp.hide())}),addEventListener("mousemove",function(){if(g=mouse.x-u.bounds.x,f=mouse.y-u.bounds.y,w||!(f<0||f>u.canvas.height||g<0||g>u.canvas.width)){k=0<=f&&f<=u.scrollbar.height,v=f>=u.scrollbar.height&&f<=u.scrollbar.height+u._timelineHeight,y=f>=u.scrollbar.height+u._timelineHeight&&f<=u.canvas.height;H||(b=g<=u.scrollbar.left+10,x=g>=u.scrollbar.right-10);var e,t=g>=u.scrollbar.left&&g<=u.scrollbar.right&&(b||x)&&k,a=u.markToX(u.playbackHandle.start.mark,!0),i=u.markToX(u.playbackHandle.end.mark,!0),r=u.playbackHandle.width/2+u.playbackHandle.offset/2;if(M=(a-r<=g&&g<=a+r||i-r<=g&&g<=i+r)&&v,u.canvas.style.cursor=t||M?"ew-resize":"default",y)for(var n=Object.keys(rigModel.keyframes),s=0;s<n.length;s++){var l,o,c,h=rigModel.keyframes[n[s]];"head"==h.type&&(l=h.render.position.x,o=h.render.position.y,c=h.render.size,g<=l+c&&l-c<=g&&f<=o+c&&f&&o-c<=f?(h.hovered=!0,h.render.color=config.render.keyframe.color.hovered,u.canvas.style.cursor="pointer"):(h.hovered=!1,h.render.color=config.render.keyframe.color.default),u.redraw())}if(k&&g>=u.scrollbar.left&&g<=u.scrollbar.right?u.scrollbar.color=config.render.timeline.scrollbar.color.hovered:u.scrollbar.color=config.render.timeline.scrollbar.color.default,u.redraw(),w){if("scrollbar"==H&&(b?(u.scrollbar.left=utils.clamp(g,0,u.scrollbar.right-u.scrollbar.minWidth),u.scrollbar.width=u.scrollbar.right-u.scrollbar.left,u.canvas.style.cursor="ew-resize"):x&&(u.scrollbar.right=utils.clamp(g,u.scrollbar.left+u.scrollbar.minWidth,u.canvas.width),u.scrollbar.width=u.scrollbar.right-u.scrollbar.left,u.canvas.style.cursor="ew-resize"),b||x||(u.scrollbar.left=utils.clamp(g+S,0,u.canvas.width-u.scrollbar.width),u.scrollbar.right=u.scrollbar.left+u.scrollbar.width,u.canvas.style.cursor="default"),u.snap()),"timeline"!=H&&"keyframe"!=H||(u.state.isDragging=!0,u.state._x=utils.clamp(g,u.hatchMark.spacing/2,u.canvas.width-u.hatchMark.spacing/2),0<=(t=u.xToMark(g))&&t<=timelineApp.totalFrames&&u.setCurrentMark(t)),"playbackHandleStart"==H&&(u.playbackHandle.start.isDragging=!0,u.playbackHandle.start._x=utils.clamp(g,u.hatchMark.spacing/2,u.playbackHandle.end._x-u.playbackHandle.width/2-u.hatchMark.spacing),e=u.xToMark(g),0<=(e=utils.clamp(e,0,u.playbackHandle.end.mark-1))&&e<=timelineApp.totalFrames&&(u.playbackHandle.start.mark=e),u.canvas.style.cursor="ew-resize"),"playbackHandleEnd"==H&&(u.playbackHandle.end.isDragging=!0,u.playbackHandle.end._x=utils.clamp(g,u.playbackHandle.start._x+u.playbackHandle.width/2+u.hatchMark.spacing,u.canvas.width-u.hatchMark.spacing/2),e=u.xToMark(g),0<=(e=utils.clamp(e,u.playbackHandle.start.mark+1,timelineApp.totalFrames-1))&&e<=timelineApp.totalFrames&&(u.playbackHandle.end.mark=e),u.canvas.style.cursor="ew-resize"),"keyframe"==H)if(p)u.state._x=utils.clamp(g,u.hatchMark.spacing/2,u.canvas.width-u.hatchMark.spacing/2),p.render.position.x=u.state._x,p.dragged=!0,p.render.color=config.render.keyframe.color.active;else for(var d=Object.keys(rigModel.keyframes),s=0;s<d.length;s++){var m=rigModel.keyframes[d[s]];m&&(m.locked||m.hovered&&(p=m))}u.redraw()}}})}},{key:"addButtonEvents",value:function(){var t,i=this;this.buttons.previous.addEventListener("click",function(){var e=0<i.state.currentMark?i.state.currentMark-1:i.state.currentMark;i.setCurrentMark(e)}),this.buttons.next.addEventListener("click",function(){var e=i.state.currentMark<timelineApp.totalFrames-1?i.state.currentMark+1:i.state.currentMark;i.setCurrentMark(e)}),this.buttons.play.addEventListener("click",function(){i.state.isPlaying?i.stop():i.play(),i.redraw()}),this.buttons.add.addEventListener("click",function(){var e,t=rigModel.clone()[i.state.currentMark];t&&(e=t.joints),rigModel.setKeyframe(i.state.currentMark,{locked:0==i.state.currentMark,joints:e})}),this.buttons.delete.addEventListener("click",function(){events.emit("deleteKeyframe")}),this.buttons.zoomIn.addEventListener("mousedown",function(){events.emit("checkMouseHold","zoomIn")}),this.buttons.zoomOut.addEventListener("mousedown",function(){events.emit("checkMouseHold","zoomOut")}),events.on("checkMouseHold",function(e){t=setInterval(function(){mouse.pressed?events.emit("mousehold",e):(clearInterval(t),t=null)},1e3/60)}),events.on("mousehold",function(e){var t,a;"zoomIn"==e?(t=utils.map(i.scrollbar.width,0,i.canvas.width,.1,.001),a=i.markToX(i.state.currentMark,!0),i.scrollbar.left=utils.lerp(i.scrollbar.left,a-i.scrollbar.minWidth/2,t),i.scrollbar.right=utils.lerp(i.scrollbar.right,a+i.scrollbar.minWidth/2,t)):"zoomOut"==e&&(e=utils.map(i.scrollbar.width,0,i.canvas.width,.001,.1),i.scrollbar.left=utils.lerp(i.scrollbar.left,0,e),i.scrollbar.right=utils.lerp(i.scrollbar.right,i.canvas.width,e)),i.scrollbar.width=i.scrollbar.right-i.scrollbar.left,i.snap(),i.redraw()}),this.buttons.minimize.addEventListener("click",function(){i.state.isMinimized?i.maximize():i.minimize()})}},{key:"snap",value:function(){for(var e=Object.keys(rigModel.keyframes),t=0;t<e.length;t++){var a=e[t],i=rigModel.keyframes[a],a=this.markToX(i.index,!0);i.render.position.x=a}this.state._x=this.markToX(this.state.currentMark,!0),this.playbackHandle.start._x=this.markToX(this.playbackHandle.start.mark,!0),this.playbackHandle.end._x=this.markToX(this.playbackHandle.end.mark,!0),this.redraw()}},{key:"updateState",value:function(e){e=void 0===e||e;var t,a=getFrames();this.state.currentFrame=a.current,this.state.nextFrame=a.next,this.state.previousFrame=a.previous,!e||"object"==_typeof(t=(t=rigModel.keyframes[this.state.currentMark])||rigModel.keyframes[this.state.currentFrame])&&(rigModel.joints=t.joints,e=rigModel.joints.find(function(e){return e.id===t.activeJointId}),rigModel.activeJoint=e||rigModel.joints[rigModel.joints.length-1])}},{key:"redraw",value:function(){this.clear(),this.draw()}},{key:"clear",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"draw",value:function(){var e=this.canvas.parentNode;this.canvas.width==e.offsetWidth&&this.canvas.height==e.offsetHeight||(this.canvas.width=e.offsetWidth,this.canvas.height=e.offsetHeight),this.scrollbar.height=.25*this.canvas.height,this._timelineHeight=.4*this.canvas.height;var t=utils.map(this.scrollbar.left,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity),a=this.canvas.width+utils.map(this.scrollbar.width,0,this.canvas.width,this.canvas.width*this.scrollbar.zoomSensitivity,0),i=timelineApp.totalFrames,r="rgba(255, 255, 255, 0.25)",n=5*Math.floor(utils.clamp(timelineApp.totalFrames,a/15,Number.MAX_SAFE_INTEGER)/(a/15)),s=Math.round((t-this.hatchMark.spacing/2)/this.hatchMark.spacing),l=Math.round((utils.map(this.scrollbar.right,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity)-this.hatchMark.spacing/2)/this.hatchMark.spacing),o=this.markToX(this.state.currentMark,!0),o=this.state.isDragging?this.state._x:o,c=this._timelineHeight-this.hatchMark.height,e=this.state.currentMark+1;this.createRect(this.scrollbar.left,this.scrollbar.y,this.scrollbar.right-this.scrollbar.left,this.scrollbar.height-5,this.scrollbar.color,4),this.createRect(0,this.scrollbar.height,this.canvas.width,this._timelineHeight,"rgba(0, 0, 0, 0.15)",4),this.context.save(),this.context.clip(),this.hatchMark.spacing=a/i;for(var h,d,m,u,p=0;p<i;p++)p<s||l<p||(d=this.hatchMark.spacing*p+this.hatchMark.spacing/2-t,m=this.scrollbar.height+this._timelineHeight-this.hatchMark.height-(h=(p+1)%n==0?2:0),u=this.scrollbar.height+this._timelineHeight-m,this.createRect(d-.5,m,1,u,r),h&&(o-5<=d&&d<=o+5||this.text(p+1,d,m-1,r)));this.context.beginPath(),this.context.moveTo(o-5,this.scrollbar.height),this.context.lineTo(o+5,this.scrollbar.height),this.context.lineTo(o+5,this.scrollbar.height+c-5),this.context.lineTo(o,this.scrollbar.height+c),this.context.lineTo(o-5,this.scrollbar.height+c-5),this.context.closePath(),this.context.fillStyle=config.accent,this.context.fill(),this.text(e,o+10,c/2+8+this.scrollbar.height,config.accent,"left");e="rgba(0, 0, 0, 0.15)",c=this.markToX(this.playbackHandle.start.mark,!0),c=this.playbackHandle.start.isDragging?this.playbackHandle.start._x:c;this.createRect(c-this.playbackHandle.width/2,this.scrollbar.height,this.playbackHandle.width,this._timelineHeight,config.accent),this.createRect(0,this.scrollbar.height,c,this._timelineHeight,e);c=this.markToX(this.playbackHandle.end.mark,!0),c=this.playbackHandle.end.isDragging?this.playbackHandle.end._x:c;this.createRect(c-this.playbackHandle.width/2,this.scrollbar.height,this.playbackHandle.width,this._timelineHeight,config.accent),this.createRect(c,this.scrollbar.height,this.canvas.width-c,this._timelineHeight,e),this.context.restore();for(var g=0,f=Object.keys(rigModel.keyframes);g<f.length;g++){var k=f[g],v=rigModel.keyframes[k];v.render.position.y=this.scrollbar.height+this._timelineHeight+v.render.size+5;k=this.markToX(v.index,!0);v.render.position.x=v.dragged?mouse.x-this.bounds.x:k,"head"==v.type&&this.createKeyframe(v.render.position.x,v.render.position.y,v.render.size,v.render.color)}}},{key:"text",value:function(e,t,a,i,r){this.context.beginPath(),this.context.fillStyle=i,this.context.font="12px Catamaran",this.context.textAlign=r||"center",this.context.textBaseline="bottom",this.context.fillText(e,t,a)}},{key:"createRect",value:function(e,t,a,i,r,n){n=n||0,this.context.beginPath(),this.context.moveTo(e+n,t),this.context.lineTo(e+a-n,t),this.context.quadraticCurveTo(e+a,t,e+a,t+n),this.context.lineTo(e+a,t+i-n),this.context.quadraticCurveTo(e+a,t+i,e+a-n,t+i),this.context.lineTo(e+n,t+i),this.context.quadraticCurveTo(e,t+i,e,t+i-n),this.context.lineTo(e,t+n),this.context.quadraticCurveTo(e,t,e+n,t),this.context.closePath(),this.context.fillStyle=r,this.context.fill()}},{key:"createLine",value:function(e,t,a,i,r){this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(a,i),this.context.strokeStyle=r,this.context.stroke()}},{key:"createKeyframe",value:function(e,t,a,i){this.context.beginPath(),this.context.moveTo(e,t-a/2),this.context.lineTo(e+a/2,t),this.context.lineTo(e,t+a/2),this.context.lineTo(e-a/2,t),this.context.closePath(),this.context.fillStyle=i,this.context.fill()}},{key:"setCurrentMark",value:function(e,t){this.state.currentMark=e,timelineApp.setCurrentFrame(this.state.currentMark),this.updateState(t),this.redraw(),events.emit("timelineSeeked")}},{key:"play",value:function(){var t=this;this.loop=setInterval(function(){t.state.currentMark<t.playbackHandle.start.mark&&t.setCurrentMark(t.playbackHandle.start.mark-1);var e=t.state.currentMark<t.playbackHandle.end.mark?t.state.currentMark+1:t.playbackHandle.start.mark;t.setCurrentMark(e)},1e3/timelineApp.animationSpeed),this.state.isPlaying=!0,this.buttons.play.firstChild.src="assets/svg/round-square.svg",document.getElementById("propertyApp").classList.add("disabled")}},{key:"stop",value:function(){clearInterval(this.loop),this.state.isPlaying=!1,this.buttons.play.firstChild.src="assets/svg/play.svg",document.getElementById("propertyApp").classList.remove("disabled"),events.emit("timelineSeeked")}},{key:"updateSize",value:function(){function e(){var e=t.canvas.parentNode.getBoundingClientRect();t.canvas.width=e.width,t.canvas.height=e.height,t.bounds=t.canvas.getBoundingClientRect(),t.redraw()}var t=this;e(),setTimeout(e,100)}},{key:"minimize",value:function(){var e=timelineApp.$el.offsetHeight,t=document.querySelector("#timelineApp div.row-b");timelineApp.$el.style.transform="translateY(".concat(e-t.offsetTop-2,"px)"),this.buttons.minimize.style.transform="translateY(-40px) rotate(0deg)",this.state.isMinimized=!0}},{key:"maximize",value:function(){timelineApp.$el.offsetHeight;timelineApp.$el.style.transform="translateY(".concat(0,"px)"),this.buttons.minimize.style.transform="translateY(-40px) rotate(180deg)",this.state.isMinimized=!1}}]),e}(),timeline=new Timeline;utils.loadJSONData(config.autosave.label+".frames.config",function(e){var t=document.getElementById("frameCount"),a=document.getElementById("animationSpeed");"number"==typeof e.frameCount&&(t.value=e.frameCount),"number"==typeof e.animationSpeed&&(a.value=e.animationSpeed),timelineApp.fixData()}),utils.loadJSONData(config.autosave.label+".playback.config",function(e){"number"==typeof e.start&&(timeline.playbackHandle.start.mark=e.start),"number"==typeof e.end&&(timeline.playbackHandle.end.mark=e.end),timeline.redraw()}),module.exports={app:timelineApp,graph:timeline};