!function(i){var n={};function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=i,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t,i){const n=i(1);var r=!1,i=new class{constructor(){this.emits={},this.listeners=[],this.maxListeners=100}setMaxListeners(e){this.maxListeners=e}removeListener(t,i){let e=this.listeners.find(e=>e[t]===i);if(i||(e=t),e)for(var n=0;n<this.listeners.length;n++)if(this.listeners[n].id===e.id){this.listeners.splice(n,1);break}}emit(e){if(e){let t=[];for(var n=0;n<arguments.length;n++)t.push(arguments[n]);t.shift(),this.emits[e]=t;let i=[];for(n=0;n<this.listeners.length;n++){var r=this.listeners[n];r.name===e&&i.push(r)}for(n=0;n<i.length;n++){let e=i[n];"function"==typeof e.method&&(e.method(...t),e.once&&this.removeListener("id",e.id))}}}on(e,t){if(e&&t&&"function"==typeof t){t={id:n.uid(),name:e,method:t,once:r};return this.listeners.push(t),this.listeners.length>=this.maxListeners&&(this.listeners.shift(),console.warn("Reached the max number of listeners.")),t}}once(e,t){r=!0;t=this.on(e,t);return r=!1,t}};e.exports=i},function(e,t){const r=[];let a=6;e.exports={loadImage:function(e){let r=new Image;return r.crossOrigin="anonymous",r.src=e,new Promise((n,e)=>{r.onload=()=>{const e=document.createElement("canvas"),t=e.getContext("2d");e.width=r.width,e.height=r.height,t.drawImage(r,0,0);var i=e.toDataURL("image/png");n({url:i,width:r.width,height:r.height,image:e})}})},uid:function(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="";function e(){i="";for(var e=0;e<a;e++)i+=t[Math.floor(Math.random()*t.length)]}e();for(var n=performance.now();r.includes(i);)20<performance.now()-n&&a++,e();return r.push(i),i},lerp:function(e,t,i){return i*(t-e)+e},dist:function(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))},map:function(e,t,i,n,r){return(e-t)/(i-t)*(r-n)+n},random:function(){if(2==arguments.length&&"number"==typeof arguments[0]&&"number"==typeof arguments[1])return Math.random()*(arguments[1]-arguments[0])+arguments[0];if(1==arguments.length&&"number"==typeof arguments[0])return Math.random()*arguments[0];if(Array.isArray(arguments[0]))return arguments[0][Math.floor(Math.random()*arguments[0].length)];if(2<arguments.length){var e=[...arguments];return e[Math.floor(Math.random()*e.length)]}},clamp:function(e,t,i){let n=e<t?t:e;return n=n>i?i:n,n},getRandomColor:function(){return this.random(["#ff3b3b","#ff763b","#ffdb3b","#c4ff3b","#76ff3b","#3bff8d","#3bc1ff","#3b48ff","#963bff","#de3bff","#ff3b96"])},loadJSONData:function(i,n){var r=localStorage.getItem(i);if(r){let e,t=!1;try{e=JSON.parse(r)}catch(i){t=!0,console.warn("Couldn't load autosaved data.")}e&&!t&&"function"==typeof n&&n(e)}},degrees:function(e){return e*(180/Math.PI)},radians:function(e){return e*(Math.PI/180)},scaleSize:function(e,t,i,n){n=Math.min(i/e,n/t);return{width:e*n,height:t*n}}}},function(e,t,i){const r=i(5),a=i(1);let s,n=[],o=!1,l=null,h={};var c=e=>{l&&"function"==typeof l._dragEnd&&l._dragEnd(e),o=!1,l=null};addEventListener("mousemove",n=>{if(o&&l){n.preventDefault();let e=h.x-n.clientX,t=h.y-n.clientY,i={x:l.offsetLeft-e,y:l.offsetTop-t};l._restrictDrag&&(i.x=a.clamp(i.x,0,innerWidth-s.width),i.y=a.clamp(i.y,0,innerHeight-s.height)),i.x<innerWidth-s.width&&0<i.x&&(h.x=n.clientX,l.style.left=i.x+"px"),i.x>=innerWidth-s.width&&(l.style.left=innerWidth-s.width+"px"),i.x<=0&&(l.style.left="0px"),i.y<innerHeight-s.height&&0<i.y&&(h.y=n.clientY,l.style.top=i.y+"px"),i.y>=innerHeight-s.height&&(l.style.top=innerHeight-s.height+"px"),i.y<=0&&(l.style.top="0px"),"function"==typeof l._drag&&l._drag(n)}r.pressed||c()}),addEventListener("mousedown",e=>{n.includes(e.target._dragRoot)&&(e.preventDefault(),o=!0,l=e.target._dragRoot,s=l.getBoundingClientRect(),h.x=e.clientX,h.y=e.clientY,"function"==typeof l._dragStart&&l._dragStart(e))}),addEventListener("mouseup",c);class d{query(e,t){if("object"==typeof e)return new p(e);let i=this.node||document;if(!t)return new p(i.querySelector(e));let n=i.querySelectorAll(e),r=[];for(var a=0;a<n.length;a++){var s=new p(n[a]);r.push(s)}return new u(r)}create(e){var t=document.createElement(e),e=new p(t);return this.node&&this.node.appendChild(t),e}}class u{constructor(e){this.elements=e||[]}on(e,t){for(var i=0;i<this.elements.length;i++)this.elements[i].on(e,t)}append(t){if(t instanceof u)for(var i=0;i<this.elements.length;i++){let e=this.elements[i];for(var n=0;n<t.elements.length;n++)e.append(t.elements[n])}else for(i=0;i<this.elements.length;i++)this.elements[i].append(t)}value(e){for(var t=0;t<this.elements.length;t++)this.elements[t].value(e)}query(t){let i=[];var e;if("string"==typeof t)for(var n=0;n<this.elements.length;n++){let e=this.elements[n];e.node.matches(t)&&i.push(e)}else"object"==typeof t&&(e=new p(t),i.push(e));return new u(i)}text(e,t){for(var i=0;i<this.elements.length;i++)this.elements[i].text(e,t);return this}html(e,t){for(var i=0;i<this.elements.length;i++)this.elements[i].html(e,t);return this}addClass(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);for(t=0;t<this.elements.length;t++)this.elements[t].addClass(...e);return this}removeClass(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);for(t=0;t<this.elements.length;t++)this.elements[t].removeClass(...e);return this}toggleClass(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);for(t=0;t<this.elements.length;t++)this.elements[t].toggleClass(...e);return this}except(t){let i=[];for(var n=0;n<this.elements.length;n++){let e=this.elements[n];e.node.matches(t)||i.push(e)}return new u(i)}draggable(e){e=e||{};for(var t=0;t<this.elements.length;t++)this.elements[t].node.draggable(e)}css(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);for(t=0;t<this.elements.length;t++)this.elements[t].css(...e);return this}prop(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);for(t=0;t<this.elements.length;t++)this.elements[t].prop(...e);return this}attr(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);for(t=0;t<this.elements.length;t++)this.elements[t].attr(...e);return this}remove(){for(var t=0;t<this.elements.length;t++){let e=this.elements[t];this.elements.splice(this.elements.indexOf(e),1),e.remove()}}}class p extends d{constructor(e){super(),this.node=e}draggable(e){this.node._dragRoot=(e=e||{}).root||this.node,this.node._dragRoot._restrictDrag=e.restrict,this.node._dragRoot._dragStart=e.dragStart,this.node._dragRoot._dragEnd=e.dragEnd,this.node._dragRoot._drag=e.drag,n.includes(this.node._dragRoot)||n.push(this.node._dragRoot)}remove(){if(this.node.parentNode)this.node.parentNode.removeChild(this.node);else try{this.node.remove()}catch(e){console.warn("Couldn't remove element")}}text(e,t){return e&&(t?this.node.innerText=e:this.node.innerText+=e),this.node.innerText}html(e,t){return e&&(t?this.node.innerHTML=e:this.node.innerHTML+=e),this.node.innerHTML}addClass(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);this.node.classList.add(...e)}removeClass(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);this.node.classList.remove(...e)}toggleClass(){let e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);this.node.classList.toggle(...e)}hasClass(e){return this.node.classList.contains(e)}css(e){if("object"==typeof e)for(var t=Object.keys(e),i=0;i<t.length;i++){var n=t[i],r=e[n];this.node.style[n]=r}else 2==arguments.length&&(this.node.style[e]=arguments[1]);return this}prop(e){if("object"==typeof e)for(var t=Object.keys(e),i=0;i<t.length;i++){var n=t[i],r=e[n];this.node[n]=r}else if(arguments.length){var a=e,s=arguments[1];return void 0!==s&&(this.node[a]=s),this.node[a]}return this}attr(e){if("object"==typeof e)for(var t=Object.keys(e),i=0;i<t.length;i++){var n=t[i],r=e[n];this.node.setAttribute(n,r)}else if(arguments.length){var a=e,s=arguments[1];return void 0!==s&&this.node.setAttribute(a,s),this.node.getAttribute(a)}return this}append(e){if(e instanceof u)for(var t=0;t<e.elements.length;t++)this.node.appendChild(e.elements[t].node);else e.node?this.node.appendChild(e.node):this.node.appendChild(e);return this}value(e){return e&&this.prop("value",e),this.node.value}on(e,t){this.node.addEventListener(e,t)}}i=new d;e.exports=i},function(e,t){e.exports={accent:"#5984d2",render:{joint:{radius:3,color:{selected:"#ff565a",moving:"#b5babe",default:"#dce0e4"}},segment:{width:1.5,color:"#c7cbce"},keyframe:{size:6,color:{default:"#ff4258",hovered:"#ee2b47",active:"#e31d42"}},timeline:{scrollbar:{color:{default:"rgba(240, 230, 250, 0.045)",hovered:"rgba(240, 230, 250, 0.06)",active:"rgba(240, 230, 250, 0.075)"}}}},world:{background:"#1a1c1f",zoom:200,minZoom:100,maxZoom:1500},animation:{frameCount:{min:1,max:600},speed:{min:1,max:60},autoAddKeyframe:!0},riggingMode:"forwardKinematics",autosave:{label:"rigme.model",enabled:!0,threshold:1},animateSkin:!0}},function(e,t,i){const n=i(13),r=i(0),S=i(5),E=i(3),j=i(1),A=i(9),a=i(7),s=i(14),o=i(10);var h;const C=new Vue({el:"#timelineApp",data:{hidden:!1,totalFrames:parseInt(document.getElementById("frameCount").value),animationSpeed:parseInt(document.getElementById("animationSpeed").value),currentFrame:0},methods:{fixData:function(){this.animationSpeed=parseInt(document.getElementById("animationSpeed").value),this.totalFrames=parseInt(document.getElementById("frameCount").value),h.hatchMark.spacing=h.canvas.width/this.totalFrames,h.snap(),h.redraw(),h.playbackHandle.end.mark>=this.totalFrames&&1!=this.totalFrames&&(h.playbackHandle.end.mark=this.totalFrames-1,h.playbackHandle.end._x=h.markToX(h.playbackHandle.end.mark),h.redraw());var e={frameCount:this.totalFrames,animationSpeed:this.animationSpeed};localStorage.setItem(E.autosave.label+".frames.config",JSON.stringify(e))},validateFormat:function(e){h.redraw(),e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e),this.fixData()},validateAmount:function(e){this.validateMin(e),this.validateMax(e),this.fixData()},validateMax:function(e){let t=e.target.value,i=E.animation.frameCount.max;"animationSpeed"==e.target.id&&(i=E.animation.speed.max),parseInt(t)>i&&(e.target.value=i.toString()),this.fixData()},validateMin:function(e){let t=e.target.value,i=E.animation.frameCount.min;"animationSpeed"==e.target.id&&(i=E.animation.speed.min),parseInt(t)<i&&(e.target.value=i.toString()),this.fixData()},addToHistory:function(){this.totalFrames!=this._previousTotalFrames&&o.add({label:"Change frame count",value:this.totalFrames,group:"input"}),this.animationSpeed!=this._previousAnimationSpeed&&o.add({label:"Change animation speed",value:this.animationSpeed,group:"input"}),this._previousTotalFrames=this.totalFrames,this._previousAnimationSpeed=this.animationSpeed},toggleAmount:function(i){if(i.target==document.activeElement){let e=i.wheelDeltaY<0,t=parseInt(i.target.value);e?t--:t++,i.target.value=t.toString(),C.validateAmount(i),this.fixData()}},setCurrentFrame:function(e){this.currentFrame=e}}});function l(e){if(e=document.getElementById(e.id)){e=e.getBoundingClientRect();return S.x>=e.x&&S.x<=e.x+e.width&&S.y>=e.y&&S.y<=e.y+e.height}}C._previousTotalFrames=C.totalFrames,C._previousAnimationSpeed=C.animationSpeed,C.$el.addEventListener("focusout",()=>{}),h=new class{constructor(){this.canvas=document.getElementById("timelineGraph"),this.context=this.canvas.getContext("2d"),this.buttons={previous:document.getElementById("lastFrame"),play:document.getElementById("playStop"),next:document.getElementById("nextFrame"),add:document.getElementById("addKeyframe"),delete:document.getElementById("deleteKeyframe"),zoomIn:document.getElementById("zoomInTimeline"),zoomOut:document.getElementById("zoomOutTimeline"),minimize:document.getElementById("minimize"),scrollbar:document.getElementById("timelineScrollbar")},this.state={isPlaying:!1,isDragging:!1,isMinimized:!1,currentMark:0,currentFrame:0,nextFrame:null,previousFrame:null,_x:0},this.hatchMark={spacing:this.canvas.width/C.totalFrames,height:4},this.scrollbar={},this.playbackHandle={start:{mark:0,_x:0},end:{mark:C.totalFrames-1,_x:0},width:2,offset:6},this.bounds=this.canvas.getBoundingClientRect(),this.loop=null,this.addButtonEvents(),this.addMouseEvents(),this.addKeyboardEvents(),this.updateSize(),addEventListener("resize",()=>{this.updateSize(),this.scrollbar.left=j.clamp(this.scrollbar.left,0,this.canvas.width-this.scrollbar.minWidth),this.scrollbar.right=j.clamp(this.scrollbar.right,this.scrollbar.minWidth,this.canvas.width),this.scrollbar.width=this.scrollbar.right-this.scrollbar.left,this.redraw()}),addEventListener("load",e=>{this.updateSize(),this.redraw()}),this.scrollbar={x:0,y:0,width:this.canvas.width,height:void 0,color:E.render.timeline.scrollbar.color.default,left:0,right:this.canvas.width,minWidth:50,zoomSensitivity:10},this._timelineHeight=void 0}storeSelectedKeyframe(){for(var i=Object.keys(A.keyframes),n=0;n<i.length;n++){let e=i[n],t=A.keyframes[e];t.index==this.state.currentMark?t.selected=!0:t.selected=!1}}markToX(e,t){var i=j.map(this.scrollbar.left,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity),n=Math.round(j.clamp(i-this.hatchMark.spacing/2,0,Number.MAX_SAFE_INTEGER)/this.hatchMark.spacing),i=i%this.hatchMark.spacing,i=(e-n)*this.hatchMark.spacing+this.hatchMark.spacing/2-i;return t?i:j.clamp(i,this.hatchMark.spacing/2,this.canvas.width-this.hatchMark.spacing/2)}xToMark(e){var t=j.map(this.scrollbar.left,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity),i=Math.round(j.clamp(t-this.hatchMark.spacing/2,0,Number.MAX_SAFE_INTEGER)/this.hatchMark.spacing),t=t%this.hatchMark.spacing,i=Math.round((e+t+this.hatchMark.spacing/2)/this.hatchMark.spacing)-1+i;return j.clamp(i,0,C.totalFrames-1)}addKeyboardEvents(){addEventListener("keydown",e=>{var t;Object.keys(A.keyframes),this.storeSelectedKeyframe(),e.ctrlKey&&(67==e.keyCode&&(A.copiedKeyframe=n(A.getKeyframe("selected",!0))),86==e.keyCode)&&(t=A.copiedKeyframe)&&A.setKeyframe(this.state.currentMark,{position:a(this.state.currentMark*this.hatchMark.spacing+this.hatchMark.spacing/2,0),locked:0==this.state.currentMark,id:j.uid(),joints:t.joints})})}addMouseEvents(){this.canvas.addEventListener("contextmenu",e=>{var t,i;S.x,this.bounds.x,S.y,this.bounds.y,l(this.canvas)&&(this.storeSelectedKeyframe(),t=S.x+s.width>innerWidth?-s.width:0,i=S.y+s.height>innerHeight?-s.height:0,s.show(S.x+t,S.y+i))});let d,u,p,f,g,m,y,v,b,x=!1,k=null,w=0;this.redraw(),addEventListener("mouseup",()=>{var e;x=!1,r.emit("renderFocus"),"playbackHandleStart"!=k&&"playbackHandleEnd"!=k||(e={start:this.playbackHandle.start.mark,end:this.playbackHandle.end.mark},localStorage.setItem(E.autosave.label+".playback.config",JSON.stringify(e))),k=null,d&&(e=this.xToMark(this.state._x),this.setCurrentMark(e),A.deleteKeyframe(d.id),A.setKeyframe(e,{position:d.position,joints:d.joints,locked:0==e})),this.scrollbar.color=E.render.timeline.scrollbar.color.default,this.snap(),this.state.isDragging=!1,this.playbackHandle.start.isDragging=!1,this.playbackHandle.end.isDragging=!1,d=null,this.canvas.style.cursor="default",this.redraw()}),addEventListener("mousedown",()=>{var e,t,i;l(this.canvas)&&(x=!0,r.emit("renderSleep"),this.playbackHandle.end.mark>=C.totalFrames&&1!=C.totalFrames&&(this.playbackHandle.end.mark=C.totalFrames-1,this.playbackHandle.end._x=this.markToX(this.playbackHandle.end.mark),this.redraw()),x&&!k&&(f?(w=this.scrollbar.left-u,k="scrollbar"):g?(k="timeline",e=this.markToX(this.playbackHandle.start.mark,!0),t=this.markToX(this.playbackHandle.end.mark,!0),i=this.playbackHandle.width/2+this.playbackHandle.offset/2,u>=e-i&&u<=e+i?k="playbackHandleStart":u>=t-i&&u<=t+i&&(k="playbackHandleEnd")):m&&(k="keyframe")),"timeline"==k&&(this.state.isDragging=!0,this.state._x=j.clamp(u,this.hatchMark.spacing/2,this.canvas.width-this.hatchMark.spacing/2),0<=(i=this.xToMark(u))&&i<=C.totalFrames&&this.setCurrentMark(i)),s.hide())}),addEventListener("mousemove",()=>{if(u=S.x-this.bounds.x,p=S.y-this.bounds.y,x||!(p<0||p>this.canvas.height||u<0||u>this.canvas.width)){f=0<=p&&p<=this.scrollbar.height,g=p>=this.scrollbar.height&&p<=this.scrollbar.height+this._timelineHeight,m=p>=this.scrollbar.height+this._timelineHeight&&p<=this.canvas.height,k||(y=u<=this.scrollbar.left+10,v=u>=this.scrollbar.right-10);var e,t=u>=this.scrollbar.left&&u<=this.scrollbar.right&&(y||v)&&f,i=this.markToX(this.playbackHandle.start.mark,!0),n=this.markToX(this.playbackHandle.end.mark,!0),r=this.playbackHandle.width/2+this.playbackHandle.offset/2;if(b=(u>=i-r&&u<=i+r||u>=n-r&&u<=n+r)&&g,this.canvas.style.cursor=t||b?"ew-resize":"default",m)for(var a,s,o,l=Object.keys(A.keyframes),h=0;h<l.length;h++){let e=A.keyframes[l[h]];"head"==e.type&&(a=e.render.position.x,s=e.render.position.y,o=e.render.size,u<=a+o&&u>=a-o&&p<=s+o&&p&&p>=s-o?(e.hovered=!0,e.render.color=E.render.keyframe.color.hovered,this.canvas.style.cursor="pointer"):(e.hovered=!1,e.render.color=E.render.keyframe.color.default),this.redraw())}if(f&&u>=this.scrollbar.left&&u<=this.scrollbar.right?this.scrollbar.color=E.render.timeline.scrollbar.color.hovered:this.scrollbar.color=E.render.timeline.scrollbar.color.default,this.redraw(),x){if("scrollbar"==k&&(y?(this.scrollbar.left=j.clamp(u,0,this.scrollbar.right-this.scrollbar.minWidth),this.scrollbar.width=this.scrollbar.right-this.scrollbar.left,this.canvas.style.cursor="ew-resize"):v&&(this.scrollbar.right=j.clamp(u,this.scrollbar.left+this.scrollbar.minWidth,this.canvas.width),this.scrollbar.width=this.scrollbar.right-this.scrollbar.left,this.canvas.style.cursor="ew-resize"),y||v||(this.scrollbar.left=j.clamp(u+w,0,this.canvas.width-this.scrollbar.width),this.scrollbar.right=this.scrollbar.left+this.scrollbar.width,this.canvas.style.cursor="default"),this.snap()),"timeline"!=k&&"keyframe"!=k||(this.state.isDragging=!0,this.state._x=j.clamp(u,this.hatchMark.spacing/2,this.canvas.width-this.hatchMark.spacing/2),0<=(t=this.xToMark(u))&&t<=C.totalFrames&&this.setCurrentMark(t)),"playbackHandleStart"==k&&(this.playbackHandle.start.isDragging=!0,this.playbackHandle.start._x=j.clamp(u,this.hatchMark.spacing/2,this.playbackHandle.end._x-this.playbackHandle.width/2-this.hatchMark.spacing),e=this.xToMark(u),0<=(e=j.clamp(e,0,this.playbackHandle.end.mark-1))&&e<=C.totalFrames&&(this.playbackHandle.start.mark=e),this.canvas.style.cursor="ew-resize"),"playbackHandleEnd"==k&&(this.playbackHandle.end.isDragging=!0,this.playbackHandle.end._x=j.clamp(u,this.playbackHandle.start._x+this.playbackHandle.width/2+this.hatchMark.spacing,this.canvas.width-this.hatchMark.spacing/2),e=this.xToMark(u),0<=(e=j.clamp(e,this.playbackHandle.start.mark+1,C.totalFrames-1))&&e<=C.totalFrames&&(this.playbackHandle.end.mark=e),this.canvas.style.cursor="ew-resize"),"keyframe"==k)if(d)this.state._x=j.clamp(u,this.hatchMark.spacing/2,this.canvas.width-this.hatchMark.spacing/2),d.render.position.x=this.state._x,d.dragged=!0,d.render.color=E.render.keyframe.color.active;else for(h=0;h<keys.length;h++){var c=A.keyframes[keys[h]];c&&(c.locked||c.hovered&&(d=c))}this.redraw()}}})}addButtonEvents(){let t;this.buttons.previous.addEventListener("click",()=>{var e=0<this.state.currentMark?this.state.currentMark-1:this.state.currentMark;this.setCurrentMark(e)}),this.buttons.next.addEventListener("click",()=>{var e=this.state.currentMark<C.totalFrames-1?this.state.currentMark+1:this.state.currentMark;this.setCurrentMark(e)}),this.buttons.play.addEventListener("click",()=>{this.state.isPlaying?this.stop():this.play(),this.redraw()}),this.buttons.add.addEventListener("click",()=>{let e,t=A.clone()[this.state.currentMark];t&&(e=t.joints),A.setKeyframe(this.state.currentMark,{locked:0==this.state.currentMark,joints:e})}),this.buttons.delete.addEventListener("click",()=>{r.emit("deleteKeyframe")}),this.buttons.zoomIn.addEventListener("mousedown",()=>{r.emit("checkMouseHold","zoomIn")}),this.buttons.zoomOut.addEventListener("mousedown",()=>{r.emit("checkMouseHold","zoomOut")}),r.on("checkMouseHold",e=>{t=setInterval(()=>{S.pressed?r.emit("mousehold",e):(clearInterval(t),t=null)},1e3/60)}),r.on("mousehold",e=>{var t,i;"zoomIn"==e?(t=j.map(this.scrollbar.width,0,this.canvas.width,.1,.001),i=this.markToX(this.state.currentMark,!0),this.scrollbar.left=j.lerp(this.scrollbar.left,i-this.scrollbar.minWidth/2,t),this.scrollbar.right=j.lerp(this.scrollbar.right,i+this.scrollbar.minWidth/2,t)):"zoomOut"==e&&(e=j.map(this.scrollbar.width,0,this.canvas.width,.001,.1),this.scrollbar.left=j.lerp(this.scrollbar.left,0,e),this.scrollbar.right=j.lerp(this.scrollbar.right,this.canvas.width,e)),this.scrollbar.width=this.scrollbar.right-this.scrollbar.left,this.snap(),this.redraw()}),this.buttons.minimize.addEventListener("click",()=>{this.state.isMinimized?this.maximize():this.minimize()})}snap(){for(var n=Object.keys(A.keyframes),r=0;r<n.length;r++){let e=n[r],t=A.keyframes[e],i=this.markToX(t.index,!0);t.render.position.x=i}this.state._x=this.markToX(this.state.currentMark,!0),this.playbackHandle.start._x=this.markToX(this.playbackHandle.start.mark,!0),this.playbackHandle.end._x=this.markToX(this.playbackHandle.end.mark,!0),this.redraw()}updateState(e){e=void 0===e||e;var t=function(){let e=C.totalFrames,t=h.state.currentMark,i=null;for(var n=parseInt(t);0<=n;n--){var r=A.keyframes[n];if(r&&"head"==r.type){i=r.index;break}}let a=null;for(n=parseInt(t)+1;n<e;n++){var s=A.keyframes[n];if(s&&"head"==s.type){a=s.index;break}}let o=null;for(n=i-1;0<=n;n--){var l=A.keyframes[n];if(l&&"head"==l.type){o=l.index;break}}return{current:i,next:a,previous:o}}();if(this.state.currentFrame=t.current,this.state.nextFrame=t.next,this.state.previousFrame=t.previous,e){let t=A.keyframes[this.state.currentMark];t=t||A.keyframes[this.state.currentFrame],"object"==typeof t&&(A.joints=t.joints,e=A.joints.find(e=>e.id===t.activeJointId),A.activeJoint=e||A.joints[A.joints.length-1])}}redraw(){this.clear(),this.draw()}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}draw(){var e=this.canvas.parentNode;this.canvas.width==e.offsetWidth&&this.canvas.height==e.offsetHeight||(this.canvas.width=e.offsetWidth,this.canvas.height=e.offsetHeight),this.scrollbar.height=.25*this.canvas.height,this._timelineHeight=.4*this.canvas.height;let t=j.map(this.scrollbar.left,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity),i=this.canvas.width+j.map(this.scrollbar.width,0,this.canvas.width,this.canvas.width*this.scrollbar.zoomSensitivity,0),n=C.totalFrames,r=5*Math.floor(j.clamp(C.totalFrames,i/15,Number.MAX_SAFE_INTEGER)/(i/15)),a=Math.round((t-this.hatchMark.spacing/2)/this.hatchMark.spacing),s=Math.round((j.map(this.scrollbar.right,0,this.canvas.width,0,this.canvas.width*this.scrollbar.zoomSensitivity)-this.hatchMark.spacing/2)/this.hatchMark.spacing),o=this.markToX(this.state.currentMark,!0);o=this.state.isDragging?this.state._x:o;var l=this._timelineHeight-this.hatchMark.height,e=this.state.currentMark+1;this.createRect(this.scrollbar.left,this.scrollbar.y,this.scrollbar.right-this.scrollbar.left,this.scrollbar.height-5,this.scrollbar.color,4),this.createRect(0,this.scrollbar.height,this.canvas.width,this._timelineHeight,"rgba(0, 0, 0, 0.15)",4),this.context.save(),this.context.clip(),this.hatchMark.spacing=i/n;for(var h,c,d,u,p,f=0;f<n;f++)f<a||s<f||(c=this.hatchMark.spacing*f+this.hatchMark.spacing/2-t,d=this.scrollbar.height+this._timelineHeight-this.hatchMark.height-(h=(f+1)%r==0?2:0),u=this.scrollbar.height+this._timelineHeight-d,this.createRect(c-.5,d,1,u,"rgba(255, 255, 255, 0.25)"),h&&(c>=o-5&&c<=o+5||this.text(f+1,c,d-1,"rgba(255, 255, 255, 0.25)")));this.context.beginPath(),this.context.moveTo(o-5,this.scrollbar.height),this.context.lineTo(o+5,this.scrollbar.height),this.context.lineTo(o+5,this.scrollbar.height+l-5),this.context.lineTo(o,this.scrollbar.height+l),this.context.lineTo(o-5,this.scrollbar.height+l-5),this.context.closePath(),this.context.fillStyle=E.accent,this.context.fill(),this.text(e,o+10,l/2+8+this.scrollbar.height,E.accent,"left");let g=this.markToX(this.playbackHandle.start.mark,!0);g=this.playbackHandle.start.isDragging?this.playbackHandle.start._x:g,this.createRect(g-this.playbackHandle.width/2,this.scrollbar.height,this.playbackHandle.width,this._timelineHeight,E.accent),this.createRect(0,this.scrollbar.height,g,this._timelineHeight,"rgba(0, 0, 0, 0.15)");let m=this.markToX(this.playbackHandle.end.mark,!0);m=this.playbackHandle.end.isDragging?this.playbackHandle.end._x:m,this.createRect(m-this.playbackHandle.width/2,this.scrollbar.height,this.playbackHandle.width,this._timelineHeight,E.accent),this.createRect(m,this.scrollbar.height,this.canvas.width-m,this._timelineHeight,"rgba(0, 0, 0, 0.15)"),this.context.restore();for(p of Object.keys(A.keyframes)){let e=A.keyframes[p];e.render.position.y=this.scrollbar.height+this._timelineHeight+e.render.size+5;var y=this.markToX(e.index,!0);e.render.position.x=e.dragged?S.x-this.bounds.x:y,"head"==e.type&&this.createKeyframe(e.render.position.x,e.render.position.y,e.render.size,e.render.color)}}text(e,t,i,n,r){this.context.beginPath(),this.context.fillStyle=n,this.context.font="12px Catamaran",this.context.textAlign=r||"center",this.context.textBaseline="bottom",this.context.fillText(e,t,i)}createRect(e,t,i,n,r,a){a=a||0,this.context.beginPath(),this.context.moveTo(e+a,t),this.context.lineTo(e+i-a,t),this.context.quadraticCurveTo(e+i,t,e+i,t+a),this.context.lineTo(e+i,t+n-a),this.context.quadraticCurveTo(e+i,t+n,e+i-a,t+n),this.context.lineTo(e+a,t+n),this.context.quadraticCurveTo(e,t+n,e,t+n-a),this.context.lineTo(e,t+a),this.context.quadraticCurveTo(e,t,e+a,t),this.context.closePath(),this.context.fillStyle=r,this.context.fill()}createLine(e,t,i,n,r){this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(i,n),this.context.strokeStyle=r,this.context.stroke()}createKeyframe(e,t,i,n){this.context.beginPath(),this.context.moveTo(e,t-i/2),this.context.lineTo(e+i/2,t),this.context.lineTo(e,t+i/2),this.context.lineTo(e-i/2,t),this.context.closePath(),this.context.fillStyle=n,this.context.fill()}setCurrentMark(e,t){this.state.currentMark=e,C.setCurrentFrame(this.state.currentMark),this.updateState(t),this.redraw(),r.emit("timelineSeeked")}play(){this.loop=setInterval(()=>{this.state.currentMark<this.playbackHandle.start.mark&&this.setCurrentMark(this.playbackHandle.start.mark-1);var e=this.state.currentMark<this.playbackHandle.end.mark?this.state.currentMark+1:this.playbackHandle.start.mark;this.setCurrentMark(e)},1e3/C.animationSpeed),this.state.isPlaying=!0,this.buttons.play.firstChild.src="assets/svg/round-square.svg",document.getElementById("propertyApp").classList.add("disabled")}stop(){clearInterval(this.loop),this.state.isPlaying=!1,this.buttons.play.firstChild.src="assets/svg/play.svg",document.getElementById("propertyApp").classList.remove("disabled"),r.emit("timelineSeeked")}updateSize(){var e=()=>{var e=this.canvas.parentNode.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height,this.bounds=this.canvas.getBoundingClientRect(),this.redraw()};e(),setTimeout(e,100)}minimize(){var e=C.$el.offsetHeight,t=document.querySelector("#timelineApp div.row-b");C.$el.style.transform=`translateY(${e-t.offsetTop-2}px)`,this.buttons.minimize.style.transform="translateY(-40px) rotate(0deg)",this.state.isMinimized=!0}maximize(){C.$el.offsetHeight,C.$el.style.transform="translateY(0px)",this.buttons.minimize.style.transform="translateY(-40px) rotate(180deg)",this.state.isMinimized=!1}},j.loadJSONData(E.autosave.label+".frames.config",e=>{let t=document.getElementById("frameCount"),i=document.getElementById("animationSpeed");"number"==typeof e.frameCount&&(t.value=e.frameCount),"number"==typeof e.animationSpeed&&(i.value=e.animationSpeed),C.fixData()}),j.loadJSONData(E.autosave.label+".playback.config",e=>{"number"==typeof e.start&&(h.playbackHandle.start.mark=e.start),"number"==typeof e.end&&(h.playbackHandle.end.mark=e.end),h.redraw()}),e.exports={app:C,graph:h}},function(e,t){const i=new class{constructor(){this.x=0,this.y=0,this.speedX=0,this.speedY=0,this.pressed=!1,this.dragged=!1,this.scrolled=!1,this.scrollTop=!1}on(e,t){"function"==typeof t&&addEventListener(e,t)}};i.on("mousedown",function(){i.pressed=!0}),i.on("mouseup",function(){i.pressed=!1,i.dragged=!1}),i.on("mousemove",function(e){i.x=e.clientX,i.y=e.clientY,i.speedX=e.movementX,i.speedY=e.movementY,i.pressed?i.dragged=!0:i.dragged=!1}),i.on("mousewheel",function(){i.scrolled=!0,0<event.wheelDelta?i.scrollTop=!0:i.scrollTop=!1,setTimeout(function(){i.scrolled=!1},100)}),e.exports=i},function(e,t){var i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t){function i(e,t){return Math.random()*(t-e)+e}class n{constructor(){var e="object"==typeof arguments[0]?arguments[0].x:arguments[0],t="object"==typeof arguments[0]?arguments[0].y:arguments[1];this.x=e||0,this.y=t||0}add(){var e="object"==typeof arguments[0]?arguments[0].x:arguments[0],t="object"==typeof arguments[0]?arguments[0].y:arguments[1];return this.x+=e||0,this.y+=t||0,this}sub(){var e="object"==typeof arguments[0]?arguments[0].x:arguments[0],t="object"==typeof arguments[0]?arguments[0].y:arguments[1];return this.x-=e||0,this.y-=t||0,this}mult(e){return this.x*=e,this.y*=e,this}div(e){return this.x/=e,this.y/=e,this}set(){var e="object"==typeof arguments[0]?arguments[0].x:arguments[0],t="object"==typeof arguments[0]?arguments[0].y:arguments[1];return this.x=e||0,this.y=t||0,this}equals(){var e="object"==typeof arguments[0]?arguments[0].x:arguments[0],t="object"==typeof arguments[0]?arguments[0].y:arguments[1];return this.x==e&&this.y==t}reset(){return this.x=0,this.y=0,this}limit(e){return e=e||1,this.getMag()>=e&&this.setMag(e),this}lerp(e,t){return t=t||.1,"number"==typeof e.x&&(this.x=t*(e.x-this.x)+this.x),"number"==typeof e.y&&(this.y=t*(e.y-this.y)+this.y),this}dist(){var e="object"==typeof arguments[0]?arguments[0].x:arguments[0],t="object"==typeof arguments[0]?arguments[0].y:arguments[1];return Math.sqrt((this.x-e)*(this.x-e)+(this.y-t)*(this.y-t))}heading(){var e="object"==typeof arguments[0]?arguments[0].x:arguments[0],t="object"==typeof arguments[0]?arguments[0].y:arguments[1];return arguments.length?Math.atan2(t-this.y,e-this.x):Math.atan2(this.y,this.x)}norm(){var e=this.getMag();return 0!=e&&this.mult(1/e,1/e),this}copy(){return new n(this.x,this.y)}setMag(e){let t=this.getMag();return t=0==t?.001:t,this.x*=1/t*e,this.y*=1/t*e,this}getMag(){return Math.sqrt(this.x*this.x+this.y*this.y)}random2D(e){return this.x=i(-(e="number"!=typeof e?1:e),e),this.y=i(-e,e),this.setMag(e),this}}e.exports=function(e,t){return new n(e,t)}},function(e,t){const r=["running","walking","dancing","shivering","jumping","sleeping","sitting","flying","cheering","yielding","punching","kicking","crawling","painting","smoking","crouching","driving","sliding","breathing","hunting","dying","moving","aroused","tickled","thrilled","backflipping","frontflipping","falling"],a=["abandoned","able","absolute","adorable","adventurous","academic","acceptable","acclaimed","accomplished","accurate","aching","acidic","acrobatic","active","actual","adept","admirable","admired","adolescent","adorable","adored","advanced","afraid","affectionate","aged","aggravating","aggressive","agile","agitated","agonizing","agreeable","ajar","alarmed","alarming","alert","alienated","alive","all","altruistic","amazing","ambitious","ample","amused","amusing","anchored","ancient","angelic","angry","anguished","animated","annual","another","antique","anxious","any","apprehensive","appropriate","apt","arctic","arid","aromatic","artistic","ashamed","assured","astonishing","athletic","attached","attentive","attractive","austere","authentic","authorized","automatic","avaricious","average","aware","awesome","awful","awkward","babyish","bad","back","baggy","bare","barren","basic","beautiful","belated","beloved","beneficial","better","best","bewitched","big","big-hearted","biodegradable","bite-sized","bitter","black","black-and-white","bland","blank","blaring","bleak","blind","blissful","blond","blue","blushing","bogus","boiling","bold","bony","boring","bossy","both","bouncy","bountiful","bowed","brave","breakable","brief","bright","brilliant","brisk","broken","bronze","brown","bruised","bubbly","bulky","bumpy","buoyant","burdensome","burly","bustling","busy","buttery","buzzing","calculating","calm","candid","canine","capital","carefree","careful","careless","caring","cautious","cavernous","celebrated","charming","cheap","cheerful","cheery","chief","chilly","chubby","circular","classic","clean","clear","clear-cut","clever","close","closed","cloudy","clueless","clumsy","cluttered","coarse","cold","colorful","colorless","colossal","comfortable","common","compassionate","competent","complete","complex","complicated","composed","concerned","concrete","confused","conscious","considerate","constant","content","conventional","cooked","cool","cooperative","coordinated","corny","corrupt","costly","courageous","courteous","crafty","crazy","creamy","creative","creepy","criminal","crisp","critical","crooked","crowded","cruel","crushing","cuddly","cultivated","cultured","cumbersome","curly","curvy","cute","cylindrical","damaged","damp","dangerous","dapper","daring","darling","dark","dazzling","dead","deadly","deafening","dear","dearest","decent","decimal","decisive","deep","defenseless","defensive","defiant","deficient","definite","definitive","delayed","delectable","delicious","delightful","delirious","demanding","dense","dental","dependable","dependent","descriptive","deserted","detailed","determined","devoted","different","difficult","digital","diligent","dim","dimpled","dimwitted","direct","disastrous","discrete","disfigured","disgusting","disloyal","dismal","distant","downright","dreary","dirty","disguised","dishonest","dismal","distant","distinct","distorted","dizzy","dopey","doting","double","downright","drab","drafty","dramatic","dreary","droopy","dry","dual","dull","dutiful","each","eager","earnest","early","easy","easy-going","ecstatic","edible","educated","elaborate","elastic","elated","elderly","electric","elegant","elementary","elliptical","embarrassed","embellished","eminent","emotional","empty","enchanted","enchanting","energetic","enlightened","enormous","enraged","entire","envious","equal","equatorial","essential","esteemed","ethical","euphoric","even","evergreen","everlasting","every","evil","exalted","excellent","exemplary","exhausted","excitable","excited","exciting","exotic","expensive","experienced","expert","extraneous","extroverted","extra-large","extra-small","fabulous","failing","faint","fair","faithful","fake","false","familiar","famous","fancy","fantastic","far","faraway","far-flung","far-off","fast","fat","fatal","fatherly","favorable","favorite","fearful","fearless","feisty","feline","female","feminine","few","fickle","filthy","fine","finished","firm","first","firsthand","fitting","fixed","flaky","flamboyant","flashy","flat","flawed","flawless","flickering","flimsy","flippant","flowery","fluffy","fluid","flustered","focused","fond","foolhardy","foolish","forceful","forked","formal","forsaken","forthright","fortunate","fragrant","frail","frank","frayed","free","French","fresh","frequent","friendly","frightened","frightening","frigid","frilly","frizzy","frivolous","front","frosty","frozen","frugal","fruitful","full","fumbling","functional","funny","fussy","fuzzy","gargantuan","gaseous","general","generous","gentle","genuine","giant","giddy","gigantic","gifted","giving","glamorous","glaring","glass","gleaming","gleeful","glistening","glittering","gloomy","glorious","glossy","glum","golden","good","good-natured","gorgeous","graceful","gracious","grand","grandiose","granular","grateful","grave","gray","great","greedy","green","gregarious","grim","grimy","gripping","grizzled","gross","grotesque","grouchy","grounded","growing","growling","grown","grubby","gruesome","grumpy","guilty","gullible","gummy","hairy","half","handmade","handsome","handy","happy","happy-go-lucky","hard","hard-to-find","harmful","harmless","harmonious","harsh","hasty","hateful","haunting","healthy","heartfelt","hearty","heavenly","heavy","hefty","helpful","helpless","hidden","hideous","high","high-level","hilarious","hoarse","hollow","homely","honest","honorable","honored","hopeful","horrible","hospitable","hot","huge","humble","humiliating","humming","humongous","hungry","hurtful","husky","icky","icy","ideal","idealistic","identical","idle","idiotic","idolized","ignorant","ill","illegal","ill-fated","ill-informed","illiterate","illustrious","imaginary","imaginative","immaculate","immaterial","immediate","immense","impassioned","impeccable","impartial","imperfect","imperturbable","impish","impolite","important","impossible","impractical","impressionable","impressive","improbable","impure","inborn","incomparable","incompatible","incomplete","inconsequential","incredible","indelible","inexperienced","indolent","infamous","infantile","infatuated","inferior","infinite","informal","innocent","insecure","insidious","insignificant","insistent","instructive","insubstantial","intelligent","intent","intentional","interesting","internal","international","intrepid","ironclad","irresponsible","irritating","itchy","jaded","jagged","jam-packed","jaunty","jealous","jittery","joint","jolly","jovial","joyful","joyous","jubilant","judicious","juicy","jumbo","junior","jumpy","juvenile","kaleidoscopic","keen","key","kind","kindhearted","kindly","klutzy","knobby","knotty","knowledgeable","knowing","known","kooky","kosher","lame","lanky","large","last","lasting","late","lavish","lawful","lazy","leading","lean","leafy","left","legal","legitimate","light","lighthearted","likable","likely","limited","limp","limping","linear","lined","liquid","little","live","lively","livid","loathsome","lone","lonely","long","long-term","loose","lopsided","lost","loud","lovable","lovely","loving","low","loyal","lucky","lumbering","luminous","lumpy","lustrous","luxurious","mad","made-up","magnificent","majestic","major","male","mammoth","married","marvelous","masculine","massive","mature","meager","mealy","mean","measly","meaty","medical","mediocre","medium","meek","mellow","melodic","memorable","menacing","merry","messy","metallic","mild","milky","mindless","miniature","minor","minty","miserable","miserly","misguided","misty","mixed","modern","modest","moist","monstrous","monthly","monumental","moral","mortified","motherly","motionless","mountainous","muddy","muffled","multicolored","mundane","murky","mushy","musty","muted","mysterious","naive","narrow","nasty","natural","naughty","nautical","near","neat","necessary","needy","negative","neglected","negligible","neighboring","nervous","new","next","nice","nifty","nimble","nippy","nocturnal","noisy","nonstop","normal","notable","noted","noteworthy","novel","noxious","numb","nutritious","nutty","obedient","obese","oblong","oily","oblong","obvious","occasional","odd","oddball","offbeat","offensive","official","old","old-fashioned","only","open","optimal","optimistic","opulent","orange","orderly","organic","ornate","ornery","ordinary","original","other","our","outlying","outgoing","outlandish","outrageous","outstanding","oval","overcooked","overdue","overjoyed","overlooked","palatable","pale","paltry","parallel","parched","partial","passionate","past","pastel","peaceful","peppery","perfect","perfumed","periodic","perky","personal","pertinent","pesky","pessimistic","petty","phony","physical","piercing","pink","pitiful","plain","plaintive","plastic","playful","pleasant","pleased","pleasing","plump","plush","polished","polite","political","pointed","pointless","poised","poor","popular","portly","posh","positive","possible","potable","powerful","powerless","practical","precious","present","prestigious","pretty","precious","previous","pricey","prickly","primary","prime","pristine","private","prize","probable","productive","profitable","profuse","proper","proud","prudent","punctual","pungent","puny","pure","purple","pushy","putrid","puzzled","puzzling","quaint","qualified","quarrelsome","quarterly","queasy","querulous","questionable","quick","quick-witted","quiet","quintessential","quirky","quixotic","quizzical","radiant","ragged","rapid","rare","rash","raw","recent","reckless","rectangular","ready","real","realistic","reasonable","red","reflecting","regal","regular","reliable","relieved","remarkable","remorseful","remote","repentant","required","respectful","responsible","repulsive","revolving","rewarding","rich","rigid","right","ringed","ripe","roasted","robust","rosy","rotating","rotten","rough","round","rowdy","royal","rubbery","rundown","ruddy","rude","runny","rural","rusty","sad","safe","salty","same","sandy","sane","sarcastic","sardonic","satisfied","scaly","scarce","scared","scary","scented","scholarly","scientific","scornful","scratchy","scrawny","second","secondary","second-hand","secret","self-assured","self-reliant","selfish","sentimental","separate","serene","serious","serpentine","several","severe","shabby","shadowy","shady","shallow","shameful","shameless","sharp","shimmering","shiny","shocked","shocking","shoddy","short","short-term","showy","shrill","shy","sick","silent","silky","silly","silver","similar","simple","simplistic","sinful","single","sizzling","skeletal","skinny","sleepy","slight","slim","slimy","slippery","slow","slushy","small","smart","smoggy","smooth","smug","snappy","snarling","sneaky","sniveling","snoopy","sociable","soft","soggy","solid","somber","some","spherical","sophisticated","sore","sorrowful","soulful","soupy","sour","Spanish","sparkling","sparse","specific","spectacular","speedy","spicy","spiffy","spirited","spiteful","splendid","spotless","spotted","spry","square","squeaky","squiggly","stable","staid","stained","stale","standard","starchy","stark","starry","steep","sticky","stiff","stimulating","stingy","stormy","straight","strange","steel","strict","strident","striking","striped","strong","studious","stunning","stupendous","stupid","sturdy","stylish","subdued","submissive","substantial","subtle","suburban","sudden","sugary","sunny","super","superb","superficial","superior","supportive","sure-footed","surprised","suspicious","svelte","sweaty","sweet","sweltering","swift","sympathetic","tall","talkative","tame","tan","tangible","tart","tasty","tattered","taut","tedious","teeming","tempting","tender","tense","tepid","terrible","terrific","testy","thankful","that","these","thick","thin","third","thirsty","this","thorough","thorny","those","thoughtful","threadbare","thrifty","thunderous","tidy","tight","timely","tinted","tiny","tired","torn","total","tough","traumatic","treasured","tremendous","tragic","trained","tremendous","triangular","tricky","trifling","trim","trivial","troubled","true","trusting","trustworthy","trusty","truthful","tubby","turbulent","twin","ugly","ultimate","unacceptable","unaware","uncomfortable","uncommon","unconscious","understated","unequaled","uneven","unfinished","unfit","unfolded","unfortunate","unhappy","unhealthy","uniform","unimportant","unique","united","unkempt","unknown","unlawful","unlined","unlucky","unnatural","unpleasant","unrealistic","unripe","unruly","unselfish","unsightly","unsteady","unsung","untidy","untimely","untried","untrue","unused","unusual","unwelcome","unwieldy","unwilling","unwitting","unwritten","upbeat","upright","upset","urban","usable","used","useful","useless","utilized","utter","vacant","vague","vain","valid","valuable","vapid","variable","vast","velvety","venerated","vengeful","verifiable","vibrant","vicious","victorious","vigilant","vigorous","villainous","violet","violent","virtual","virtuous","visible","vital","vivacious","vivid","voluminous","wan","warlike","warm","warmhearted","warped","wary","wasteful","watchful","waterlogged","watery","wavy","wealthy","weak","weary","webbed","wee","weekly","weepy","weighty","weird","welcome","well-documented","well-groomed","well-informed","well-lit","well-made","well-off","well-to-do","well-worn","wet","which","whimsical","whirlwind","whispered","white","whole","whopping","wicked","wide","wide-eyed","wiggly","wild","willing","wilted","winding","windy","winged","wiry","wise","witty","wobbly","woeful","wonderful","wooden","woozy","wordy","worldly","worn","worried","worrisome","worse","worst","worthless","worthwhile","worthy","wrathful","wretched","writhing","wrong","wry","yawning","yearly","yellow","yellowish","young","youthful","yummy","zany","zealous","zesty","zigzag","rocky"],s=["person","dog","cat","elephant","bird","velociraptor","t-rex","worm","fly","mosquito","bear","fish","fox","horse","tiger","lion","frog","monkey","people","meat","food","player","soup","woman","hair","police","lady","pizza","plant","doctor","god","nurse","cow"],o=["Eren Yaeger","Mikasa","Levi Ackerman","Nezuko","Tanjiro","Muzan","Kazuto","Kurisu","Hachiman","Itachi","Naruto","Roronoa","Light Yagami"],l=["Spider-Man","Iron Man","Hulk","Thanos","Wolverine","Loki","Batman","Superman","Aquaman","Joker","Lex Luthor","Cyborg"],h=["Obama","Trump","Abraham Lincoln","Madonna","Drawne Johnson","Leonardo DiCaprio","Will Smith","Tom Hanks","Tom Cruise","Brad Pitt","Johnny Depp","Matt Damon","Chris Hemsworth","Hugh Jackman"];e.exports={generate:function(){let e=r.concat(a),t=e[Math.floor(Math.random()*e.length)],i=s.concat(o,l,h),n=i[Math.floor(Math.random()*i.length)];return t.charAt(0).toUpperCase()+t.slice(1)+" "+n}}},function(e,t,i){const s=i(0),h=(i(5),i(7)),u=i(3),b=i(1),o=i(10);let p;const n=new class{constructor(){this.joints=[],this.keyframes={},this.totalKeyframes=0,this.mouseBuffer=10,this.activeJoint=null,this.bounds={min:h(),max:h()},this._moved=!1}updateBounds(){let e=Object.keys(this.keyframes),t=[],i=[];for(var n=0;n<e.length;n++)for(var r=this.keyframes[e[n]],a=0;a<r.joints.length;a++){var s=r.joints[a];if(t.push(s.position.x+u.render.joint.radius),i.push(s.position.y+u.render.joint.radius),t.push(s.position.x-u.render.joint.radius),i.push(s.position.y-u.render.joint.radius),s.skin.vertices)for(var o=0;o<s.skin.vertices.length;o++)t.push(s.skin.vertices[o].x),i.push(s.skin.vertices[o].y)}this.bounds.min.set({x:Math.min(...t),y:Math.min(...i)}),this.bounds.max.set({x:Math.max(...t),y:Math.max(...i)})}reset(){this.keyframes={},this.joints=[],this.totalKeyframes=0,this.activeJoint=null,p.graph&&(this.setKeyframe(0,{position:{x:p.graph.hatchMark.spacing/2,y:0},locked:!0,ignoreHistory:!0}),p.graph.setCurrentMark(0),p.graph.updateState()),this.updateBounds(),o.add({label:"Clear",value:this.clone(),group:"keyframe"})}clone(e){return e=e||this.keyframes,this.fromJSON(this.toJSON(e))}getKeyframe(t,i){var e=Object.values(this.keyframes).find(e=>e[t]===i);return e?this.keyframes[e.index]:null}editJoints(e){for(var t=Object.values(this.keyframes),i=0;i<t.length;i++)for(var n=t[i],r=0;r<n.joints.length;r++){var a=n.joints[r];"function"==typeof e&&e(a,n)}}editJoint(t,i,n){let r=Object.values(this.keyframes);for(var a=0;a<r.length;a++){let e=r[a].joints.find(e=>e.id===t);if(i=n?JSON.parse(JSON.stringify(i)):i,e)for(var s=Object.keys(i),o=0;o<s.length;o++)e[s[o]]=i[s[o]]}}addSubKeyframes(t,i){if(p.graph){let e=Object.keys(this.keyframes);for(var n=0;n<e.length;n++)if("sub"==this.keyframes[e[n]].type){e.splice(n,1);break}if(this.clone(),1<e.length)for(p.graph.updateState(),n=i-1;t+1<=n;n--){var r=this.clone(),a=r[i].joints,a={id:b.uid(),type:"sub",index:n,activeJointId:r.activeJointId,joints:a,render:{size:12,color:"red",position:h(n*p.graph.hatchMark.spacing+p.graph.hatchMark.spacing/2,0)}};this.keyframes[n]=a}}this.updateSubKeyframes(),p.graph.updateState(),p.graph.redraw()}updateSubKeyframes(){for(var e=Object.keys(this.keyframes),t=e.length-1;0<=t;t--){let s=this.keyframes[e[t]];if(s&&"head"!=s.type){let e=null;for(var o=s.index;0<=o;o--){var i=this.keyframes[o];if(i&&"head"==i.type){e=i.index;break}}let t=null;for(o=s.index;o<p.app.totalFrames;o++){var l=this.keyframes[o];if(l&&"head"==l.type){t=l.index;break}}let n=b.map(s.index,t,e,0,1),r=this.keyframes[t],a=this.keyframes[e];for(o=0;o<s.joints.length;o++){let i=s.joints[o];if(i){let e=r.joints.find(e=>e.id===i.id),t=a.joints.find(e=>e.id===i.id);if(e&&t){var h=e.position.copy().lerp(t.position,n),c=b.lerp(e.length,t.length,n);i.length=c,i.position.set(h),u.animateSkin&&t.skin&&e.skin&&t.skin.offset&&e.skin.offset&&(i.skin.offset={x:b.lerp(e.skin.offset.x,t.skin.offset.x,n),y:b.lerp(e.skin.offset.y,t.skin.offset.y,n),scaleX:b.lerp(e.skin.offset.scaleX,t.skin.offset.scaleX,n),scaleY:b.lerp(e.skin.offset.scaleY,t.skin.offset.scaleY,n),angle:b.lerp(e.skin.offset.angle,t.skin.offset.angle,n)});for(var d=0;d<i.children.length;d++){let e=i.children[d];e.angle=e.position.heading(i.position)}}i.id==a.activeJointId&&(s.activeJointId=i.id)}}"linear"!=u.riggingMode&&("forwardKinematics"==u.riggingMode?this.computeKinematics(s.joints):"inverseKinematics"==u.riggingMode&&this.computeKinematics(s.joints,!0)),this.updateSkin(s.joints)}}}setKeyframe(e,i){if("number"==typeof e){let n={type:"head",index:(i=i||{}).keyframe?i.keyframe.index:e,activeJointId:i.keyframe?i.keyframe.activeJointId:this.activeJoint?this.activeJoint.id:null,joints:i.joints,render:{size:u.render.keyframe.size,color:u.render.keyframe.color.default,position:i.position||h(e*p.graph.hatchMark.spacing+p.graph.hatchMark.spacing/2,0)},locked:i.locked||!1};if(p.graph){let e=this.clone()[p.graph.state.currentFrame],t=e?e.joints:[];i.joints&&(t=i.joints),n.joints=t}var t;if(n.id=i.id||b.uid(),this.keyframes[e]=n,p.graph&&(p.graph.updateState(),t=p.graph.state.currentFrame,e=p.graph.state.previousFrame,this.addSubKeyframes(e,t),p.graph.redraw()),!i.ignoreHistory){let e=Object.values(this.keyframes),t=0;for(var r=0;r<e.length;r++)"head"==e[r].type&&t++;let i="Add keyframe";return t==this.totalKeyframes&&(i="Move keyframe"),this.updateBounds(),o.add({label:i,value:this.clone(),group:"keyframe"}),this.totalKeyframes=t,n}}}deleteKeyframe(n){n=this.getKeyframe("id",n);if(n&&!(Object.keys(this.keyframes).length<=1)){let e,t,i=[];for(var r=n.index-1;0<=r;r--){var a=this.keyframes[r];if(a&&("sub"==a.type&&i.push(a),"head"==a.type)){e=a;break}}for(r=n.index+1;r<p.app.totalFrames;r++){var s=this.keyframes[r];if(s&&("sub"==s.type&&i.push(s),"head"==s.type)){t=s;break}}for(r=0;r<i.length;r++){var o=this.getKeyframe("id",i[r].id);delete this.keyframes[o.index]}delete this.keyframes[n.index],t&&e&&this.addSubKeyframes(e.index,t.index),p.graph&&(p.graph.updateState(),p.graph.redraw()),this.updateBounds()}}updateKeyframe(e,t){for(var i=Object.keys(t),n=0;n<i.length;n++)this.keyframes[e][i[n]]=t[i[n]];this.updateSubKeyframes()}addJoint(e,t,i){i=i||{},p.graph&&p.graph.setCurrentMark(p.graph.state.currentFrame,!1);let n=i.parent||this.activeJoint,r={id:"J"+b.uid(),name:"Joint "+(this.joints.length+1),position:h(e,t),positionPrev:h(e,t),angle:n?h(e,t).heading(n.position):0,parent:n||null,children:[],length:n?n.position.dist(e,t):0,hierarchy:n?n.hierarchy+1:1,skin:{},zIndex:this.joints.length+1};return n&&n.children.push(r),i.ignoreDefaults||(this.activeJoint=r),this.joints.push(r),p.graph&&this.updateKeyframe(p.graph.state.currentFrame,{activeJointId:this.activeJoint.id}),this.updateBounds(),i.ignoreHistory||o.add({label:"Add joint",value:this.clone(),group:"keyframe"}),s.emit("jointChange",this.joints),r}selectJoint(i,n){if(this.joints.length){let t=this.joints.slice();t.sort((e,t)=>e.position.dist(i,n)-t.position.dist(i,n)),this.activeJoint=this.joints.find(e=>e.id===t[0].id),s.emit("jointChange",this.joints),p.graph&&this.updateKeyframe(p.graph.state.currentFrame,{activeJointId:this.activeJoint.id})}}removeJointById(i){for(var n=Object.keys(this.keyframes),r=0;r<n.length;r++){let e=this.keyframes[n[r]],t=e.joints.find(e=>e.id===i);if(t){for(var a=0;a<t.children.length;a++){let e=t.children[a];e.parent=t.parent,e.length+=t.length,this.activeJoint=e}t.parent?(t.parent.children.splice(t.parent.children.indexOf(t),1),t.parent.children.push(...t.children),this.activeJoint=t.parent):this.activeJoint=t.children[0],e.joints.splice(e.joints.indexOf(t),1)}}this.activeJoint&&this.moveJoint(this.activeJoint.position.x,this.activeJoint.position.y),this.updateBounds(),o.add({label:"Remove joint",value:this.clone(),group:"keyframe"}),s.emit("jointChange",this.joints)}removeJointByPosition(t,i){if(this.joints.length)for(var n=0;n<this.joints.length;n++){let e=this.joints[n];e.position.dist(t,i)<u.render.joint.radius+this.mouseBuffer&&this.removeJointById(e.id)}}computeKinematics(t,e){if(e)for(i=t.length-1;0<=i;i--){let e=t[i];e.parent&&(e.parent.angle=e.position.heading(e.parent.position),e.parent.position.set({x:e.position.x+Math.cos(e.parent.angle)*e.length,y:e.position.y+Math.sin(e.parent.angle)*e.length}))}else for(var i=0;i<t.length;i++)for(var n=t[i],r=0;r<n.children.length;r++){let e=n.children[r];e.angle=e.position.heading(n.position),e.position.set({x:n.position.x-Math.cos(e.angle)*e.length,y:n.position.y-Math.sin(e.angle)*e.length})}}updateSkin(u){u=u||this.joints;for(var p=0;p<u.length;p++){let i=u[p],e=i.length,t=i.length,n=0,r=i.skin.crop,a=0,s=0;r&&(a=r.to.x-r.from.x,s=r.to.y-r.from.y),a>s?t=Number.MAX_SAFE_INTEGER:(e=Number.MAX_SAFE_INTEGER,n=Math.PI/2),i.skin.size=b.scaleSize(a,s,e,t),i.skin._sizeOriginal={width:a,height:s},i.skin.angleAuto=n;let o=0,l=0,h=1,c=1,d=0;if(i.skin.offset&&(o=i.skin.offset.x||0,l=i.skin.offset.y||0,h=i.skin.offset.scaleX||0,c=i.skin.offset.scaleY||0,d=i.skin.offset.angle||0),i.parent&&r){i.skin.position={x:(i.position.x+i.parent.position.x)/2,y:(i.position.y+i.parent.position.y)/2};var f,g,m=[{x:i.skin.position.x+o-i.skin.size.width/2,y:i.skin.position.y+l-i.skin.size.height/2},{x:i.skin.position.x+o+i.skin.size.width/2,y:i.skin.position.y+l-i.skin.size.height/2},{x:i.skin.position.x+o+i.skin.size.width/2,y:i.skin.position.y+l+i.skin.size.height/2},{x:i.skin.position.x+o-i.skin.size.width/2,y:i.skin.position.y+l+i.skin.size.height/2}];for(f of m){let e=f.x-i.skin.position.x,t=f.y-i.skin.position.y;f.x=f.x+e*(h-1),f.y=f.y+t*(c-1)}for(g of m){var y=i.angle+i.skin.angleAuto+d,v=(g.x-i.skin.position.x)*Math.cos(y)-(g.y-i.skin.position.y)*Math.sin(y),y=(g.x-i.skin.position.x)*Math.sin(y)+(g.y-i.skin.position.y)*Math.cos(y);g.x=v+i.skin.position.x,g.y=y+i.skin.position.y}i.skin.vertices=m}}}moveJoint(e,t){if(this.activeJoint){var i,n;if(p.graph&&(u.animation.autoAddKeyframe?this.activeJoint.position.equals(e,t)||(i=p.graph.state.currentMark,(n=this.keyframes[i])&&"head"==n.type||this.setKeyframe(i)):(p.graph.setCurrentMark(p.graph.state.currentFrame,!1),p.graph.updateState()),this.updateSubKeyframes()),e&&t&&(1<this.activeJoint.position.dist(this.activeJoint.positionPrev)&&(this._moved=!0,this.activeJoint.positionPrev.set(this.activeJoint.position.x,this.activeJoint.position.y)),this.activeJoint.position.set(e,t),"linear"==u.riggingMode)){this.activeJoint.parent&&(this.activeJoint.angle=this.activeJoint.position.heading(this.activeJoint.parent.position),this.activeJoint.length=this.activeJoint.position.dist(this.activeJoint.parent.position));for(var r=0;r<this.activeJoint.children.length;r++){let e=this.activeJoint.children[r];e.length=e.position.dist(this.activeJoint.position)}}"linear"!=u.riggingMode&&("forwardKinematics"==u.riggingMode?this.computeKinematics(this.joints):"inverseKinematics"==u.riggingMode&&this.computeKinematics(this.joints,!0)),this.updateSkin(),this.updateBounds()}}getJoint(t){return this.joints.find(e=>e.id===t)||null}toJSON(e,r){let t=e||this.clone(),a={},s=Object.keys(t);for(var o=0;o<s.length;o++){let i=t[s[o]],n={id:i.id,activeJointId:i.activeJointId,index:i.index,joints:[],render:i.render,type:i.type,locked:i.locked};for(var l=0;l<i.joints.length;l++){let e=i.joints[l],t={id:e.id,name:e.name,angle:e.angle,position:e.position,positionPrev:e.positionPrev,length:e.length,parent:e.parent?e.parent.id:null,hierarchy:e.hierarchy,children:[],skinImageSrc:e.skin&&!r?e.skin.imageSrc:void 0,skinCrop:e.skin?e.skin.crop:null,skinOffset:e.skin?e.skin.offset:null,skinPosition:e.skin?e.skin.position:null,skinAngleAuto:e.skin?e.skin.angleAuto:void 0,skinSize:e.skin?e.skin.size:null,_skinSizeOriginal:e.skin?e.skin._sizeOriginal:null,_vueCrop:e.skin?e.skin._vueCrop:null,zIndex:e.zIndex};for(var h=0;h<e.children.length;h++){var c=e.children[h];t.children.push(c.id)}n.joints.push(t)}a[n.index]=n}return a}fromJSON(r){if(r){let e={},t=Object.keys(r);for(var a=0;a<t.length;a++){let i=r[t[a]],n=(i.joints.find(e=>e.id===i.activeJointId),[]);for(var s=0;s<i.joints.length;s++){let e=i.joints[s],t={id:e.id,name:e.name,angle:e.angle,position:h(e.position),positionPrev:h(e.positionPrev),length:e.length,hierarchy:e.hierarchy,parent:e.parent,children:e.children.slice(),skin:{offset:e.skinOffset,crop:e.skinCrop,_vueCrop:e._vueCrop,imageSrc:e.skinImageSrc,position:e.skinPosition,angleAuto:e.angleAuto,size:e.skinSize,_sizeOriginal:e._skinSizeOriginal},zIndex:e.zIndex};n.push(t)}for(s=0;s<n.length;s++){let i=n[s];i.parent=n.find(e=>e.id===i.parent)||null;for(var o=0;o<i.children.length;o++){let t=i.children[o];i.children[o]=n.find(e=>e.id===t)||null}}var l={activeJointId:i.activeJointId,id:i.id,index:i.index,joints:n,locked:i.locked,render:i.render,type:i.type};e[i.index]=l}return e}}import(e){this.keyframes=this.clone(e);let t=Object.values(this.keyframes),i=0;for(var n=0;n<t.length;n++)"head"==t[n].type&&i++;this.totalKeyframes=i,p.graph&&((e=this.keyframes[p.graph.state.currentMark])&&(this.activeJoint=this.getKeyframe("id",e.activeJointId),this.activeJoint&&this.updateKeyframe(p.graph.state.currentFrame,{activeJointId:this.activeJoint.id})),p.graph.updateState()),this.updateSkin(),this.updateBounds(),s.emit("jointChange",this.joints)}renderTo(i,n){let r=this.keyframes[(n=n||{}).frame];if(r){n.position=n.position||{x:0,y:0};var e,a,s,o,l,h=-this.bounds.min.x+n.position.x,c=-this.bounds.min.y+n.position.y;if(r.joints.sort((e,t)=>e.zIndex-t.zIndex),n.showSkin)for(var d=0;d<r.joints.length;d++){let t=r.joints[d];if(t.parent){if(t.skin.imageSrc)if(t.skin.image){if(!t.skin.image.width){let e=new Image;e.src=t.skin.imageSrc,t.skin.image=e,this.updateSkin(),this.updateBounds()}}else{let e=new Image;e.src=t.skin.imageSrc,t.skin.image=e,this.updateSkin(),this.updateBounds()}t.skin&&"object"==typeof t.skin.image&&t.skin.image.src&&t.skin.position&&(i.save(),i.translate(t.skin.position.x+h,t.skin.position.y+c),i.rotate(t.angle+t.skin.angleAuto),t.skin.offset&&(e=t.skin.offset.x,a=t.skin.offset.y,s=t.skin.offset.scaleX,o=t.skin.offset.scaleY,l=t.skin.offset.angle,i.rotate(l),i.translate(e,a),i.scale(s,o)),i.drawImage(t.skin.image,t.skin.crop.from.x,t.skin.crop.from.y,t.skin._sizeOriginal.width,t.skin._sizeOriginal.height,-t.skin.size.width/2,-t.skin.size.height/2,t.skin.size.width,t.skin.size.height),i.restore(),t.skin.vertices||(this.updateSkin(),this.updateBounds()))}}if(n.showBones){for(d=0;d<r.joints.length;d++){var t=r.joints[d];t.parent&&(i.beginPath(),i.moveTo(t.position.x+h,t.position.y+c),i.lineTo(t.parent.position.x+h,t.parent.position.y+c),i.lineWidth=u.render.segment.width,i.lineCap="round",i.strokeStyle=u.render.segment.color,i.stroke())}for(d=0;d<r.joints.length;d++){let e=r.joints[d],t=e===this.activeJoint?u.render.joint.color.selected:u.render.joint.color.default;p.graph&&(this.activeJoint&&!p.graph.state.isPlaying&&(this.activeJoint.children.length&&(t=this.activeJoint.children.includes(e)?"#5bff85":t),this.activeJoint.parent&&(t=this.activeJoint.parent===e?"#9b68e1":t)),p.graph.state.isPlaying&&(t=u.render.joint.color.default)),i.beginPath(),i.arc(e.position.x+h,e.position.y+c,u.render.joint.radius,0,2*Math.PI),i.closePath(),i.fillStyle=n.workColor?t:u.render.joint.color.default,i.fill()}}}}render(r){if(p.graph){let e=p.graph.state.previousFrame,t=p.graph.state.currentFrame,i=p.graph.state.nextFrame,n=p.graph.state.currentMark;r.save(),r.context.globalAlpha=.1,this.renderTo(r.context,{frame:e,position:{x:this.bounds.min.x,y:this.bounds.min.y},showBones:!0}),this.renderTo(r.context,{frame:t,position:{x:this.bounds.min.x,y:this.bounds.min.y},showBones:!0}),this.renderTo(r.context,{frame:i,position:{x:this.bounds.min.x,y:this.bounds.min.y},showBones:!0}),r.restore(),this.keyframes[n]||(n=t),this.renderTo(r.context,{frame:n,position:{x:this.bounds.min.x,y:this.bounds.min.y},showBones:!0,showSkin:!0,workColor:!0})}}};s.once("loadedApps",e=>{p=e.timeline,n.setKeyframe(0,{locked:!0,ignoreHistory:!0})}),e.exports=n},function(e,t,i){const n=i(1),r=(i(3),i(0));i=new class{constructor(){this.events=[],this.present=null,this.maxStates=300,this.eventCount=0}add(e){e=e||{},this.present&&this.events.splice(0,this.events.indexOf(this.present));e={id:"E"+n.uid(),label:e.label,value:e.value,group:e.group,time:Date.now()};this.present=e,this.events.push(e),this.sortByLatest(),this.events.length>this.maxStates&&this.events.pop(),this.eventCount++,r.emit("historyChange")}sortByLatest(){this.events.sort((e,t)=>t.time-e.time)}sortByOldest(){this.events.sort((e,t)=>e.time-t.time)}getLatest(){return this.events[0]}getOldest(){return this.events[this.events.length-1]}getNext(){return this.events[this.events.indexOf(this.present)-1]||null}getPrevious(){return this.events[this.events.indexOf(this.present)+1]||null}forward(){this.present=this.getNext()}backward(){this.present=this.getPrevious()}jump(t){var e=this.events.find(e=>e.id===t);t&&(this.present=e)}};e.exports=i},function(e,t,i){"use strict";!function(a){const s=i(28),o=i(31);let l=e=>0<(e=Math.round(e))&&e<=32?e:e<=0?1:32;e.exports={parseAsync(e,t,i,n){var r=arguments;if(a.isBuffer(e)&&(e=e.toString()),r.length<2)throw new Error("Missing Callback");if("function"!=typeof r[r.length-1])throw new TypeError("Callback is not a function");if(n=r[r.length-1],t=null,i=1,2<r.length){let e=1;"function"==typeof r[e]&&(t=r[e++]),"number"==typeof r[e]&&(i=l(r[e]))}return s.parseWrapper(e,t,i,n)},stringifyAsync(e,t,i,n,r){var a,s=arguments;if("function"!=typeof s[s.length-1])throw new TypeError("Callback is not a function");if(r=s[s.length-1],t=null,n=1,2<s.length){let e=1;"function"!=typeof s[e]&&"object"!=typeof s[e]||(t=s[e++]),"number"!=typeof s[e]&&"string"!=typeof s[e]||"number"!=typeof s[e++]||(i="number"==typeof(a=s[e++])?1<=(a=Math.round(a))&&a<=10?a:a<1?0:10:a.length<=10?a:a.substr(0,9)),"number"==typeof s[e]&&(n=l(s[e]))}return o.stringifyWrapper(e,t,i,n,r)}}}.call(this,i(24).Buffer)},function(e,r,a){!function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}r.setTimeout=function(){return new n(i.call(setTimeout,t,arguments),clearTimeout)},r.setInterval=function(){return new n(i.call(setInterval,t,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(t,this._id)},r.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},r.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},r._unrefActive=r.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a(29),r.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,r.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}.call(this,a(6))},function(e,pe,t){!function(e,t){var f="[object Arguments]",g="[object Function]",m="[object GeneratorFunction]",y="[object Map]",v="[object Set]",b=/\w*$/,i=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,x={};x[f]=x["[object Array]"]=x["[object ArrayBuffer]"]=x["[object DataView]"]=x["[object Boolean]"]=x["[object Date]"]=x["[object Float32Array]"]=x["[object Float64Array]"]=x["[object Int8Array]"]=x["[object Int16Array]"]=x["[object Int32Array]"]=x[y]=x["[object Number]"]=x["[object Object]"]=x["[object RegExp]"]=x[v]=x["[object String]"]=x["[object Symbol]"]=x["[object Uint8Array]"]=x["[object Uint8ClampedArray]"]=x["[object Uint16Array]"]=x["[object Uint32Array]"]=!0,x["[object Error]"]=x[g]=x["[object WeakMap]"]=!1;var n="object"==typeof e&&e&&e.Object===Object&&e,r="object"==typeof self&&self&&self.Object===Object&&self,a=n||r||Function("return this")(),s=pe&&!pe.nodeType&&pe,o=s&&"object"==typeof t&&t&&!t.nodeType&&t,l=o&&o.exports===s;function k(e,t){return e.set(t[0],t[1]),e}function w(e,t){return e.add(t),e}function S(e,t,i,n){var r=-1,a=e?e.length:0;for(n&&a&&(i=e[++r]);++r<a;)i=t(i,e[r],r,e);return i}function E(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function j(e){var i=-1,n=Array(e.size);return e.forEach(function(e,t){n[++i]=[t,e]}),n}function h(t,i){return function(e){return t(i(e))}}function A(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}var e=Array.prototype,n=Function.prototype,d=Object.prototype,r=a["__core-js_shared__"],u=(o=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"",p=n.toString,C=d.hasOwnProperty,M=d.toString,T=RegExp("^"+p.call(C).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),s=l?a.Buffer:void 0,r=a.Symbol,_=a.Uint8Array,I=h(Object.getPrototypeOf,Object),q=Object.create,F=d.propertyIsEnumerable,B=e.splice,o=Object.getOwnPropertySymbols,n=s?s.isBuffer:void 0,P=h(Object.keys,Object),l=te(a,"DataView"),z=te(a,"Map"),e=te(a,"Promise"),s=te(a,"Set"),a=te(a,"WeakMap"),O=te(Object,"create"),R=ae(l),J=ae(z),H=ae(e),L=ae(s),D=ae(a),r=r?r.prototype:void 0,N=r?r.valueOf:void 0;function K(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function U(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Y(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function W(e){this.__data__=new U(e)}function $(e,t){var i,n,r,a,s,o=oe(e)||(n=i=e)&&"object"==typeof n&&le(n)&&C.call(i,"callee")&&(!F.call(i,"callee")||M.call(i)==f)?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],l=o.length,h=!!l;for(r in e)!t&&!C.call(e,r)||h&&("length"==r||(a=r,s=l,!!(s=null==s?9007199254740991:s)&&("number"==typeof a||c.test(a))&&-1<a&&a%1==0&&a<s))||o.push(r);return o}function X(e,t,i){var n=e[t];C.call(e,t)&&se(n,i)&&(void 0!==i||t in e)||(e[t]=i)}function V(e,t){for(var i=e.length;i--;)if(se(e[i][0],t))return i;return-1}function G(a,s,o,l,e,t,h){var c;if(void 0!==(c=l?t?l(a,e,t,h):l(a):c))return c;if(!de(a))return a;var i,n=oe(a);if(n){if(e=(i=a).length,r=i.constructor(e),e&&"string"==typeof i[0]&&C.call(i,"index")&&(r.index=i.index,r.input=i.input),c=r,!s)return function(e,t){var i=-1,n=e.length;for(t=t||Array(n);++i<n;)t[i]=e[i];return t}(a,c)}else{var d=ne(a),r=d==g||d==m;if(he(a))return function(e){if(s)return e.slice();var t=new e.constructor(e.length);return e.copy(t),t}(a);if("[object Object]"==d||d==f||r&&!t){if(E(a))return t?a:{};if(c="function"!=typeof(r=r?{}:a).constructor||re(r)?{}:de(r=I(r))?q(r):{},!s)return r=a,p=(p=c)&&Q(a,ue(a),p),Q(r,ie(r),p)}else{if(!x[d])return t?a:{};c=function(e,t,i){var n,r,a,s,o=e.constructor;switch(d){case"[object ArrayBuffer]":return Z(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return a=e,s=i?Z(a.buffer):a.buffer,new a.constructor(s,a.byteOffset,a.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s=e,a=i?Z(s.buffer):s.buffer,new s.constructor(a,s.byteOffset,s.length);case y:return r=e,S(i?t(j(r),!0):j(r),k,new r.constructor);case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return(n=new(r=e).constructor(r.source,b.exec(r))).lastIndex=r.lastIndex,n;case v:return n=e,S(i?t(A(n),!0):A(n),w,new n.constructor);case"[object Symbol]":return N?Object(N.call(e)):{}}}(a,G,s)}}var u,p=(h=h||new W).get(a);return p||(h.set(a,c),function(e){for(var t,i,n=-1,r=e?e.length:0;++n<r&&!1!==(t=e[n],i=n,u&&(t=a[i=t]),void X(c,i,G(t,s,o,l,i,a,h))););}((u=!n?o?(t=ie,n=ue(p=a),oe(p)?n:function(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}(n,t(p))):ue(a):u)||a),c)}function Z(e){var t=new e.constructor(e.byteLength);return new _(t).set(new _(e)),t}function Q(e,t,i,n){i=i||{};for(var r=-1,a=t.length;++r<a;){var s=t[r],o=n?n(i[s],e[s],s,i,e):void 0;X(i,s,void 0===o?e[s]:o)}return i}function ee(e,t){var i=e.__data__;return("string"==(e=typeof t)||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t)?i["string"==typeof t?"string":"hash"]:i.map}function te(e,t){e=null==e?void 0:e[t];return!de(t=e)||u&&u in t||!(ce(t)||E(t)?T:i).test(ae(t))?void 0:e}K.prototype.clear=function(){this.__data__=O?O(null):{}},K.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},K.prototype.get=function(e){var t=this.__data__;if(O){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return C.call(t,e)?t[e]:void 0},K.prototype.has=function(e){var t=this.__data__;return O?void 0!==t[e]:C.call(t,e)},K.prototype.set=function(e,t){return this.__data__[e]=O&&void 0===t?"__lodash_hash_undefined__":t,this},U.prototype.clear=function(){this.__data__=[]},U.prototype.delete=function(e){var t=this.__data__,e=V(t,e);return!(e<0||(e==t.length-1?t.pop():B.call(t,e,1),0))},U.prototype.get=function(e){var t=this.__data__,e=V(t,e);return e<0?void 0:t[e][1]},U.prototype.has=function(e){return-1<V(this.__data__,e)},U.prototype.set=function(e,t){var i=this.__data__,n=V(i,e);return n<0?i.push([e,t]):i[n][1]=t,this},Y.prototype.clear=function(){this.__data__={hash:new K,map:new(z||U),string:new K}},Y.prototype.delete=function(e){return ee(this,e).delete(e)},Y.prototype.get=function(e){return ee(this,e).get(e)},Y.prototype.has=function(e){return ee(this,e).has(e)},Y.prototype.set=function(e,t){return ee(this,e).set(e,t),this},W.prototype.clear=function(){this.__data__=new U},W.prototype.delete=function(e){return this.__data__.delete(e)},W.prototype.get=function(e){return this.__data__.get(e)},W.prototype.has=function(e){return this.__data__.has(e)},W.prototype.set=function(e,t){var i=this.__data__;if(i instanceof U){var n=i.__data__;if(!z||n.length<199)return n.push([e,t]),this;i=this.__data__=new Y(n)}return i.set(e,t),this};var ie=o?h(o,Object):function(){return[]},ne=function(e){return M.call(e)};function re(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||d)}function ae(e){if(null!=e){try{return p.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function se(e,t){return e===t||e!=e&&t!=t}(l&&"[object DataView]"!=ne(new l(new ArrayBuffer(1)))||z&&ne(new z)!=y||e&&"[object Promise]"!=ne(e.resolve())||s&&ne(new s)!=v||a&&"[object WeakMap]"!=ne(new a))&&(ne=function(e){var t=M.call(e),e="[object Object]"==t?e.constructor:void 0,e=e?ae(e):void 0;if(e)switch(e){case R:return"[object DataView]";case J:return y;case H:return"[object Promise]";case L:return v;case D:return"[object WeakMap]"}return t});var oe=Array.isArray;function le(e){return null!=e&&("number"==typeof(t=e.length)&&-1<t&&t%1==0&&t<=9007199254740991)&&!ce(e);var t}var he=n||function(){return!1};function ce(e){e=de(e)?M.call(e):"";return e==g||e==m}function de(e){var t=typeof e;return e&&("object"==t||"function"==t)}function ue(e){return(le(e)?$:function(e){if(!re(e))return P(e);var t,i=[];for(t in Object(e))C.call(e,t)&&"constructor"!=t&&i.push(t);return i})(e)}t.exports=function(e){return G(e,!0,!0)}}.call(this,t(6),t(38)(e))},function(e,t,i){const n=i(13),r=i(9),a=i(3),s=i(1),o=i(7),l=new Vue({el:"#contextMenuApp",data:{selectedKeyframe:null,hidden:!0,position:{x:0,y:0},width:document.getElementById("contextMenuApp").offsetWidth,height:document.getElementById("contextMenuApp").offsetHeight},methods:{show:function(e,t){this.hidden=!1,this.$nextTick(()=>{this.width=this.$el.offsetWidth,this.height=this.$el.offsetHeight,this.position.x=e,this.position.y=t,this.$el.style.left=this.position.x+"px",this.$el.style.top=this.position.y+"px"})},hide:function(){this.hidden=!0},copy:function(){r.copiedKeyframe=n(r.getKeyframe("selected",!0))},paste:function(){var e=i(4),t=r.copiedKeyframe;t&&r.setKeyframe(e.graph.state.currentMark,{position:o(e.graph.state.currentMark*e.graph.hatchMark.spacing+e.graph.hatchMark.spacing/2,a.render.keyframe.y),locked:0==e.graph.state.currentMark,id:s.uid(),joints:t.joints})}}});window.contextMenuApp=l,e.exports=l},function(e,t,i){const s=i(0),n=(i(1),i(2));var o,a,i=new Vue({el:"#overlayApp",data:{hidden:!0,closeMsg:"Close"},methods:{show:function(){this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",n.query("#overlayApp .drag").draggable({restrict:!0,root:this.$el}),s.emit("renderSleep")})},hide:function(){var e;a=o=void 0,document.getElementById("overlayFilename").innerText="Choose a file...";for(e of document.querySelectorAll("#overlayApp .section.disabled"))e.classList.add("disabled");document.getElementById("addOverlay").classList.add("disabled"),this.hidden=!0,s.emit("renderFocus")},validateFormat:function(e){e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e)},validateAmount:function(e){this.validateMin(e),this.validateMax(e)},validateMax:function(e){let t=e.target.value,i=e.target.dataset.max;"number"==typeof a&&("overlayStart"==e.target.id&&(i=a),"overlayEnd"==e.target.id&&(i=a)),parseInt(t)>i&&(e.target.value=i.toString())},validateMin:function(e){let t=e.target.value,i=e.target.dataset.min;"overlayEnd"==e.target.id&&(i=parseInt(document.getElementById("overlayStart").value)),parseInt(t)<i&&(e.target.value=i.toString())},toggleAmount:function(i){if(i.target==document.activeElement){i.target.value.length||(i.target.value=1);let e=i.wheelDeltaY<0,t=parseInt(i.target.value);e?t--:t++,i.target.value=t.toString(),this.validateAmount(i)}},checkFile:function(){let e=document.getElementById("overlayInput"),t=document.getElementById("overlayFilename"),i=e.files[0];if(i){t.innerText=i.name;var n,r=URL.createObjectURL(i);if(r){o=r;const e=document.createElement("video");e.crossOrigin="anonymous",e.controls=!0,e.muted=!0,e.src=r,e.load(),e.addEventListener("loadedmetadata",()=>{a=e.duration,e.remove()});for(n of document.querySelectorAll("#overlayApp .section.disabled"))n.classList.remove("disabled");document.getElementById("addOverlay").classList.remove("disabled")}}},validate:function(){if(o){let e=document.getElementById("overlayFrameCount").value,t=document.getElementById("overlayFrameRate").value,i=document.getElementById("overlayStart").value,n=document.getElementById("overlayEnd").value,r=document.getElementById("overlayQuality").value;e=e.length?parseInt(e):void 0,t=t.length?parseInt(t):void 0,i=i.length?parseInt(i):void 0,n=n.length?parseInt(n):void 0,r=r.length?parseInt(r)/100:void 0;var a={frameCount:e,frameRate:t,start:i,end:n,quality:r};s.emit("extractFrames",o,a),this.hide()}}}});e.exports=i},function(e,t,i){const n=i(0),h=i(5),c=i(3),d=i(1),r=i(4),a=i(2);let u,p=-Math.PI,f=Math.PI,s=[];const g=new Vue({el:"#overlayConfigApp",data:{hidden:!0,closeMsg:"Close",opacity:1,scale:1,angle:0,trimStart:1,trimEnd:r.app.totalFrames,start:1},methods:{fixData:function(){var e=document.getElementById("overlayConfigTrimStart"),t=document.getElementById("overlayConfigTrimEnd"),i=document.getElementById("overlayConfigStart"),e=parseInt(e.value),t=parseInt(t.value),i=parseInt(i.value);this.trimStart=e||1,this.trimEnd=t||s.length,this.start=i||1},validateFormat:function(e){e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e),this.fixData()},validateAmount:function(e){this.validateMin(e),this.validateMax(e)},validateMax:function(e){let t=e.target.value,i=e.target.dataset.max;"overlayConfigTrimStart"==e.target.id&&(i=this.trimEnd),"overlayConfigTrimEnd"==e.target.id&&(i=s.length),"overlayConfigStart"==e.target.id&&(i=r.app.totalFrames),parseInt(t)>i&&(e.target.value=i.toString()),this.fixData()},validateMin:function(e){let t=e.target.value,i=e.target.dataset.min;"overlayConfigTrimEnd"==e.target.id&&(i=this.trimStart),parseInt(t)<i&&(e.target.value=i.toString()),this.fixData()},toggleAmount:function(i){if(i.target==document.activeElement){i.target.value.length||(i.target.value=1);let e=i.wheelDeltaY<0,t=parseInt(i.target.value);e?t--:t++,i.target.value=t.toString(),this.validateAmount(i),this.fixData()}},updateSliders:function(){for(var o=document.querySelectorAll(".slider-wrapper"),l=0;l<o.length;l++){let e,t,i,n=o[l],r=n.querySelector(".handle"),a=r.getBoundingClientRect(),s=n.querySelector(".track").getBoundingClientRect().width-a.width;"opacity"==n.dataset.label?(e=0,t=1,i=this.opacity):"scale"==n.dataset.label?(e=0,t=6,i=this.scale):"rotate"==n.dataset.label&&(e=p,t=f,i=this.angle),r.style.left=d.map(i,e,t,0,s)+"px",n.onmousemove=()=>{h.dragged&&!u&&(u=n)},n.onmousedown=()=>{u=n}}var e={opacity:this.opacity,scale:this.scale,angle:this.angle};localStorage.setItem(c.autosave.label+".overlay.config",JSON.stringify(e))},show:function(){this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",a.query("#overlayConfigApp .drag").draggable({restrict:!0,root:this.$el}),n.emit("renderSleep");let e=document.getElementById("overlayConfigTrimStart"),t=document.getElementById("overlayConfigTrimEnd"),i=document.getElementById("overlayConfigStart");e.value=this.trimStart,t.value=this.trimEnd,i.value=this.start,this.updateSliders(),this.fixData()})},hide:function(){n.emit("renderFocus"),this.hidden=!0},reset:function(){this.opacity=1,this.scale=1,this.angle=0;let e=document.getElementById("overlayConfigTrimStart"),t=document.getElementById("overlayConfigTrimEnd"),i=document.getElementById("overlayConfigStart");e.value=1,t.value=s.length,i.value=1,this.fixData(),this.updateSliders()},removeOverlay:function(){confirm("Are you sure you want to remove the overlay?")&&(n.emit("removeOverlay"),this.hide())}}});function o(){if(u){let e,t,i,n=u.querySelector(".handle"),r=n.getBoundingClientRect(),a=u.querySelector(".track").getBoundingClientRect(),s=a.width-r.width,o=h.x-a.x-r.width/2;o=d.clamp(o,0,s),n.style.left=o+"px","opacity"==u.dataset.label?(e=0,t=1,i="opacity"):"scale"==u.dataset.label?(e=0,t=6,i="scale"):"rotate"==u.dataset.label&&(e=p,t=f,i="angle");var l=d.map(o,0,s,e,t);g[i]=l;l={opacity:g.opacity,scale:g.scale,angle:g.angle};localStorage.setItem(c.autosave.label+".overlay.config",JSON.stringify(l))}}n.on("overlayFrames",e=>{s=e,g.trimEnd=s.length}),d.loadJSONData(c.autosave.label+".overlay.config",e=>{"number"==typeof e.opacity&&(g.opacity=e.opacity),"number"==typeof e.scale&&(g.scale=e.scale),"number"==typeof e.angle&&(g.angle=e.angle),g.updateSliders()}),h.on("mouseup",function(e){u=null}),h.on("mousedown",function(e){o()}),h.on("mousemove",function(e){h.dragged&&o()}),e.exports=g},function(e,t,i){const n=i(0),r=i(8),a=i(2),s=new Vue({el:"#saveApp",data:{hidden:!0,closeMsg:"Close",defaultTitle:r.generate()},methods:{show:function(){this.defaultTitle=r.generate(),this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",a.query("#saveApp .drag").draggable({restrict:!0,root:this.$el}),setTimeout(()=>{document.getElementById("saveFilename").focus()},100),n.emit("renderSleep")})},hide:function(){this.hidden=!0,n.emit("renderFocus")},checkFilename:function(e){let t=document.getElementById("download");e.target.value.length?t.classList.remove("disabled"):t.classList.add("disabled")},validate:function(){var e=document.getElementById("saveFilename").value;e.length&&n.emit("saveProject",e)}}});e.exports=s},function(e,t,i){const s=i(11),n=i(0),o=i(2);var l,i=new Vue({el:"#loadApp",data:{hidden:!0,closeMsg:"Close",errorMessage:"",fileError:!1},methods:{show:function(){this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",o.query("#loadApp .drag").draggable({restrict:!0,root:this.$el}),n.emit("renderSleep")})},hide:function(){l=void 0,n.emit("renderFocus"),o.query("#import").addClass("disabled"),this.fileError=!1,this.hidden=!0},checkFile:function(){let e=o.query("#importInput"),i=o.query("#loadFilename"),n=e.node.files[0];if(n){let e=n.name,t=e.split(".")[e.split(".").length-1],r=o.query("#import");var a;r.addClass("disabled"),r.text("Processing...",!0),"rigme"==t&&(i.text(e,!0),(a=URL.createObjectURL(n))&&fetch(a).then(e=>{e.text().then(e=>{let i,n=!1;try{s.parseAsync(e,(e,t)=>{e?n=!0:(i=t,n=!1,l=i,r.text("Load",!0),r.removeClass("disabled"),this.fileError=!1)})}catch(e){r.addClass("disabled"),this.errorMessage="This file is corrupted.",this.fileError=!0}})}))}},validate:function(){l&&(n.emit("loadProject",l),this.hide())}}});e.exports=i},function(e,t,i){const c=i(0),d=i(1),u=i(2),s=i(4),o=i(8),n=new Vue({el:"#spritesheetExportApp",data:{hidden:!0},methods:{show:function(){this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",u.query("#spritesheetExportApp .drag").draggable({restrict:!0,root:this.$el}),u.query("#spritesheetExportApp .custom-checkbox",!0).on("click",e=>{u.query(e.target).query(".checkbox").toggleClass("checked")}),u.query("#spritesheetName").value(o.generate());let e=s.graph.playbackHandle.start.mark+1,t=s.graph.playbackHandle.end.mark+1,i=rigModel.bounds,n=i.max.x-i.min.x,r=i.max.y-i.min.y,a=Math.ceil(Math.sqrt(t-e));u.query("#spritesheetStart").value(e),u.query("#spritesheetEnd").value(t),u.query("#spritesheetCellWidth").value(n.toFixed(2)),u.query("#spritesheetCellHeight").value(r.toFixed(2)),u.query("#spritesheetRowCount").value(a),setTimeout(()=>{document.getElementById("spritesheetName").focus()},100),c.emit("renderSleep")})},hide:function(){this.hidden=!0,c.emit("renderFocus")},validateFormat:function(e){e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e)},validateAmount:function(e){this.validateMin(e),this.validateMax(e)},validateMax:function(e){let t=e.target.value,i=e.target.dataset.max;"spritesheetRowCount"==e.target.id&&(i=parseInt(u.query("#spritesheetEnd").value())-parseInt(u.query("#spritesheetStart").value())+1),"spritesheetStart"==e.target.id&&(i=parseInt(u.query("#spritesheetEnd").value())),"spritesheetEnd"==e.target.id&&(i=s.app.totalFrames),parseInt(t)>i&&(e.target.value=i.toString())},validateMin:function(e){let t=e.target.value,i=e.target.dataset.min;"spritesheetEnd"==e.target.id&&(i=parseInt(u.query("#spritesheetStart").value())),parseInt(t)<i&&(e.target.value=i.toString())},toggleAmount:function(i){if(i.target==document.activeElement){i.target.value.length||(i.target.value=1);let e=i.wheelDeltaY<0,t=parseFloat(i.target.value);e?t--:t++,"spritesheetCellWidth"!=i.target.id&&"spritesheetCellHeight"!=i.target.id||(t=t.toFixed(2)),i.target.value=t.toString(),this.validateAmount(i)}},validate:function(){var e=u.query("#spritesheetName").value(),t=parseInt(u.query("#spritesheetStart").value()),i=parseInt(u.query("#spritesheetEnd").value()),n=i-t+1,r=parseFloat(u.query("#spritesheetCellWidth").value()),a=parseFloat(u.query("#spritesheetCellHeight").value()),s=parseInt(u.query("#spritesheetRowCount").value()),o=u.query("#spritesheetShowSkin").query(".checkbox").hasClass("checked"),l=u.query("#spritesheetShowBones").query(".checkbox").hasClass("checked"),h=Math.ceil(n/s);c.emit("exportSpritesheet",{name:e.length?e:d.uid(),start:t,end:i,totalFrames:n,cellWidth:r,cellHeight:a,rows:s,cols:h,showSkin:o,showBones:l})}}});e.exports=n},function(e,t,i){const l=i(0),h=i(1),c=i(2),a=i(4),s=i(8),n=new Vue({el:"#framesExportApp",data:{hidden:!0},methods:{show:function(){this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",c.query("#framesExportApp .drag").draggable({restrict:!0,root:this.$el}),c.query("#framesExportApp .custom-checkbox",!0).on("click",e=>{c.query(e.target).query(".checkbox").toggleClass("checked")}),c.query("#framesExportName").value(s.generate());let e=a.graph.playbackHandle.start.mark+1,t=a.graph.playbackHandle.end.mark+1,i=rigModel.bounds,n=i.max.x-i.min.x,r=i.max.y-i.min.y;c.query("#framesExportStart").value(e),c.query("#framesExportEnd").value(t),c.query("#framesExportWidth").value(n.toFixed(2)),c.query("#framesExportHeight").value(r.toFixed(2)),setTimeout(()=>{document.getElementById("framesExportName").focus()},100),l.emit("renderSleep")})},hide:function(){this.hidden=!0,l.emit("renderFocus")},validateFormat:function(e){e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e)},validateAmount:function(e){this.validateMin(e),this.validateMax(e)},validateMax:function(e){let t=e.target.value,i=e.target.dataset.max;"framesExportStart"==e.target.id&&(i=parseInt(c.query("#framesExportEnd").value())),"framesExportEnd"==e.target.id&&(i=a.app.totalFrames),parseInt(t)>i&&(e.target.value=i.toString())},validateMin:function(e){let t=e.target.value,i=e.target.dataset.min;"framesExportEnd"==e.target.id&&(i=parseInt(c.query("#framesExportStart").value())),parseInt(t)<i&&(e.target.value=i.toString())},toggleAmount:function(i){if(i.target==document.activeElement){i.target.value.length||(i.target.value=1);let e=i.wheelDeltaY<0,t=parseFloat(i.target.value);e?t--:t++,"framesExportWidth"!=i.target.id&&"framesExportHeight"!=i.target.id||(t=t.toFixed(2)),i.target.value=t.toString(),this.validateAmount(i)}},validate:function(){var e=c.query("#framesExportName").value(),t=parseInt(c.query("#framesExportStart").value()),i=parseInt(c.query("#framesExportEnd").value()),n=i-t+1,r=parseFloat(c.query("#framesExportWidth").value()),a=parseFloat(c.query("#framesExportHeight").value()),s=c.query("#framesExportShowSkin").query(".checkbox").hasClass("checked"),o=c.query("#framesExportShowBones").query(".checkbox").hasClass("checked");l.emit("exportFrames",{name:e.length?e:h.uid(),start:t,end:i,totalFrames:n,frameWidth:r,frameHeight:a,showSkin:s,showBones:o})}}});e.exports=n},function(e,t,i){const h=i(0),c=i(1),d=i(2),a=i(4),s=i(8),n=new Vue({el:"#GIFExportApp",data:{hidden:!0},methods:{show:function(){this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",d.query("#GIFExportApp .drag").draggable({restrict:!0,root:this.$el}),d.query("#GIFExportApp .custom-checkbox",!0).on("click",e=>{d.query(e.target).query(".checkbox").toggleClass("checked")}),d.query("#GIFExportName").value(s.generate());let e=a.graph.playbackHandle.start.mark+1,t=a.graph.playbackHandle.end.mark+1,i=rigModel.bounds,n=i.max.x-i.min.x,r=i.max.y-i.min.y;d.query("#GIFExportStart").value(e),d.query("#GIFExportEnd").value(t),d.query("#GIFExportWidth").value(n.toFixed(2)),d.query("#GIFExportHeight").value(r.toFixed(2)),setTimeout(()=>{document.getElementById("GIFExportName").focus()},100),h.emit("renderSleep")})},hide:function(){this.hidden=!0,h.emit("renderFocus")},validateFormat:function(e){e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),this.validateMax(e)},validateAmount:function(e){this.validateMin(e),this.validateMax(e)},validateMax:function(e){let t=e.target.value,i=e.target.dataset.max;"GIFExportStart"==e.target.id&&(i=parseInt(d.query("#GIFExportEnd").value())),"GIFExportEnd"==e.target.id&&(i=a.app.totalFrames),parseInt(t)>i&&(e.target.value=i.toString())},validateMin:function(e){let t=e.target.value,i=e.target.dataset.min;"GIFExportEnd"==e.target.id&&(i=parseInt(d.query("#GIFExportStart").value())),parseInt(t)<i&&(e.target.value=i.toString())},toggleAmount:function(i){if(i.target==document.activeElement){i.target.value.length||(i.target.value=1);let e=i.wheelDeltaY<0,t=parseFloat(i.target.value);e?t--:t++,"GIFExportWidth"!=i.target.id&&"GIFExportHeight"!=i.target.id||(t=t.toFixed(2)),i.target.value=t.toString(),this.validateAmount(i)}},validate:function(){var e=d.query("#GIFExportName").value(),t=parseInt(d.query("#GIFExportStart").value()),i=parseInt(d.query("#GIFExportEnd").value()),n=i-t+1,r=parseFloat(d.query("#GIFExportWidth").value()),a=parseFloat(d.query("#GIFExportHeight").value()),s=d.query("#GIFExportBackground").value(),o=d.query("#GIFExportShowSkin").query(".checkbox").hasClass("checked"),l=d.query("#GIFExportShowBones").query(".checkbox").hasClass("checked");h.emit("exportGIF",{name:e.length?e:c.uid(),start:t,end:i,totalFrames:n,width:r,height:a,showSkin:o,showBones:l,background:s})}}});e.exports=n},function(e,t,i){const u=i(23),l=i(11),p=i(32),f=i(2),o=i(0),n=i(7),r=(i(35),i(5)),a=i(36),h=i(1),g=i(3),m=i(37),y=i(9),c=i(10),d=i(43);o.emit("loadedApps",m),window.rigModel=y;let s,v,b=[],x=!1,k=null,w=g.world.zoom,S=n(),E=n(),j=n(),A={pan:"pan",select:"select",add:"add",move:"move",remove:"remove"},C={KeyQ:A.pan,KeyW:A.select,KeyE:A.move,KeyR:A.add,KeyT:A.remove},M={},T=A.pan;M.add="assets/svg/joint-plus.svg",M.select="assets/svg/joint-click.svg",M.move="assets/svg/joint-arrow.svg",M.remove="assets/svg/joint-trash.svg",M.pan="assets/svg/quad-arrow.svg";const _={add:f.query("#addJoint"),select:f.query("#selectJoint"),move:f.query("#moveJoint"),remove:f.query("#removeJoint"),pan:f.query("#panCamera")},I=Object.keys(_);function q(e){T=e,y.action=e,f.query("#toolApp button",!0).removeClass("active-tool"),f.query(_[e].node).addClass("active-tool"),W.query("img").prop("src",M[e])}for(let e of I)_[e].on("click",()=>{q(A[e])});i=e=>e.preventDefault();f.query(document).on("contextmenu",i),f.query("div",!0).on("drag",i),f.query("div",!0).on("dragstart",i);const F=f.query("#materialApp"),B=f.query("#propertyApp #materials");function P(e){const i=h.uid();let t=URL.createObjectURL(e),n=f.create("button"),r=n.create("img");n.addClass("item"),r.attr("src",t),n.node.addEventListener("click",()=>{var t,e;t=i,(e=b.find(e=>e.id===t))&&(B.value(e.src),B.query("label",!0).text(e.file.name,!0),o.emit("materialChange",B.value()))}),F.append(n);let a=B.query(".options").create("p");return a.node.dataset.value=t,a.node.dataset.parentId="#materials",a.text(e.name),F.node.scrollTop=F.node.scrollHeight,{id:i,file:e,src:t,el:n}}function z(i){const n=["image/gif","image/jpeg","image/png","image/svg+xml"];for(var r=0;r<i.length;r++){let e,t=i[r];for(var a,s=0;s<b.length;s++){var o=b[s];if(o.file.name==t.name&&o.file.lastModified==t.lastModified&&o.file.size==t.size&&o.file.type==t.type){e=o;break}}n.includes(t.type)&&(a=P(t),b.push(a)),e&&e.el.remove()}}let O=f.query(".checkbox.checked",!0);for(var R=0;R<O.elements.length;R++)O.elements[R].node.parentNode.checked=!0;f.query(".custom-checkbox",!0).on("click",e=>{let t=f.query(e.target).query(".checkbox");t.toggleClass("checked"),f.query(e.target).prop("checked",t.hasClass("checked")),"animateSkin"==e.target.id&&(g.animateSkin=t.hasClass("checked"))});const J=f.query("#selectOptions");J.on("mousedown",e=>{let t=e.target.dataset.value,i=e.target.dataset.parentId,n=f.query(i);n.value(t),n.query("label").text(e.target.innerText,!0),"#materials"==i&&o.emit("materialChange",t)}),f.query("#propertyApp").on("mousewheel",()=>{J.css("display","none")}),f.query(".custom-select",!0).on("mouseup",e=>{let t=f.query(e.target,!0).query(".options");var i,n;J.html(t.html(),!0),"flex"!=J.node.style.display?(n=(i=t.node.parentNode.getBoundingClientRect()).x,e=i.y+i.height+5,J.css({display:"flex",left:n+"px",top:e+"px",width:i.width+"px"}),e+(e=J.node.getBoundingClientRect()).height>=innerHeight&&J.css("top",i.y-e.height-5+"px"),n+e.width>=innerWidth&&J.css("left",i.x-e.width+i.width+"px")):J.css("display","none")}),F.on("drop",e=>{e.preventDefault(),z(e.dataTransfer.files),f.query("#dropIcon").css("visibility","hidden")});const H=f.query("#addMaterial");H.on("change",()=>{z(H.node.files)}),F.on("dragenter",e=>{f.query("#dropIcon").css("visibility","visible")}),F.on("dragleave",e=>{f.query("#dropIcon").css("visibility","hidden")}),F.on("dragover",e=>{e.preventDefault()}),F.on("mousedown",e=>{for(var t=0;t<F.node.children.length;t++)F.node.children[t].classList.remove("selected")});let L=[];o.on("saveProject",i=>{let n=f.query("#download");n.addClass("disabled"),n.text("Processing...",!0);let e=y.toJSON(null,!0),t={frameCount:m.timeline.app.totalFrames,animationSpeed:m.timeline.app.animationSpeed,start:m.timeline.graph.playbackHandle.start.mark,end:m.timeline.graph.playbackHandle.end.mark,overlay:{opacity:m.overlayConfigApp.opacity,scale:m.overlayConfigApp.scale,angle:m.overlayConfigApp.angle,trimStart:m.overlayConfigApp.trimStart,trimEnd:m.overlayConfigApp.trimEnd,start:m.overlayConfigApp.start}},r=[];for(var a=0;a<L.length;a++){var s=L[a];r.push(s.src)}var o={model:e,config:t,overlay:r};l.stringifyAsync(o,(e,t)=>{try{(new TextEncoder).encode(t);const n=u.createWriteStream(i+".rigme");new Response(t).body.pipeTo(n).then(e=>{},e=>{console.warn(e)})}catch(e){console.warn(e)}f.query("#download").removeClass("disabled"),n.text("Save",!0)})}),window.onunload=()=>{writableStream.abort()},o.on("loadProject",i=>{var e;if(i.model?(e=y.fromJSON(i.model),y.reset(),y.import(e)):console.warn("Couldn't load model."),i.config?("number"==typeof i.config.frameCount&&(document.getElementById("frameCount").value=i.config.frameCount),"number"==typeof i.config.animationSpeed&&(document.getElementById("animationSpeed").value=i.config.animationSpeed),m.timeline.app.fixData(),"number"==typeof i.config.start&&(m.timeline.graph.playbackHandle.start.mark=i.config.start),"number"==typeof i.config.end&&(m.timeline.graph.playbackHandle.end.mark=i.config.end),m.timeline.graph.redraw(),"number"==typeof i.config.overlay.opacity&&(m.overlayConfigApp.opacity=i.config.overlay.opacity),"number"==typeof i.config.overlay.scale&&(m.overlayConfigApp.scale=i.config.overlay.scale),"number"==typeof i.config.overlay.angle&&(m.overlayConfigApp.angle=i.config.overlay.angle),m.overlayConfigApp.updateSliders(),"number"==typeof i.config.overlay.trimStart&&(m.overlayConfigApp.trimStart=i.config.overlay.trimStart),"number"==typeof i.config.overlay.trimEnd&&(m.overlayConfigApp.trimEnd=i.config.overlay.trimEnd),"number"==typeof i.config.overlay.start&&(m.overlayConfigApp.start=i.config.overlay.start)):console.warn("Couldn't load configurations."),i.overlay){if(0<i.overlay.length){L=[],m.optionApp.overlayConfigHidden=!1;for(var n=0;n<i.overlay.length;n++){let e=i.overlay[n],t=new Image;t.src=e,L.push(t)}}}else console.warn("Couldn't load overlay.");c.add({label:"Load",value:y.clone(),group:"keyframe"})}),o.on("extractFrames",(e,t)=>{L=[];let i=document.getElementById("progressBarWrapper");i.style.display="flex";let n,r,a=document.getElementById("progressBar"),s=document.querySelector("#progressBarWrapper button");d(e,{frameCount:t.frameCount,frameRate:t.frameRate,start:t.start,end:t.end,quality:t.quality,drop:!1,progress:function(e,t){r?this.drop=!0:(L.push(e),a.style.width=t+"%")},done:function(e){L=e,i.style.display="none",a.style.width="0",clearInterval(n),n=void 0,s.onclick=null,m.optionApp.overlayConfigHidden=!1,o.emit("overlayFrames",L)}}),s.onclick=function(){r=!0}}),o.on("removeOverlay",()=>{L=[],m.optionApp.overlayConfigHidden=!0}),o.on("exportSpritesheet",e=>{let t=document.createElement("canvas");t.width=e.cellWidth*e.cols,t.height=e.cellHeight*e.rows;let i,n=t.getContext("2d");for(var r=e.start-1;r<=e.end-1;r++){var a=r-e.start+1,s=Math.floor(a%e.cols)*e.cellWidth,o=Math.floor(a/e.cols)*e.cellHeight,a=y.keyframes[r];a&&(i=r,y.updateSkin(a.joints)),y.renderTo(n,{frame:y.keyframes[r]?r:i,position:{x:s,y:o},showSkin:e.showSkin,showBones:e.showBones})}let l=t.toDataURL("image/png"),h=document.createElement("a");h.download=e.name,h.href=l,h.click()}),o.on("exportFrames",o=>{let l=f.query("#exportFrames");l.text("Processing...",!0),l.addClass("disabled");let h=0,c=0;const d=new ZIP({start(r){let a;for(var s=o.start-1;s<=o.end-1;s++){let e=document.createElement("canvas");e.width=o.frameWidth,e.height=o.frameHeight;let t=e.getContext("2d"),i=s-o.start+1,n=y.keyframes[s];n&&(a=s,y.updateSkin(n.joints)),y.renderTo(t,{frame:y.keyframes[s]?s:a,showSkin:o.showSkin,showBones:o.showBones}),e.toBlob(e=>{var t={name:`frames/${i}.png`,stream:()=>e.stream()};if(r.enqueue(t),h++,c+=e.size,h>=o.totalFrames){r.close();const h=u.createWriteStream(o.name+".zip",{size:c});d.pipeTo(h),l.text("Export",!0),l.removeClass("disabled")}},"image/png")}}})}),o.on("exportGIF",n=>{let r=f.query("#exportGIF");r.text("Processing...",!0),r.addClass("disabled");const a=new GIF({workers:4,quality:10,repeat:0,width:n.width,height:n.height,dither:!0,workerScript:"lib/gif.worker.js"});let s;for(var o=n.start-1;o<=n.end-1;o++){let e=document.createElement("canvas");e.width=n.width,e.height=n.height;let t=e.getContext("2d"),i=y.keyframes[o];i&&(s=o,y.updateSkin(i.joints)),t.fillStyle=n.background,t.fillRect(0,0,e.width,e.height),y.renderTo(t,{frame:y.keyframes[o]?o:s,showSkin:n.showSkin,showBones:n.showBones}),a.addFrame(e,{delay:1e3/m.timeline.app.animationSpeed})}a.render(),a.on("finished",e=>{try{a.abort(),r.text("Export",!0),r.removeClass("disabled");const t=u.createWriteStream(n.name+".gif",{size:e.size}),i=e.stream();if(window.WritableStream&&i.pipeTo)return i.pipeTo(t)}catch(e){console.warn(e)}})});const D=f.query("#riggingMode button",!0);D.on("click",e=>{D.removeClass("selected");let t=f.query(e.target);t.addClass("selected"),"inverseKinematics"==t.node.id?g.riggingMode="inverseKinematics":"forwardKinematics"==t.node.id?g.riggingMode="forwardKinematics":g.riggingMode="linear"});const N=f.query("#autoAddKeyframe");N.on("click",()=>{N.toggleClass("selected"),N.hasClass("selected")?g.animation.autoAddKeyframe=!0:g.animation.autoAddKeyframe=!1}),f.query("#focusRig").on("click",()=>{y.bounds&&y.joints.length&&(S.x=(y.bounds.min.x+y.bounds.max.x)/2,S.y=(y.bounds.min.y+y.bounds.max.y)/2)});const K=f.query("#displayCropApp");function U(o){let l=f.query("#propertyApp");if(o){m.timeline.graph.state.isPlaying||l.removeClass("disabled");let e=l.query("#jointName"),t=l.query("#jointLength"),i=l.query("#jointZIndex");e.value(o.name),t.value(o.length.toFixed(2)),i.value(parseInt(o.zIndex)),i.node._lastValue||(i.node._lastValue=i.value()),e.node._lastValue||(e.node._lastValue=e.value());let n=l.query("#jointX"),r=l.query("#jointY"),a=l.query("#jointAngle");n.value(o.position.x.toFixed(2)),r.value(o.position.y.toFixed(2));let s=h.degrees(h.map(o.angle,-Math.PI,Math.PI,0,2*Math.PI));if(a.value(s.toFixed(2)),o.skin&&(o.skin.imageSrc?K.removeClass("disabled"):K.addClass("disabled"),o.skin.offset)){let e=f.query("#skinPositionX"),t=f.query("#skinPositionY"),i=f.query("#skinScaleX"),n=f.query("#skinScaleY"),r=f.query("#skinAngle");e.value(o.skin.offset.x.toFixed(2)),t.value(o.skin.offset.y.toFixed(2)),i.value(o.skin.offset.scaleX.toFixed(2)),n.value(o.skin.offset.scaleY.toFixed(2));let a=h.degrees(o.skin.offset.angle);r.value(a.toFixed(2)),e.node._lastValue||(e.node._lastValue=e.value()),t.node._lastValue||(t.node._lastValue=t.value()),i.node._lastValue||(i.node._lastValue=i.value()),n.node._lastValue||(n.node._lastValue=n.value()),r.node._lastValue||(r.node._lastValue=r.value())}}else l.addClass("disabled")}let Y;K.on("click",()=>{let t=y.activeJoint;if(t&&t.skin&&t.skin.imageSrc){let e=new Image;e.src=t.skin.imageSrc,e.onload=function(){t.skin._vueCrop&&(m.cropApp.cropFrom=t.skin._vueCrop.from,m.cropApp.cropTo=t.skin._vueCrop.to),m.cropApp.show(e),s=t}}}),f.query("#removeSkin").on("click",()=>{var t=y.activeJoint;if(t&&t.skin&&t.skin.imageSrc){let e=JSON.parse(JSON.stringify(t.skin));delete e.imageSrc,delete e.image,y.editJoint(t.id,{skin:e}),c.add({label:"Remove joint skin",value:y.clone(),group:"keyframe"})}}),f.query("#resetOffset").on("click",()=>{var t=y.activeJoint;if(t&&t.skin&&t.skin.offset&&(0!=t.skin.offset.x||0!=t.skin.offset.y||1!=t.skin.offset.scaleX||1!=t.skin.offset.scaleY||0!=t.skin.offset.angle)){let e=JSON.parse(JSON.stringify(t.skin));e.offset.x=0,e.offset.y=0,e.offset.scaleX=1,e.offset.scaleY=1,e.offset.angle=0,y.editJoint(t.id,{skin:e},!0),U(t),c.add({label:"Reset transform offset",value:y.clone(),group:"keyframe"}),y.updateSkin(),y.updateBounds()}}),o.on("crop",(i,n)=>{y.editJoints((e,t)=>{e.id===s.id&&(e.skin.crop=JSON.parse(JSON.stringify(i)),e.skin._vueCrop={from:{x:n.from.x,y:n.from.y},to:{x:n.to.x,y:n.to.y}},y.updateSkin(t.joints))}),y.updateSubKeyframes(),y.updateBounds(),c.add({label:"Crop skin",value:y.clone(),group:"keyframe"})}),o.on("materialChange",e=>{let o=y.activeJoint;e?(K.removeClass("disabled"),h.loadImage(e).then(s=>{if(o){let e=parseFloat(f.query("#skinPositionX").value()),t=parseFloat(f.query("#skinPositionY").value()),i=parseFloat(f.query("#skinScaleX").value()),n=parseFloat(f.query("#skinScaleY").value()),r=parseFloat(f.query("#skinAngle").value()),a={from:{x:0,y:0},to:{x:s.width,y:s.height}};o.skin&&(o.skin.crop&&(a.from.x=o.skin.crop.from.x,a.from.y=o.skin.crop.from.y,a.to.x=o.skin.crop.to.x,a.to.y=o.skin.crop.to.y),o.skin.offset={x:e||0,y:t||0,scaleX:i||0,scaleY:n||0,angle:h.radians(h.map(r,0,360,-180,180))+Math.PI||0}),y.editJoints((e,t)=>{var i;e.id===o.id&&(e.skin.imageSrc=s.url,e.skin.image=new Image,e.skin.image.src=s.url,e.skin.crop=JSON.parse(JSON.stringify(a)),"object"==typeof(i=o.skin._vueCrop)&&i&&(e.skin._vueCrop=JSON.parse(JSON.stringify(i))||null),y.updateSkin(t.joints))}),y.updateSubKeyframes(),y.updateBounds(),c.add({label:"Change skin",value:y.clone(),group:"keyframe"})}})):K.addClass("disabled")}),o.on("timelineSeeked",()=>{var e;m.timeline.graph.state.isPlaying||((e=y.activeJoint)&&U(e),o.emit("jointChange",y.joints),v="timeline")}),o.on("jointChange",i=>{i=i||y.joints;let e=f.query("#jointApp");for(var n=0;n<i.length;n++){var t=i[n];e.query("#"+t.id).node||(t=function(t,e){let i=f.create("div");i.addClass("joint");let n=i.create("button");n.addClass("name","darko-d"),n.create("img").attr("src","assets/svg/joint.svg"),n.create("p").text(e),i.create("div").addClass("children"),i.attr("id",t),f.query("#jointApp button.name.active",!0).removeClass("active"),(e=y.joints.find(e=>e.id===t))&&y.activeJoint==e&&n.addClass("active");let r=f.query("#jointApp");return r.node.scrollTop=r.node.scrollHeight,r.node.scrollLeft=r.node.scrollWidth,n.on("click",()=>{var e;n.hasClass("active")||(f.query("#jointApp button.name.active").removeClass("active"),n.addClass("active"),(e=y.joints.find(e=>e.id===t))&&y.selectJoint(e.position.x,e.position.y)),m.timeline.graph.state.isPlaying&&m.timeline.graph.stop(),v="joints"}),n.on("dblclick",()=>{S.set(y.activeJoint.position)}),i}(t.id,t.name),e.append(t))}for(var r=f.query("#jointApp > *",!0),n=0;n<r.elements.length;n++){let t=r.elements[n],e=i.find(e=>e.id===t.node.id);e&&e.parent&&f.query("#"+e.parent.id+" > .children").append(t)}var a=f.query("#jointApp .joint",!0);for(n=0;n<a.elements.length;n++){let i=a.elements[n],e=y.joints.find(e=>e.id===i.node.id);if(e)i.node.id===y.activeJoint.id?i.query("button.name",!0).addClass("active"):i.query("button.name.active",!0).removeClass("active"),i.query("button.name").text(e.name,!0);else{let t=f.query(i.node.parentNode.parentNode);if(t){let e;e=t.hasClass("joint")?f.query("#"+t.node.id+" > .children"):f.query("#jointApp");var s=f.query("#"+i.node.id+" > .children > .joint",!0);e.append(s)}i.remove()}}U(y.activeJoint),y.activeJoint&&(y.activeJoint.parent?(f.query(f.query("#jointAngle").node.parentNode).css("display","flex"),f.query(f.query("#jointLength").node.parentNode).css("display","flex"),f.query(".section.skinning",!0).css("display","flex")):(f.query(f.query("#jointAngle").node.parentNode).css("display","none"),f.query(f.query("#jointLength").node.parentNode).css("display","none"),f.query(".section.skinning").css("display","none")))}),o.on("jointNameInputChange",e=>{let t=y.activeJoint;var i;t&&(i=f.query("#jointName").value(),t.name=i,y.editJoint(t.id,{name:i}),o.emit("jointChange"),e||c.add({label:"Change joint name",value:y.clone(),group:"keyframe"}))}),o.on("jointZIndexInputChange",e=>{let t=y.activeJoint;var i;t&&(i=f.query("#jointZIndex").value(),t.zIndex=i,y.editJoint(t.id,{zIndex:i}),o.emit("jointChange"),e||c.add({label:"Change joint Z-Index",value:y.clone(),group:"keyframe"}))}),o.on("jointSkinningInputChange",s=>{var o=y.activeJoint;if(o){let e=o.skin,t=parseFloat(f.query("#skinPositionX").value()),i=parseFloat(f.query("#skinPositionY").value()),n=parseFloat(f.query("#skinScaleX").value()),r=parseFloat(f.query("#skinScaleY").value()),a=parseFloat(f.query("#skinAngle").value());e.offset={x:t,y:i,scaleX:n,scaleY:r,angle:h.radians(h.map(a,0,360,-180,180))+Math.PI},g.animateSkin||y.editJoint(o.id,{skin:e},!0),s||c.add({label:"Change skin offset",value:y.clone(),group:"keyframe"}),y.updateSubKeyframes(),y.updateBounds()}}),o.on("jointPositionInputChange",()=>{var e,t;y.activeJoint&&(e=parseFloat(f.query("#jointX").value())||0,t=parseFloat(f.query("#jointY").value())||0,y.moveJoint(e,t))}),o.on("jointAngleInputChange",()=>{var e,t,i=y.activeJoint;i&&i.parent&&(e=parseFloat(f.query("#jointAngle").value())||0,e=h.radians(h.map(e,0,360,-180,180)),t=i.parent.position.x-Math.cos(e)*i.length,i=i.parent.position.y-Math.sin(e)*i.length,y.moveJoint(t,i))}),o.on("jointLengthInputChange",()=>{let e=y.activeJoint;var t;e&&(t=parseFloat(f.query("#jointLength").value())||0,e.length=t,y.moveJoint(e.position.x,e.position.y))}),o.on("undo",()=>{var t=c.getPrevious();if(t){"keyframe"==t.group&&(y.import(t.value),c.backward(),m.timeline.graph.updateState(),m.timeline.graph.redraw(),U(y.activeJoint)),f.query(".history.current",!0).removeClass("current");let e=f.query("#"+t.id);e.addClass("current"),f.query("#historyApp").node.scrollTop=e.node.offsetTop}}),o.on("redo",()=>{var t=c.getNext();if(t){"keyframe"==t.group&&(y.import(t.value),c.forward(),m.timeline.graph.updateState(),m.timeline.graph.redraw(),U(y.activeJoint)),f.query(".history.current",!0).removeClass("current");let e=f.query("#"+t.id);e.addClass("current"),f.query("#historyApp").node.scrollTop=e.node.offsetTop}}),o.on("historyChange",()=>{var e;c.eventCount%g.autosave.threshold==0&&(e=y.toJSON(null,!0),localStorage.setItem(g.autosave.label,JSON.stringify(e)));for(var i=f.query("#historyApp .history",!0),n=0;n<i.elements.length;n++){let t=i.elements[n].node;c.events.find(e=>e.id===t.id)||t.remove()}!function(e){let t=f.query("#historyApp");t.query(".history.current",!0).removeClass("current");let i=t.create("div");i.attr("id",e.id),i.addClass("history","current"),i.create("p").text(e.label),t.node.scrollTop=t.node.scrollHeight,i.on("click",()=>{"keyframe"==e.group&&(t.query(".history.current",!0).removeClass("current"),i.addClass("current"),c.jump(e.id),y.import(e.value),m.timeline.graph.updateState(),m.timeline.graph.redraw(),U(y.activeJoint),m.timeline.graph.state.isPlaying&&m.timeline.graph.stop())})}(c.getLatest())}),h.loadJSONData(g.autosave.label,e=>{y.import(y.fromJSON(e)),c.add({label:"Load autosave",value:y.clone(),group:"keyframe"})}),o.on("clearJoints",()=>{y.joints.length&&f.query("#jointApp *").remove(),y.reset(),f.query("#propertyApp").addClass("disabled")}),o.on("resetTimeline",()=>{document.getElementById("frameCount").value=30,document.getElementById("animationSpeed").value=30,m.timeline.app.fixData(),m.timeline.graph.scrollbar.left=0,m.timeline.graph.scrollbar.right=m.timeline.graph.canvas.width,m.timeline.graph.scrollbar.width=m.timeline.graph.canvas.width,m.timeline.graph.setCurrentMark(0),m.timeline.graph.playbackHandle.start.mark=0,m.timeline.graph.playbackHandle.start._x=m.timeline.graph.markToX(m.timeline.graph.playbackHandle.start.mark),m.timeline.graph.playbackHandle.end.mark=m.timeline.app.totalFrames-1,m.timeline.graph.playbackHandle.end._x=m.timeline.graph.markToX(m.timeline.graph.playbackHandle.end.mark),m.timeline.graph.redraw()}),o.on("resetCamera",()=>{E.reset(),S.reset(),w=g.world.zoom}),o.on("deleteKeyframe",()=>{var e=y.getKeyframe("index",m.timeline.graph.state.currentFrame);e&&("head"!=e.type||e.locked||(y.deleteKeyframe(e.id),c.add({label:"Delete keyframe",value:y.clone(),group:"keyframe"})))}),o.on("renderSleep",()=>{x=!0}),o.on("renderFocus",()=>{x=!1}),f.query("#fileButton").on("mouseup",function(){let e=m.fileApp;e.hidden&&e.show(r.x+5,r.y+5)}),f.query("#optionButton").on("mouseup",function(){let e=m.optionApp;e.hidden&&e.show(r.x+5,r.y+5)}),a.on("keydown",function(e){var t=A[C[e.code]];t&&(q(t),T=t),e.ctrlKey&&(90==e.keyCode&&o.emit("undo"),89==e.keyCode&&o.emit("redo")),e.shiftKey&&T==A.add&&y.activeJoint&&(k=k||y.activeJoint),32==e.keyCode&&T!=A.pan&&(Y=T,q(A.pan)),46==e.keyCode&&("joints"==v?(e=y.activeJoint)&&y.removeJointById(e.id):"timeline"==v&&o.emit("deleteKeyframe"))}),a.on("keyup",function(e){k=k&&null,Y&&(q(Y),Y=void 0)}),r.on("mouseup",function(){y._moved&&(c.add({label:"Move joint",value:y.clone(),group:"keyframe"}),U(y.activeJoint),y._moved=!1)}),r.on("mousedown",function(){m.fileApp.hide(),m.optionApp.hide(),m.contextMenuApp.hide(),J.css("display","none")}),r.on("mousemove",function(){r.dragged||E.set(j),r.x<=p.bounds.x||r.x>=p.bounds.x+p.bounds.width||r.y<=p.bounds.y||r.y>=p.bounds.y+p.bounds.height?W.css("display","none"):W.css({display:"block",top:r.y-10+"px",left:r.x+9+"px"})});let W=f.query("#actionPreview");function $(){var e=f.query("#toolApp"),t=f.query(".canvas-container"),i=f.query("#navigation"),e=t.node.offsetWidth-1-e.node.offsetWidth,i=innerHeight-i.node.offsetHeight-m.timeline.app.$el.offsetHeight;p.setSize(e,i)}p.canvas.addEventListener("mousemove",function(e){r.dragged&&!x&&T===A.pan&&(S.set({x:E.x-j.x+p.camera.movement.x,y:E.y-j.y+p.camera.movement.y}),S.x=h.clamp(S.x,-9e3,9e3),S.y=h.clamp(S.y,-9e3,9e3)),T!==A.move||x||r.pressed&&(v="joints",y.moveJoint(j.x,j.y))}),p.canvas.addEventListener("click",function(){var e;m.overlayApp.hidden&&m.overlayConfigApp.hidden&&m.fileApp.hidden&&m.loadApp.hidden&&m.saveApp.hidden&&m.optionApp.hidden&&(T==A.add&&(k&&(e=y.activeJoint.position.x-j.x+k.position.x,e=y.addJoint(e,j.y,{parent:k,ignoreHistory:!0,ignoreDefaults:!0}),k=e),y.addJoint(j.x,j.y),v="joints"),T===A.remove&&(y.selectJoint(j.x,j.y),y.removeJointByPosition(j.x,j.y),v="joints"),T===A.select&&(y.selectJoint(j.x,j.y),v="joints"))}),p.canvas.addEventListener("mousewheel",function(){r.scrollTop?w-=100:w+=100,w=h.clamp(w,g.world.minZoom,g.world.maxZoom)}),window.dom=f,addEventListener("resize",function(){$(),m.fileApp.hide(),m.optionApp.hide(),m.contextMenuApp.hide()}),$(),p.camera.setZoomSpeed(.2),p.camera.setMoveSpeed(.4);let X=f.query("#showBounds"),V=f.query("#showGrid");p.draw(()=>{let u=m.overlayApp.hidden&&m.overlayConfigApp.hidden&&m.fileApp.hidden&&m.loadApp.hidden&&m.saveApp.hidden&&m.optionApp.hidden;j.set(p.camera.screenToWorld(r.x-p.bounds.x,r.y-p.bounds.y)),p.rect(0,0,p.bounds.width,p.bounds.height,{fill:g.world.background}),p.camera.begin(function(){p.camera.moveTo(S.x,S.y),p.camera.zoomTo(w);let e=new Array(m.overlayConfigApp.start-1),t=m.overlayConfigApp.trimStart-1,i=m.overlayConfigApp.trimEnd-1,n=L.slice(0).splice(t,i-t),r=e.concat(n)[m.timeline.graph.state.currentMark];var a,s,o,l;if(r&&(p.save(),p.context.globalAlpha=m.overlayConfigApp.opacity,p.context.scale(m.overlayConfigApp.scale,m.overlayConfigApp.scale),p.context.rotate(m.overlayConfigApp.angle),p.context.drawImage(r,-r.width/2,-r.height/2),p.restore()),u&&T===A.add&&(l="rgba(240, 230, 255, 0.75)",p.save(),p.context.globalCompositeOperation="overlay",(s=y.activeJoint)&&(p.line(j.x,j.y,s.position.x,s.position.y,{lineWidth:g.render.segment.width,lineCap:"round",stroke:l}),k)&&(o=s.position.x-j.x+k.position.x,p.line(o,j.y,k.position.x,k.position.y,{lineWidth:g.render.segment.width,lineCap:"round",stroke:l}),p.circle(o,j.y,g.render.joint.radius,{fill:l})),p.circle(j.x,j.y,g.render.joint.radius,{fill:l}),p.restore()),V.prop("checked")){for(var h=1e4,c=-w-h;c<w+h;c+=20)p.line(c,p.camera.viewport.top-h,c,p.camera.viewport.bottom+h,{stroke:"rgba(240, 230, 250, 0.2)",lineWidth:.2});for(var d=-w-h;d<w+h;d+=20)p.line(p.camera.viewport.left-h,d,p.camera.viewport.right+h,d,{stroke:"rgba(240, 230, 250, 0.2)",lineWidth:.2})}X.prop("checked")&&(a="rgba(225, 50, 255, 0.5)",s=y.bounds.max.x-y.bounds.min.x,o=y.bounds.max.y-y.bounds.min.y,l=parseInt(s)+"x"+parseInt(o),p.text(l,y.bounds.min.x,y.bounds.min.y,{align:"left bottom",font:"10px Consolas",fill:a}),p.rect(y.bounds.min.x,y.bounds.min.y,s,o,{lineWidth:.35,stroke:a})),y.render(p)})}),p.render(()=>{p.redraw()})},function(e,t,i){var n=()=>{"use strict";const h="object"==typeof window?window:this;h.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let c=null,d=!1;const e=h.WebStreamsPolyfill||{},u=h.isSecureContext;let p=/constructor/i.test(h.HTMLElement)||!!h.safari||!!h.WebKitPoint;const f=u||"MozAppearance"in document.documentElement.style?"iframe":"navigate",g={createWriteStream:function(i,e,t){let n={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},r=0,a=null,s=null,o=null;if(Number.isFinite(e)?([t,e]=[e,t],console.warn("[StreamSaver] Depricated pass an object as 2nd argument when creating a write stream"),n.size=t,n.writableStrategy=e):e&&e.highWaterMark?(console.warn("[StreamSaver] Depricated pass an object as 2nd argument when creating a write stream"),n.size=t,n.writableStrategy=e):n=e||{},!p){c=c||(u?m:function(e){const t=document.createDocumentFragment(),i={frame:h.open(e,"popup","width=200,height=100"),loaded:!1,isIframe:!1,isPopup:!0,remove(){i.frame.close()},addEventListener(...e){t.addEventListener(...e)},dispatchEvent(...e){t.dispatchEvent(...e)},removeEventListener(...e){t.removeEventListener(...e)},postMessage(...e){i.frame.postMessage(...e)}},n=e=>{e.source===i.frame&&(i.loaded=!0,h.removeEventListener("message",n),i.dispatchEvent(new Event("load")))};return h.addEventListener("message",n),i})(g.mitm),s=new MessageChannel,i=encodeURIComponent(i.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const p={transferringReadable:d,pathname:n.pathname||Math.random().toString().slice(-6)+"/"+i,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+i}};n.size&&(p.headers["Content-Length"]=n.size);const e=[p,"*",[s.port2]];if(d){const h="iframe"==f?void 0:{transform(e,t){if(!(e instanceof Uint8Array))throw new TypeError("Can only wirte Uint8Arrays");r+=e.length,t.enqueue(e),a&&(location.href=a,a=null)},flush(){a&&(location.href=a)}};o=new g.TransformStream(h,n.writableStrategy,n.readableStrategy);const c=o.readable;s.port1.postMessage({readableStream:c},[c])}s.port1.onmessage=e=>{e.data.download&&("navigate"==f?(c.remove(),c=null,r?location.href=e.data.download:a=e.data.download):(c.isPopup&&(c.remove(),c=null,"iframe"==f&&m(g.mitm)),m(e.data.download)))},c.loaded?c.postMessage(...e):c.addEventListener("load",()=>{c.postMessage(...e)},{once:!0})}let l=[];return!p&&o&&o.writable||new g.WritableStream({write(e){if(!(e instanceof Uint8Array))throw new TypeError("Can only wirte Uint8Arrays");p?l.push(e):(s.port1.postMessage(e),r+=e.length,a&&(location.href=a,a=null))},close(){if(p){const e=new Blob(l,{type:"application/octet-stream; charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=i,t.click()}else s.port1.postMessage("end")},abort(){l=[],s.port1.postMessage("abort"),s.port1.onmessage=null,s.port1.close(),s.port2.close(),s=null}},n.writableStrategy)},WritableStream:h.WritableStream||e.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function m(e){if(!e)throw new Error("meh");const t=document.createElement("iframe");return t.hidden=!0,t.src=e,t.loaded=!1,t.name="iframe",t.isIframe=!0,t.postMessage=(...e)=>t.contentWindow.postMessage(...e),t.addEventListener("load",()=>{t.loaded=!0},{once:!0}),document.body.appendChild(t),t}try{new Response(new ReadableStream),!u||"serviceWorker"in navigator||(p=!0)}catch(h){p=!0}return(()=>{try{(()=>{const{readable:e}=new TransformStream,t=new MessageChannel;t.port1.postMessage(e,[e]),t.port1.close(),t.port2.close(),d=!0,Object.defineProperty(g,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})})()}catch(e){}})(),g};e.exports=n()},function(e,_,I){"use strict";!function(e){var o=I(25),a=I(26),s=I(27);function i(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=d.prototype:(e=null===e?new d(t):e).length=t,e}function d(e,t,i){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(e,t,i);if("number"!=typeof e)return n(this,e,t,i);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}function n(e,t,i,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,n){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===i&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,i):new Uint8Array(t,i,n),d.TYPED_ARRAY_SUPPORT?(e=t).__proto__=d.prototype:e=c(e,t),e}(e,t,i,n):"string"==typeof t?function(e,t,i){if(!d.isEncoding(i="string"!=typeof i||""===i?"utf8":i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,i),i=(e=r(e,n)).write(t,i);return e=i!==n?e.slice(0,i):e}(e,t,i):function(e,t){if(d.isBuffer(t)){var i=0|u(t.length);return 0===(e=r(e,i)).length||t.copy(e,0,0,i),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?r(e,0):c(e,t);if("Buffer"===t.type&&s(t.data))return c(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=r(e,t<0?0:0|u(t)),!d.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function c(e,t){var i=t.length<0?0:0|u(t.length);e=r(e,i);for(var n=0;n<i;n+=1)e[n]=255&t[n];return e}function u(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function p(e,t){if(d.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var i=(e="string"!=typeof e?""+e:e).length;if(0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return M(e).length;default:if(n)return C(e).length;t=(""+t).toLowerCase(),n=!0}}function t(e,t,i){var n,r,a,s=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((i=void 0===i||i>this.length?this.length:i)<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return function(e,t,i){var n=e.length;(!i||i<0||n<i)&&(i=n);for(var r="",a=t=!t||t<0?0:t;a<i;++a)r+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[a]);return r}(this,t,i);case"utf8":case"utf-8":return v(this,t,i);case"ascii":return function(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(127&e[r]);return n}(this,t,i);case"latin1":case"binary":return function(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(e[r]);return n}(this,t,i);case"base64":return n=this,a=i,0===(r=t)&&a===n.length?o.fromByteArray(n):o.fromByteArray(n.slice(r,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,i){for(var n=e.slice(t,i),r="",a=0;a<n.length;a+=2)r+=String.fromCharCode(n[a]+256*n[a+1]);return r}(this,t,i);default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function f(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function g(e,t,i,n,r){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,(i=(i=isNaN(i)?r?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(r)return-1;i=e.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof t&&(t=d.from(t,n)),d.isBuffer(t))return 0===t.length?-1:m(e,t,i,n,r);if("number"==typeof t)return t&=255,d.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(r?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):m(e,[t],i,n,r);throw new TypeError("val must be string, number or Buffer")}function m(e,t,i,n,r){var a=1,s=e.length,o=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s/=a=2,o/=2,i/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r)for(var h=-1,c=i;c<s;c++)if(l(e,c)===l(t,-1===h?0:c-h)){if(c-(h=-1===h?c:h)+1===o)return h*a}else-1!==h&&(c-=c-h),h=-1;else for(c=i=s<i+o?s-o:i;0<=c;c--){for(var d=!0,u=0;u<o;u++)if(l(e,c+u)!==l(t,u)){d=!1;break}if(d)return c}return-1}function y(e,t,i,n){return T(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function v(e,t,i){i=Math.min(e.length,i);for(var n=[],r=t;r<i;){var a,s,o,l,h=e[r],c=null,d=239<h?4:223<h?3:191<h?2:1;if(r+d<=i)switch(d){case 1:h<128&&(c=h);break;case 2:128==(192&(a=e[r+1]))&&127<(l=(31&h)<<6|63&a)&&(c=l);break;case 3:a=e[r+1],s=e[r+2],128==(192&a)&&128==(192&s)&&2047<(l=(15&h)<<12|(63&a)<<6|63&s)&&(l<55296||57343<l)&&(c=l);break;case 4:a=e[r+1],s=e[r+2],o=e[r+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&65535<(l=(15&h)<<18|(63&a)<<12|(63&s)<<6|63&o)&&l<1114112&&(c=l)}null===c?(c=65533,d=1):65535<c&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),r+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var i="",n=0;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return i}(n)}function b(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,i,n,r,a){if(!d.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r<t||t<a)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function k(e,t,i,n){t<0&&(t=65535+t+1);for(var r=0,a=Math.min(e.length-i,2);r<a;++r)e[i+r]=(t&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function w(e,t,i,n){t<0&&(t=4294967295+t+1);for(var r=0,a=Math.min(e.length-i,4);r<a;++r)e[i+r]=t>>>8*(n?r:3-r)&255}function S(e,t,i,n){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function E(e,t,i,n,r){return r||S(e,0,i,4),a.write(e,t,i,n,23,4),i+4}function j(e,t,i,n,r){return r||S(e,0,i,8),a.write(e,t,i,n,52,8),i+8}_.Buffer=d,_.SlowBuffer=function(e){return d.alloc(+(e=+e!=e?0:e))},_.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),_.kMaxLength=i(),d.poolSize=8192,d._augment=function(e){return e.__proto__=d.prototype,e},d.from=function(e,t,i){return n(null,e,t,i)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function(e,t,i){return n=null,t=t,i=i,l(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?r(n,e).fill(t,i):r(n,e).fill(t):r(n,e);var n},d.allocUnsafe=function(e){return h(null,e)},d.allocUnsafeSlow=function(e){return h(null,e)},d.isBuffer=function(e){return!(null==e||!e._isBuffer)},d.compare=function(e,t){if(!d.isBuffer(e)||!d.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,n=t.length,r=0,a=Math.min(i,n);r<a;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0},d.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return d.alloc(0);if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;for(var i=d.allocUnsafe(t),n=0,r=0;r<e.length;++r){var a=e[r];if(!d.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,n),n+=a.length}return i},d.byteLength=p,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},d.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},d.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},d.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?v(this,0,e):t.apply(this,arguments)},d.prototype.equals=function(e){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===d.compare(this,e)},d.prototype.inspect=function(){var e="",t=_.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},d.prototype.compare=function(e,t,i,n,r){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),(t=void 0===t?0:t)<0||i>e.length||n<0||r>this.length)throw new RangeError("out of range index");if(r<=n&&i<=t)return 0;if(r<=n)return-1;if(i<=t)return 1;if(this===e)return 0;for(var a=(r>>>=0)-(n>>>=0),s=(i>>>=0)-(t>>>=0),o=Math.min(a,s),l=this.slice(n,r),h=e.slice(t,i),c=0;c<o;++c)if(l[c]!==h[c]){a=l[c],s=h[c];break}return a<s?-1:s<a?1:0},d.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},d.prototype.indexOf=function(e,t,i){return g(this,e,t,i,!0)},d.prototype.lastIndexOf=function(e,t,i){return g(this,e,t,i,!1)},d.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-t;if((void 0===i||r<i)&&(i=r),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var a,s,o,l,h,c,d=!1;;)switch(n){case"hex":return function(e,t,i,n){i=Number(i)||0;var r=e.length-i;if((!n||(n=Number(n))>r)&&(n=r),(r=t.length)%2!=0)throw new TypeError("Invalid hex string");r/2<n&&(n=r/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[i+a]=s}return a}(this,e,t,i);case"utf8":case"utf-8":return h=t,c=i,T(C(e,(l=this).length-h),l,h,c);case"ascii":return y(this,e,t,i);case"latin1":case"binary":return y(this,e,t,i);case"base64":return a=this,s=t,o=i,T(M(e),a,s,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=t,s=i,T(function(e,t){for(var i,n,r=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(i=e.charCodeAt(a))>>8,r.push(i%256),r.push(n);return r}(e,(o=this).length-a),o,a,s);default:if(d)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),d=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(e,t){var i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),d.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=d.prototype;else for(var n=t-e,r=new d(n,void 0),a=0;a<n;++a)r[a]=this[a+e];return r},d.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||b(e,t,this.length);for(var n=this[e],r=1,a=0;++a<t&&(r*=256);)n+=this[e+a]*r;return n},d.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||b(e,t,this.length);for(var n=this[e+--t],r=1;0<t&&(r*=256);)n+=this[e+--t]*r;return n},d.prototype.readUInt8=function(e,t){return t||b(e,1,this.length),this[e]},d.prototype.readUInt16LE=function(e,t){return t||b(e,2,this.length),this[e]|this[e+1]<<8},d.prototype.readUInt16BE=function(e,t){return t||b(e,2,this.length),this[e]<<8|this[e+1]},d.prototype.readUInt32LE=function(e,t){return t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},d.prototype.readUInt32BE=function(e,t){return t||b(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},d.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||b(e,t,this.length);for(var n=this[e],r=1,a=0;++a<t&&(r*=256);)n+=this[e+a]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},d.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||b(e,t,this.length);for(var n=t,r=1,a=this[e+--n];0<n&&(r*=256);)a+=this[e+--n]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},d.prototype.readInt8=function(e,t){return t||b(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},d.prototype.readInt16LE=function(e,t){t||b(e,2,this.length);e=this[e]|this[e+1]<<8;return 32768&e?4294901760|e:e},d.prototype.readInt16BE=function(e,t){t||b(e,2,this.length);e=this[e+1]|this[e]<<8;return 32768&e?4294901760|e:e},d.prototype.readInt32LE=function(e,t){return t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},d.prototype.readInt32BE=function(e,t){return t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},d.prototype.readFloatLE=function(e,t){return t||b(e,4,this.length),a.read(this,e,!0,23,4)},d.prototype.readFloatBE=function(e,t){return t||b(e,4,this.length),a.read(this,e,!1,23,4)},d.prototype.readDoubleLE=function(e,t){return t||b(e,8,this.length),a.read(this,e,!0,52,8)},d.prototype.readDoubleBE=function(e,t){return t||b(e,8,this.length),a.read(this,e,!1,52,8)},d.prototype.writeUIntLE=function(e,t,i,n){e=+e,t|=0,i|=0,n||x(this,e,t,i,Math.pow(2,8*i)-1,0);var r=1,a=0;for(this[t]=255&e;++a<i&&(r*=256);)this[t+a]=e/r&255;return t+i},d.prototype.writeUIntBE=function(e,t,i,n){e=+e,t|=0,i|=0,n||x(this,e,t,i,Math.pow(2,8*i)-1,0);var r=i-1,a=1;for(this[t+r]=255&e;0<=--r&&(a*=256);)this[t+r]=e/a&255;return t+i},d.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,1,255,0),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},d.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},d.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},d.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):w(this,e,t,!0),t+4},d.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):w(this,e,t,!1),t+4},d.prototype.writeIntLE=function(e,t,i,n){e=+e,t|=0,n||x(this,e,t,i,(n=Math.pow(2,8*i-1))-1,-n);var r=0,a=1,s=0;for(this[t]=255&e;++r<i&&(a*=256);)e<0&&0===s&&0!==this[t+r-1]&&(s=1),this[t+r]=(e/a>>0)-s&255;return t+i},d.prototype.writeIntBE=function(e,t,i,n){e=+e,t|=0,n||x(this,e,t,i,(n=Math.pow(2,8*i-1))-1,-n);var r=i-1,a=1,s=0;for(this[t+r]=255&e;0<=--r&&(a*=256);)e<0&&0===s&&0!==this[t+r+1]&&(s=1),this[t+r]=(e/a>>0)-s&255;return t+i},d.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,1,127,-128),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},d.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},d.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},d.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):w(this,e,t,!0),t+4},d.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):w(this,e,t,!1),t+4},d.prototype.writeFloatLE=function(e,t,i){return E(this,e,t,!0,i)},d.prototype.writeFloatBE=function(e,t,i){return E(this,e,t,!1,i)},d.prototype.writeDoubleLE=function(e,t,i){return j(this,e,t,!0,i)},d.prototype.writeDoubleBE=function(e,t,i){return j(this,e,t,!1,i)},d.prototype.copy=function(e,t,i,n){if(i=i||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),(n=0<n&&n<i?i:n)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var r,a=(n=e.length-t<n-i?e.length-t+i:n)-i;if(this===e&&i<t&&t<n)for(r=a-1;0<=r;--r)e[r+t]=this[r+i];else if(a<1e3||!d.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)e[r+t]=this[r+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+a),t);return a},d.prototype.fill=function(e,t,i,n){if("string"==typeof e){var r;if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===e.length&&(r=e.charCodeAt(0))<256&&(e=r),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!d.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;if(t>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(e=e||0))for(o=t;o<i;++o)this[o]=e;else for(var a=d.isBuffer(e)?e:C(new d(e,n).toString()),s=a.length,o=0;o<i-t;++o)this[o+t]=a[o%s];return this};var A=/[^+\/0-9A-Za-z-_]/g;function C(e,t){var i;t=t||1/0;for(var n=e.length,r=null,a=[],s=0;s<n;++s){if(55295<(i=e.charCodeAt(s))&&i<57344){if(!r){if(56319<i){-1<(t-=3)&&a.push(239,191,189);continue}if(s+1===n){-1<(t-=3)&&a.push(239,191,189);continue}r=i;continue}if(i<56320){-1<(t-=3)&&a.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&-1<(t-=3)&&a.push(239,191,189);if(r=null,i<128){if(--t<0)break;a.push(i)}else if(i<2048){if((t-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function M(e){return o.toByteArray(function(e){if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(A,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function T(e,t,i,n){for(var r=0;r<n&&!(r+i>=t.length||r>=e.length);++r)t[r+i]=e[r];return r}}.call(this,I(6))},function(e,t,i){"use strict";t.byteLength=function(e){var t=c(e),e=t[0],t=t[1];return 3*(e+t)/4-t},t.toByteArray=function(e){for(var t,i=c(e),n=i[0],i=i[1],r=new h(3*(n+i)/4-i),a=0,s=0<i?n-4:n,o=0;o<s;o+=4)t=l[e.charCodeAt(o)]<<18|l[e.charCodeAt(o+1)]<<12|l[e.charCodeAt(o+2)]<<6|l[e.charCodeAt(o+3)],r[a++]=t>>16&255,r[a++]=t>>8&255,r[a++]=255&t;return 2===i&&(t=l[e.charCodeAt(o)]<<2|l[e.charCodeAt(o+1)]>>4,r[a++]=255&t),1===i&&(t=l[e.charCodeAt(o)]<<10|l[e.charCodeAt(o+1)]<<4|l[e.charCodeAt(o+2)]>>2,r[a++]=t>>8&255,r[a++]=255&t),r},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,r=[],a=0,s=i-n;a<s;a+=16383)r.push(function(e,t,i){for(var n,r=[],a=t;a<i;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),r.push(o[(n=n)>>18&63]+o[n>>12&63]+o[n>>6&63]+o[63&n]);return r.join("")}(e,a,s<a+16383?s:a+16383));return 1==n?(t=e[i-1],r.push(o[t>>2]+o[t<<4&63]+"==")):2==n&&(t=(e[i-2]<<8)+e[i-1],r.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"=")),r.join("")};for(var o=[],l=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,a=n.length;r<a;++r)o[r]=n[r],l[n.charCodeAt(r)]=r;function c(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,n,r){var a,s,o=8*r-n-1,l=(1<<o)-1,h=l>>1,c=-7,d=i?r-1:0,u=i?-1:1,i=e[t+d];for(d+=u,a=i&(1<<-c)-1,i>>=-c,c+=o;0<c;a=256*a+e[t+d],d+=u,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;0<c;s=256*s+e[t+d],d+=u,c-=8);if(0===a)a=1-h;else{if(a===l)return s?NaN:1/0*(i?-1:1);s+=Math.pow(2,n),a-=h}return(i?-1:1)*s*Math.pow(2,a-n)},t.write=function(e,t,i,n,r,a){var s,o,l=8*a-r-1,h=(1<<l)-1,c=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,u=n?0:a-1,p=n?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-s))<1&&(s--,n*=2),2<=(t+=1<=s+c?d/n:d*Math.pow(2,1-c))*n&&(s++,n/=2),h<=s+c?(o=0,s=h):1<=s+c?(o=(t*n-1)*Math.pow(2,r),s+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,r),s=0));8<=r;e[i+u]=255&o,u+=p,o/=256,r-=8);for(s=s<<r|o,l+=r;0<l;e[i+u]=255&s,u+=p,s/=256,l-=8);e[i+u-p]|=128*a}},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){"use strict";!function(e){t.parseWrapper=(l,a,h,i)=>{let c=0,d=0,u=l,p=0,f=" ",g="";function m(e){this.name="ParseError",this.message=e,this.text=u}let y=()=>{for(f=u.charAt(p),p++;f&&f<=" ";)y();return f},v=()=>{for(g="";g+=f,y(),f.match(/[a-z]/i););return u=u.slice(p-1),p=0,g};let s=(e,t)=>{let i="",n,r=e[t];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=s(r,i),void 0!==n?r[i]=n:delete r[i]);return a.call(e,t,r)},n="",r=function*(){n=yield*function*e(){let t,i={},n=[],r,a,s="",o=()=>{s+=f,y()};if("number"==typeof u||"boolean"==typeof u||null===u)return u="",l;if(void 0===u)return u=void 0,l;if("["===u.charAt(0)&&"]"===u.charAt(1))return u="",[];if("{"===u.charAt(0)&&"}"===u.charAt(1))return u="",{};switch(++c>512*h&&(c=0,yield),1!==d&&y(),f){case"{":if(y(),"}"===f)return u=u.slice(p),p=0,i;do{if('"'!==f&&y(),d=1,t=yield*e(),d=0,y(),i[t]=yield*e(),y(),"}"===f)return u=u.slice(p),p=0,i}while(","===f);return new m("Bad object");case"[":if(y(),"]"===f)return u=u.slice(p),p=0,n;f=u.charAt(--p);do{if(r=yield*e(),n.push(r),y(),"]"===f)return u=u.slice(p),p=0,n}while(","===f);return new m("Bad array");case'"':return u=u.slice(p-1),p=0,'"'===u.charAt(0)&&'"'===u.charAt(1)?(u=u.slice(2),p=0,""):(y(),(()=>{let r=" ",e=p,a=0,t=0;for(;;){for(a=u.indexOf('"',e+1),e=a,f=u.charAt(e-1);"\\"===f;)t++,f=u.charAt(e-(t+1));if(t%2==0){r=u.substring(p,a),u=u.slice(++a),t=0;break}t=0}for(a=r.indexOf("\\");0<=a;){let e={'"':'"',"'":"'","/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},t=0,i=0,n=0;if(p=a,f=r.charAt(++p),"u"===f){for(n=0,i=0;i<4&&(t=parseInt(f=r.charAt(++p),16),isFinite(t));i+=1)n=16*n+t;r=r.slice(0,a)+String.fromCharCode(n)+r.slice(a+6),p=a}else{if("string"!=typeof e[f])break;r=r.slice(0,a)+e[f]+r.slice(a+2),p=a+1}a=r.indexOf("\\",p)}return p=0,r})());case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for("-"===f&&o();o(),("."===f||"e"===f||"E"===f||"-"===f||"+"===f||f>=String.fromCharCode(65)&&f<=String.fromCharCode(70))&&o(),"-"===f||"+"===f||isFinite(f)&&""!==f;);return a=Number(s),u=u.slice(p-1),p=0,a;case"t":return g=v(),"true"===g||new m("Unexpected character");case"f":return g=v(),"false"!==g&&new m("Unexpected character");case"n":return g=v(),"null"===g?null:new m("Unexpected character");default:return new m("Unexpected character")}}()}(),o,b=()=>{e(()=>{if(o=r.next(),o&&!0===o.done){if(void 0===n)return i(new m("Unexpected Character"),null);if(n instanceof m)return i(n,null);if("string"!=typeof(t="}"===(t=u).charAt(0)||"]"===t.charAt(0)?t.substring(1,t.length):t)||t.trim())return i(new m("Unexpected Character"),null);if(null===a)return i(null,n);if("function"==typeof a){var e=s({"":n},"");return i(null,e)}}var t;b()})};return b()}}.call(this,i(12).setImmediate)},function(e,t,i){!function(e,p){!function(i){"use strict";var n,t,r,e,a,s,o,l,h,c;function d(e){delete s[e]}function u(e){if(o)setTimeout(u,0,e);else{var i=s[e];if(i){o=!0;try{!function(){var e=i.callback,t=i.args;switch(t.length){case 0:e();break;case 1:e(t[0]);break;case 2:e(t[0],t[1]);break;case 3:e(t[0],t[1],t[2]);break;default:e.apply(void 0,t)}}()}finally{d(e),o=!1}}}}i.setImmediate||(a=1,o=!(s={}),l=i.document,h=(h=Object.getPrototypeOf&&Object.getPrototypeOf(i))&&h.setTimeout?h:i,c="[object process]"==={}.toString.call(i.process)?function(e){p.nextTick(function(){u(e)})}:function(){if(i.postMessage&&!i.importScripts){var e=!0,t=i.onmessage;return i.onmessage=function(){e=!1},i.postMessage("","*"),i.onmessage=t,e}}()?(r="setImmediate$"+Math.random()+"$",e=function(e){e.source===i&&"string"==typeof e.data&&0===e.data.indexOf(r)&&u(+e.data.slice(r.length))},i.addEventListener?i.addEventListener("message",e,!1):i.attachEvent("onmessage",e),function(e){i.postMessage(r+e,"*")}):i.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){u(e.data)},function(e){t.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(n=l.documentElement,function(e){var t=l.createElement("script");t.onreadystatechange=function(){u(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):function(e){setTimeout(u,0,e)},h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];return s[a]={callback:e,args:t},c(a),a++},h.clearImmediate=d)}("undefined"==typeof self?void 0===e?this:e:self)}.call(this,i(6),i(30))},function(e,t){var i,n,e=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o,l=[],h=!1,c=-1;function d(){h&&o&&(h=!1,o.length?l=o.concat(l):c=-1,l.length&&u())}function u(){if(!h){var e=s(d);h=!0;for(var t=l.length;t;){for(o=l,l=[];++c<t;)o&&o[c].run();c=-1,t=l.length}o=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new p(e,t)),1!==l.length||h||s(u)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=f,e.addListener=f,e.once=f,e.off=f,e.removeListener=f,e.removeAllListeners=f,e.emit=f,e.prependListener=f,e.prependOnceListener=f,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,i){"use strict";!function(c){let v=[],d="";function b(e){this.name="Error",this.message=e}let x=(e,t)=>{let i="",n="",r=new RegExp("/[\\'\0--­؀-؄܏឴឵‌-‏\u2028- ⁠-⁯\ufeff￰-￿]/g");e=e.replace(/\\/gi,"\\\\");var a,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"'};for(a in s){var o=new RegExp(a,"gi");e=e.replace(o,s[a])}return r.lastIndex=0,r.test(e)?(n=e.replace(r,e=>"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)),1===t?(n+=d,n+=n,d="",'"'+n+'"'):2===t?'"'+n+'"':void(d+=n)):1===t?(i+=d,i+=e,d="",'"'+i+'"'):2===t?'"'+e+'"':void(d+=e)};t.stringifyWrapper=(e,t,i,n,r)=>{let a,s="";"number"==typeof i?s=" ".repeat(i):"string"==typeof i&&(s=i);let o=function*(){a=yield*function*t(i,n,r,a,s){let o=0,l="",h="",c=0,d,u="",p=n[i],f=0,g="",m,y=0;switch(++e>512*s&&(e=0,yield h),"function"==typeof r&&(p=r.call(n,i,p)),typeof p){case"string":if(1e5<p.length)for(let e=0;e<p.length;e+=1e5)f=0,yield p,m=p.substr(e,1e5),y+=m.length,y===p.length&&(f=1),g=x(m,f);else g=x(p,2);return g;case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"undefined":return;case"object":if(!p)return"null";let e=e=>0===u.length?e?"{}":"[]":e?a?"{\n"+a+u.join(",\n"+a)+"\n}":"{"+u.join(",")+"}":a?"[\n"+a+u.join(",\n"+a)+"\n]":"["+u.join(",")+"]";if(u=[],p&&"function"==typeof p.toJSON)return u.push('"'+p.toJSON(i)+'"'),0===u.length?"{}":a?a+u.join(",\n"+a)+"\n":u.join(",");if(p&&p.constructor===Array){for(c=p.length,o=0;o<c;o+=1)void 0!==(d=yield*t(o,p,r,a,s)||"null")&&u.push(d);return e(!1)}if(r&&"object"==typeof r)for(c=r.length,o=0;o<c;o+=1)"string"==typeof r[o]&&(l=r[o],h=yield*t(l,p,r,a,s),void 0!==h&&u.push(x(l,2)+(a?": ":":")+h));else{for(l in v.push(p),p){if("object"==typeof p[l]&&null!==p[l]&&void 0!==p[l]){if(-1!==v.indexOf(p[l]))return new b("Circular Structure Detected");v.push(p[l])}Object.hasOwnProperty.call(p,l)&&(h=yield*t(l,p,r,a,s),void 0!==h&&u.push(x(l,2)+(a?": ":":")+h)),v=v.filter((e,t,i)=>e!==p[l])}v=v.filter((e,t,i)=>e!==p)}return e(!0);default:return new b("Unexpected Character")}}("",{"":e},t,s,1)}(),l,h=()=>{c(()=>(l=o.next(),l&&!0===l.done?(d="",v=[],"object"==typeof a?r(a,null):r(null,a)):void h()))};return h()}}.call(this,i(12).setImmediate)},function(e,t,i){const n=i(33),r=i(34);e.exports=new class{constructor(){this.canvas=document.getElementById("gameCanvas"),this.bounds=this.canvas.getBoundingClientRect(),this.context=this.canvas.getContext("2d"),this.camera=n.create(this.context),this.engine=r.create(),this.offscreen=0,this.context.offscreens=[],this._customOptions=["fill","stroke","align","close","curve"],this._currentContext=this.context,this._render=null;var e=e=>{e.preventDefault()};this.canvas.addEventListener("drag",e),this.canvas.addEventListener("dragstart",e)}draw(e){this._render=e,"function"==typeof this._render&&this._render()}redraw(){"function"==typeof this._render&&this._render()}render(e){"function"==typeof e&&this.engine.run(()=>{this.clear(),e(),this.context.offscreens.length&&this.drawOffscreens()})}getFrameCount(){return this.engine.frameCount}getFrameRate(){return this.engine.frameRate}setSize(e,t){this.canvas.width=e,this.canvas.height=t,this.bounds=this.canvas.getBoundingClientRect();for(var i of this.context.offscreens)i.canvas.width=this.canvas.width,i.canvas.height=this.canvas.height}fullscreen(){this.setSize(innerWidth,innerHeight),addEventListener("resize",()=>{this.setSize(innerWidth,innerHeight)})}createLayer(){let e=document.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height;let t=e.getContext("2d"),i={camera:this.camera};return t.rendererData=i,this.context.offscreens.push(t),t}drawOffscreens(){for(var t=0;t<this.context.offscreens.length;t++){let e=this.context.offscreens[t];e.rendererData.camera.begin(()=>{this.context.drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height)}),e.clearRect(0,0,e.canvas.width,e.canvas.height)}}line(e,t,i,n,r,a){let s=a||this.context;s.beginPath(),s.moveTo(e,t),s.lineTo(i,n),this._hasProperty(r,"close",()=>{s.closePath()}),this._evaluateOptions(r,s)}circle(e,t,i,n,r){let a=r||this.context;a.beginPath(),a.arc(e,t,i,0,2*Math.PI),this._hasProperty(n,"close",()=>{a.closePath()}),this._evaluateOptions(n,a)}rect(t,i,n,r,e,a){let s=a||this.context;this._hasProperty(e,"align",e=>{e=e.split(" ");e[0]&&("center"==e[0]||"middle"==e[0]?t-=.5*n:"right"==e[0]&&(t-=n)),e[1]&&("center"==e[1]||"middle"==e[0]?i-=.5*r:"bottom"==e[1]&&(i-=r))}),s.beginPath(),s.rect(t,i,n,r),this._hasProperty(e,"close",()=>{s.closePath()}),this._evaluateOptions(e,s)}fromVertices(o,e,t){let l=t||this.context;if(o.length){if(l.beginPath(),!this._hasProperty(e,"curve")){l.moveTo(o[0].x,o[0].y);for(var i=0;i<o.length;i++){var n=o[i];l.lineTo(n.x,n.y)}}this._hasProperty(e,"curve",()=>{l.beginPath();var e=o[0],t=o[1],i=.5*(e.x+t.x),t=.5*(e.y+t.y);l.moveTo(i,t);for(var n=1;n<o.length;n++){var r=o[n],a=o[n+1==o.length?0:n+1],s=.5*(a.x+r.x),a=.5*(a.y+r.y);l.quadraticCurveTo(r.x,r.y,s,a)}l.quadraticCurveTo(e.x,e.y,i,t),l.lineJoin="round"}),this._hasProperty(e,"close",()=>{l.closePath()}),this._evaluateOptions(e,l)}}text(e,t,i,n,r){let a=r||this.context;this._hasProperty(n,"align",e=>{e=e.split(" ");e[0]&&("left"==e[0]?a.textAlign="start":"center"==e[0]||"middle"==e[0]?a.textAlign="center":"right"==e[0]&&(a.textAlign="right")),e[1]&&("top"==e[1]?a.textBaseline="start":"center"==e[1]||"middle"==e[0]?a.textBaseline="middle":"bottom"==e[1]&&(a.textBaseline="bottom"))}),a.beginPath(),this._evaluateOptions(n,a),this._hasProperty(n,"stroke",()=>{a.strokeText(e,t,i)}),this._hasProperty(n,"fill",()=>{a.fillText(e,t,i)}),this._hasProperty(n,"close",()=>{a.closePath()})}clear(e){(e||this.context).clearRect(0,0,this.canvas.width,this.canvas.height)}save(e){(e||this.context).save()}restore(e){(e||this.context).restore()}clip(e){(e||this.context).clip()}fill(e,t){let i=t||this.context;i.fillStyle=e,i.fill()}stroke(e,t){let i=t||this.context;i.strokeStyle=e,i.stroke()}_evaluateOptions(e,t){let i=t||this.context;if(e){for(var n=Object.keys(e),r=0;r<n.length;r++){var a=n[r];"stroke"==a&&(i.strokeStyle=e[a]),"fill"==a&&(i.fillStyle=e[a]),this._customOptions.includes(a)||(i[a]=e[a])}e.stroke&&this.stroke(e.stroke,i),e.fill&&this.fill(e.fill,i)}}_hasProperty(e,t,i){if(e)return!!e[t]&&("function"==typeof i&&i(e[t]),e[t])}}},function(e,t){function i(e,t,i){return i*(t-e)+e}class n{constructor(e,t){t=t||{},this.movement={x:0,y:0},this.viewport={left:0,right:0,top:0,bottom:0,width:0,height:0,scale:[1,1]},this.distance=0,this.context=e||null,this.fieldOfView=t.fieldOfView||Math.PI/4,this.moveSpeed=t.moveSpeed||1,this.zoomSpeed=t.zoomSpeed||1,this.scaleSpeed=t.scaleSpeed||1}setContext(e){this.context=e,this.updateViewport()}setMoveSpeed(e){this.moveSpeed=e}setZoomSpeed(e){this.zoomSpeed=e}setScaleSpeed(e){this.scaleSpeed=e}begin(e){"function"==typeof e&&(this.context.save(),this.applyScale(),this.applyTranslation(),e(this),this.context.restore())}applyScale(){this.context.scale(this.viewport.scale[0],this.viewport.scale[1])}applyTranslation(){this.context.translate(-this.viewport.left,-this.viewport.top)}updateViewport(){this.aspectRatio=this.context.canvas.width/this.context.canvas.height,this.viewport.width=i(this.viewport.width,this.distance*Math.tan(this.fieldOfView),this.scaleSpeed),this.viewport.height=i(this.viewport.height,this.viewport.width/this.aspectRatio,this.scaleSpeed),this.viewport.left=this.movement.x-this.viewport.width/2,this.viewport.top=this.movement.y-this.viewport.height/2,this.viewport.right=this.viewport.left+this.viewport.width,this.viewport.bottom=this.viewport.top+this.viewport.height,this.viewport.scale[0]=this.context.canvas.width/this.viewport.width,this.viewport.scale[1]=this.context.canvas.height/this.viewport.height}zoomTo(e){this.distance=i(this.distance,e,this.zoomSpeed),this.updateViewport()}moveTo(e,t){this.movement.x=i(this.movement.x,e,this.moveSpeed),this.movement.y=i(this.movement.y,t,this.moveSpeed),this.updateViewport()}screenToWorld(e,t,i){return i||{x:e/this.viewport.scale[0]+this.viewport.left,y:t/this.viewport.scale[1]+this.viewport.top}}worldToScreen(e,t,i){return i||{x:(e-this.viewport.left)*this.viewport.scale[0],y:(t-this.viewport.top)*this.viewport.scale[1]}}}e.exports={create:function(e,t){return new n(e,t)}}},function(e,t){class i{constructor(){this.frameRate=0,this.frameCount=0,this._targetFrameRate=60}run(t){let i,n=performance.now(),r=(performance.now(),this);!function e(){i=(performance.now()-n)/1e3,r.frameRate=1/i,n=performance.now(),r.frameCount++,"function"==typeof t&&t(),requestAnimationFrame(e)}()}}e.exports={create:function(){return new i}}},function(e,t){class n{constructor(e,t,i){this.position={x:e,y:t},this.size={x:1,y:1},this.bounds={},this.radius=i,this.angle=0,this.vertices=[],this.sides=Math.ceil(Math.max(10,Math.min(24,this.radius))),this.updateVertices()}updateVertices(e){var t=e||this.sides;this.vertices=[];for(var i=-Math.PI;i<Math.PI;i+=2*Math.PI/t){var n={x:this.position.x+Math.cos(i)*this.radius,y:this.position.y+Math.sin(i)*this.radius,angle:i};this.vertices.push(n)}this.updateBounds()}updateBounds(){let e=[],t=[];for(var i=0;i<this.vertices.length;i++){var n=this.vertices[i];e.push(n.x),t.push(n.y)}this.bounds={min:{x:Math.min(...e),y:Math.min(...t)},max:{x:Math.max(...e),y:Math.max(...t)}}}setRadius(e){if(e!=this.radius){this.radius=e;for(var t=0;t<this.vertices.length;t++){let e=this.vertices[t];e.x=this.position.x+Math.cos(e.angle+this.angle)*this.radius,e.y=this.position.y+Math.sin(e.angle+this.angle)*this.radius}this.updateBounds()}}scale(e,t){if(e!=this.size.x||t!=this.size.y){var n=e-this.size.x,r=t-this.size.y;this.size.x=e,this.size.y=t;for(var a=0;a<this.vertices.length;a++){let e=this.vertices[a],t=e.x-this.position.x,i=e.y-this.position.y;e.x=this.position.x+t*(1+n),e.y=this.position.y+i*(1+r)}this.updateBounds()}}translate(e,t){if(e!=this.position.x||t!=this.position.y){var i=e-this.position.x,n=t-this.position.y;this.position.x=e,this.position.y=t;for(var r=0;r<this.vertices.length;r++){let e=this.vertices[r];e.x+=i,e.y+=n}this.updateBounds()}}rotate(e){if(e!=this.angle){var n=e-this.angle;this.angle=e;for(var r=0;r<this.vertices.length;r++){let e=this.vertices[r],t=(e.x-this.position.x)*Math.cos(n)-(e.y-this.position.y)*Math.sin(n),i=(e.x-this.position.x)*Math.sin(n)+(e.y-this.position.y)*Math.cos(n);e.x=this.position.x+t,e.y=this.position.y+i}this.updateBounds()}}}class r{constructor(e,t,i,n){this.position={x:e,y:t},this.size={x:1,y:1},this.bounds={},this.angle=0,this.vertices=[],this.updateVertices(i,n)}updateVertices(e,t){this.vertices=[{x:this.position.x-.5*e,y:this.position.y-.5*t},{x:this.position.x+.5*e,y:this.position.y-.5*t},{x:this.position.x+.5*e,y:this.position.y+.5*t},{x:this.position.x-.5*e,y:this.position.y+.5*t}],this.updateBounds()}updateBounds(){let e=[],t=[];for(var i=0;i<this.vertices.length;i++){var n=this.vertices[i];e.push(n.x),t.push(n.y)}this.bounds={min:{x:Math.min(...e),y:Math.min(...t)},max:{x:Math.max(...e),y:Math.max(...t)}}}scale(e,t){if(e!=this.size.x||t!=this.size.y){var n=e-this.size.x,r=t-this.size.y;this.size.x=e,this.size.y=t;for(var a=0;a<this.vertices.length;a++){let e=this.vertices[a],t=e.x-this.position.x,i=e.y-this.position.y;e.x=this.position.x+t*(1+n),e.y=this.position.y+i*(1+r)}this.updateBounds()}}translate(e,t){if(e!=this.position.x||t!=this.position.y){var i=e-this.position.x,n=t-this.position.y;this.position.x=e,this.position.y=t;for(var r=0;r<this.vertices.length;r++){let e=this.vertices[r];e.x+=i,e.y+=n}this.updateBounds()}}rotate(e){if(e!=this.angle){var n=e-this.angle;this.angle=e;for(var r=0;r<this.vertices.length;r++){let e=this.vertices[r],t=(e.x-this.position.x)*Math.cos(n)-(e.y-this.position.y)*Math.sin(n),i=(e.x-this.position.x)*Math.sin(n)+(e.y-this.position.y)*Math.cos(n);e.x=this.position.x+t,e.y=this.position.y+i}this.updateBounds()}}}class a{constructor(e,t,i,n){this.position={x:e,y:t},this.size={x:1,y:1},this.bounds={},this.radius=i,this.angle=0,this.vertices=[],this.sides=n,this.updateVertices()}updateVertices(e){this.sides=e||this.sides,this.vertices=[];for(var t=-Math.PI;t<Math.PI;t+=2*Math.PI/this.sides){var i={x:this.position.x+Math.cos(t)*this.radius,y:this.position.y+Math.sin(t)*this.radius,angle:t};this.vertices.push(i)}this.updateBounds()}updateBounds(){let e=[],t=[];for(var i=0;i<this.vertices.length;i++){var n=this.vertices[i];e.push(n.x),t.push(n.y)}this.bounds={min:{x:Math.min(...e),y:Math.min(...t)},max:{x:Math.max(...e),y:Math.max(...t)}}}setRadius(e){if(e!=this.radius){this.radius=e;for(var t=0;t<this.vertices.length;t++){let e=this.vertices[t];e.x=this.position.x+Math.cos(e.angle+this.angle)*this.radius,e.y=this.position.y+Math.sin(e.angle+this.angle)*this.radius}this.updateBounds()}}scale(e,t){if(e!=this.size.x||t!=this.size.y){var n=e-this.size.x,r=t-this.size.y;this.size.x=e,this.size.y=t;for(var a=0;a<this.vertices.length;a++){let e=this.vertices[a],t=e.x-this.position.x,i=e.y-this.position.y;e.x=this.position.x+t*(1+n),e.y=this.position.y+i*(1+r)}this.updateBounds()}}translate(e,t){if(e!=this.position.x||t!=this.position.y){var i=e-this.position.x,n=t-this.position.y;this.position.x=e,this.position.y=t;for(var r=0;r<this.vertices.length;r++){let e=this.vertices[r];e.x+=i,e.y+=n}this.updateBounds()}}rotate(e){if(e!=this.angle){var n=e-this.angle;this.angle=e;for(var r=0;r<this.vertices.length;r++){let e=this.vertices[r],t=(e.x-this.position.x)*Math.cos(n)-(e.y-this.position.y)*Math.sin(n),i=(e.x-this.position.x)*Math.sin(n)+(e.y-this.position.y)*Math.cos(n);e.x=this.position.x+t,e.y=this.position.y+i}this.updateBounds()}}}e.exports={circle:function(e,t,i){return new n(e=e||0,t=t||0,i=i||0)},rect:function(e,t,i,n){return new r(e=e||0,t=t||0,i=i||0,n=n||0)},polygon:function(e,t,i,n){return new a(e=e||0,t=t||0,i=i||0,n=n||0)},SAT:function(e,t){const h=function(e){let t=[];for(var i=0;i<e.length;i++){var n=e[i],r=e[i+1==e.length?0:i+1],n={x:r.y-n.y,y:-(r.x-n.x)};t.push(n)}return t},c=function(e,t){let i=1/0,n=-1/0;for(var r=0;r<this.vertices.length;r++){var a=this.vertices[r],a=e.x*a.x+e.y*a.y;i=a<i?a:i,n=a>n?a:n}return{min:i,max:n}};return function(e,t){for(var i=h(e),n=h(t),r=0;r<i.length;r++){var a=i[r],s=c(a),a=c(a);if(!(a.max>=s.min&&s.max>=a.min))return!1}for(r=0;r<n.length;r++){var o=n[r],l=c(o),o=c(o);if(!(o.max>=l.min&&l.max>=o.min))return!1}return!0}(e.vertices,t.vertices)}}},function(e,t){const i=new class{constructor(){this.code=null,this.name=null,this.activeKeys={}}check(e){return"number"==typeof e?e in this.activeKeys:Object.values(this.activeKeys).includes(e)}on(e,t){"function"==typeof t&&addEventListener(e,t)}};i.on("keydown",function(e){i.code=e.keyCode,i.name=e.code,i.activeKeys[i.code]=i.name}),i.on("keyup",function(e){i.code=e.keyCode,i.name=e.code,delete i.activeKeys[i.code]}),e.exports=i},function(e,t,i){var n=i(4),r=i(14),a=i(15),s=i(16),i={timeline:n,contextMenuApp:r,fileApp:i(39),saveApp:i(17),loadApp:i(18),optionApp:i(40),overlayApp:a,overlayConfigApp:s,paneApp:i(41),cropApp:i(42),spritesheetExportApp:i(19),framesExportApp:i(20),GIFExportApp:i(21)};e.exports=i},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){const n=i(17),r=i(18),a=i(19),s=i(20),o=i(21),l=new Vue({el:"#fileApp",data:{showExportFormats:!1,hidden:!0,position:{x:0,y:0}},methods:{show:function(e,t){this.hidden=!1,this.$nextTick(()=>{var e=document.getElementById("fileButton").getBoundingClientRect();this.$el.style.left=e.x+"px",this.$el.style.top=e.y+e.height+3+"px"})},hide:function(){this.hidden=!0,this.showExportFormats=!1},showSaveApp:function(){n.show()},showLoadApp:function(){r.show()},showSpritesheetExportApp:function(){a.show()},showFrameExportApp:function(){s.show()},showGIFExportApp:function(){o.show()}}});e.exports=l},function(e,t,i){const n=i(0),r=i(15),a=i(16),s=new Vue({el:"#optionApp",data:{hidden:!0,overlayConfigHidden:!0,position:{x:0,y:0}},methods:{show:function(e,t){this.hidden=!1,this.$nextTick(()=>{var e=document.getElementById("optionButton").getBoundingClientRect();this.$el.style.left=e.x+"px",this.$el.style.top=e.y+e.height+3+"px"})},hide:function(){this.hidden=!0},showOverlayApp:function(){r.show()},showOverlayConfigApp:function(){a.show()},clearJoints:function(){confirm("Are you sure you want to reset everything?")&&(n.emit("clearJoints"),n.emit("resetTimeline"),n.emit("resetCamera"))},resetTimeline:function(){confirm("Are you sure you want to reset the timeline? (This action won't affect the keyframes)")&&n.emit("resetTimeline")},resetView:function(){n.emit("resetCamera")},undo:function(){n.emit("undo")},redo:function(){n.emit("redo")}}});e.exports=s},function(e,t,i){const r=i(0),n=(i(1),i(2)),a=i(3),s=["skinPositionX","skinPositionY","skinScaleX","skinScaleY","skinAngle"],o=new Vue({el:"#paneApp",data:{hideJoints:!1,hideProperties:!0,hideHistory:!0,showLength:!a.animation.linear},methods:{handleFocusOut:function(e){let t=e.target;t.value.length&&t.value||(t.value=0),t._lastValue!=t.value&&(s.includes(t.id)?r.emit("jointSkinningInputChange"):"jointZIndex"==t.id?r.emit("jointZIndexInputChange"):"jointName"==t.id&&r.emit("jointNameInputChange")),t._lastValue=t.value},handleInput:function(){r.emit("jointNameInputChange",!0)},validateFormat:function(e){e.target.value=e.target.value.replace(/[^0-9.-]/g,"").replace(/(\..*)\./g,"$1").replace(/^0+/g,"").replace(/(?<!^)-/g,""),"jointX"==e.target.id||"jointY"==e.target.id?r.emit("jointPositionInputChange"):"jointAngle"==e.target.id?r.emit("jointAngleInputChange"):"jointLength"==e.target.id?r.emit("jointLengthInputChange"):"jointZIndex"==e.target.id&&r.emit("jointZIndexInputChange"),s.includes(e.target.id)&&r.emit("jointSkinningInputChange",!0)},toggleAmount:function(n){if(n.target==document.activeElement){n.preventDefault(),n.target.value.length||(n.target.value=1);let e=n.wheelDeltaY<0,t=parseFloat(n.target.value),i=1;"skinScaleX"!=n.target.id&&"skinScaleY"!=n.target.id||(i=.1),e?t-=i:t+=i,n.target.value=t.toFixed(2),"jointX"==n.target.id||"jointY"==n.target.id?r.emit("jointPositionInputChange"):"jointAngle"==n.target.id?r.emit("jointAngleInputChange"):"jointLength"==n.target.id?r.emit("jointLengthInputChange"):"jointZIndex"==n.target.id&&(r.emit("jointZIndexInputChange",!0),n.target.value=parseInt(n.target.value)),s.includes(n.target.id)&&r.emit("jointSkinningInputChange",!0)}},showJoints:function(){this.hideJoints=!1,this.hideProperties=!0,this.hideHistory=!0,n.query("#jointsTab").addClass("active"),n.query("#propertiesTab").removeClass("active"),n.query("#historyTab").removeClass("active"),n.query("#jointApp").removeClass("hidden"),n.query("#propertyApp").addClass("hidden"),n.query("#historyApp").addClass("hidden")},showProperties:function(){this.hideProperties=!1,this.hideJoints=!0,this.hideHistory=!0,n.query("#jointsTab").removeClass("active"),n.query("#propertiesTab").addClass("active"),n.query("#historyTab").removeClass("active"),n.query("#jointApp").addClass("hidden"),n.query("#propertyApp").removeClass("hidden"),n.query("#historyApp").addClass("hidden")},showHistory:function(){this.hideHistory=!1,this.hideJoints=!0,this.hideProperties=!0,n.query("#jointsTab").removeClass("active"),n.query("#propertiesTab").removeClass("active"),n.query("#historyTab").addClass("active"),n.query("#jointApp").addClass("hidden"),n.query("#propertyApp").addClass("hidden"),n.query("#historyApp").removeClass("hidden")}}});e.exports=o},function(e,t,i){const n=i(0),r=i(2),a=i(1),s=i(3),o=new Vue({el:"#cropApp",data:{cropFrom:{x:0,y:0},cropTo:null,cropBoundsThickness:6,canvas:null,context:null,image:null,imageSize:null,hidden:!0},methods:{show:function(e){this.hidden=!1,this.$nextTick(()=>{this.$el.style.opacity="1",r.query("#cropApp .drag").draggable({restrict:!0,root:this.$el}),this.canvas=document.getElementById("cropCanvas"),this.context=this.canvas.getContext("2d"),this.image=e,this.imageSize=a.scaleSize(this.image.width,this.image.height,this.canvas.parentNode.offsetWidth,this.canvas.parentNode.offsetWidth),this.canvas.width=this.imageSize.width,this.canvas.height=this.imageSize.height,this.cropTo||(this.cropTo={x:this.imageSize.width,y:this.imageSize.height}),this.redraw()}),n.emit("renderSleep")},redraw:function(){if(this.canvas&&this.context&&this.image){let e=this.context;e.clearRect(0,0,this.canvas.width,this.canvas.height),e.drawImage(this.image,0,0,this.canvas.width,this.canvas.height),e.beginPath(),e.moveTo(this.cropFrom.x,this.cropFrom.y),e.lineTo(this.cropTo.x,this.cropFrom.y),e.lineTo(this.cropTo.x,this.cropTo.y),e.lineTo(this.cropFrom.x,this.cropTo.y),e.lineTo(this.cropFrom.x,this.cropFrom.y),e.lineTo(0,0),e.lineTo(0,this.canvas.height),e.lineTo(this.canvas.width,this.canvas.height),e.lineTo(this.canvas.width,0),e.lineTo(0,0),e.closePath(),e.fillStyle="rgba(0, 0, 0, 0.4)",e.fill(),e.save(),e.clip(),t=e,i=this.cropFrom.x-this.cropBoundsThickness/2,n=this.cropFrom.y-this.cropBoundsThickness/2,r=this.cropTo.x-this.cropFrom.x+this.cropBoundsThickness,a=this.cropTo.y-this.cropFrom.y+this.cropBoundsThickness,t.beginPath(),t.rect(i,n,r,a),t.closePath(),e.fillStyle=s.accent,e.fill(),e.restore()}var t,i,n,r,a},hide:function(){this.hidden=!0,this.canvas=null,this.context=null,n.emit("renderFocus")},getCrop:function(){return{from:{x:a.map(this.cropFrom.x,0,this.imageSize.width,0,this.image.width),y:a.map(this.cropFrom.y,0,this.imageSize.height,0,this.image.height)},to:{x:a.map(this.cropTo.x,0,this.imageSize.width,0,this.image.width),y:a.map(this.cropTo.y,0,this.imageSize.width,0,this.image.width)}}},save:function(){this.hide(),n.emit("crop",this.getCrop(),{from:this.cropFrom,to:this.cropTo})},reset:function(){this.cropFrom={x:0,y:0},this.cropTo={x:this.canvas.width,y:this.canvas.height},this.redraw()}}});function l(e,t){var i=e>=o.cropFrom.x-o.cropBoundsThickness&&e<=o.cropFrom.x+o.cropBoundsThickness&&t>=o.cropFrom.y-o.cropBoundsThickness&&t<=o.cropTo.y+o.cropBoundsThickness,n=e>=o.cropTo.x-o.cropBoundsThickness&&e<=o.cropTo.x+o.cropBoundsThickness&&t>=o.cropFrom.y-o.cropBoundsThickness&&t<=o.cropTo.y+o.cropBoundsThickness;return{top:t>=o.cropFrom.y-o.cropBoundsThickness&&t<=o.cropFrom.y+o.cropBoundsThickness&&e>=o.cropFrom.x-o.cropBoundsThickness&&e<=o.cropTo.x+o.cropBoundsThickness,right:n,bottom:t>=o.cropTo.y-o.cropBoundsThickness&&t<=o.cropTo.y+o.cropBoundsThickness&&e>=o.cropFrom.x-o.cropBoundsThickness&&e<=o.cropTo.x+o.cropBoundsThickness,left:i}}let h,c,d,u,p=r.query("body"),f=!1;addEventListener("mousedown",function(e){var t,i;o.canvas&&o.context&&(i=e.clientX,t=e.clientY,i=i-(e=o.canvas.getBoundingClientRect()).x,e=t-e.y,f=!0,h=l(i,e),c={x:i-o.cropFrom.x,y:e-o.cropFrom.y},d=o.cropTo.x-o.cropFrom.x,u=o.cropTo.y-o.cropFrom.y)}),addEventListener("mouseup",function(){f=!1}),addEventListener("mousemove",function(e){var t,i=e.clientX,n=e.clientY;o.canvas&&o.context&&(n=l(e=i-(t=o.canvas.getBoundingClientRect()).x,i=n-t.y),t=e>=o.cropFrom.x+o.cropBoundsThickness/2&&e<=o.cropTo.x-o.cropBoundsThickness/2&&i>=o.cropFrom.y+o.cropBoundsThickness/2&&i<=o.cropTo.y-o.cropBoundsThickness/2,f?(h.top&&(o.cropFrom.y=i,o.redraw()),h.left&&(o.cropFrom.x=e,o.redraw()),h.bottom&&(o.cropTo.y=i,o.redraw()),h.right&&(o.cropTo.x=e,o.redraw()),h.top||h.bottom||h.left||h.right||!t||(o.cropFrom.x=e-c.x,o.cropFrom.y=i-c.y,o.cropTo.x=o.cropFrom.x+d,o.cropTo.y=o.cropFrom.y+u,o.redraw()),o.cropFrom.y=a.clamp(o.cropFrom.y,0,o.cropTo.y),o.cropFrom.x=a.clamp(o.cropFrom.x,0,o.cropTo.x),o.cropTo.y=a.clamp(o.cropTo.y,o.cropFrom.y,o.canvas.height),o.cropTo.x=a.clamp(o.cropTo.x,o.cropFrom.x,o.canvas.width)):((n.left||n.right)&&p.css("cursor","ew-resize"),(n.top||n.bottom)&&p.css("cursor","ns-resize"),n.top&&n.left&&p.css("cursor","nw-resize"),n.top&&n.right&&p.css("cursor","ne-resize"),n.bottom&&n.left&&p.css("cursor","sw-resize"),n.bottom&&n.right&&p.css("cursor","se-resize"),n.top||n.bottom||n.left||n.right||p.css("cursor","unset"),t&&p.css("cursor","move")))}),e.exports=o},function(e,t,i){const d=i(0);let u;e.exports=function(e,o){if(!(o=o||{}).drop){const l=document.createElement("canvas"),h=l.getContext("2d"),c=document.createElement("video");c.crossOrigin="anonymous",c.controls=!0,c.muted=!0,c.src=e,c.load();let r=[],i=o.start||1,n=o.frameRate||24,a=o.quality||.1;c.addEventListener("loadedmetadata",()=>{let e=o.end||c.duration,t=o.frameCount||(e-i)*n;l.width=c.videoWidth,l.height=c.videoHeight,c.currentTime=i,c.addEventListener("seeked",()=>{!o.drop&&r.length<t?(d.emit("extractKeyframeProgress",t),c.currentTime+=1/n):d.emit("extractKeyframeDone",r)})});let s=d.on("extractKeyframeProgress",e=>{h.drawImage(c,0,0);let t=l.toDataURL("image/jpeg",a),i=new Image;i.crossOrigin="anonymous",i.src=t;var n={image:i,time:c.currentTime};r.push(n),h.clearRect(0,0,l.width,l.height),"function"==typeof o.progress&&(u=r.length/e*100,o.progress(n.image,u))});d.once("extractKeyframeDone",e=>{e.sort((e,t)=>e.time-t.time);for(var t=0;t<e.length;t++)e[t]=e[t].image;o.done(e),d.removeListener(s),l.remove()})}}}]);