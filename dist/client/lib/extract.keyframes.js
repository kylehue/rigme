"use strict";var pct,events=require("../../../lib/events.js"),HAVE_ENOUGH_DATA=4;function extractFrames(e,n){var a,o,i,s,r,c,m,d;(n=n||{}).drop||(a=document.createElement("canvas"),o=a.getContext("2d"),(i=document.createElement("video")).crossOrigin="anonymous",i.controls=!0,i.muted=!0,i.src=e,i.load(),s=[],r=n.start||1,c=n.frameRate||24,m=n.quality||.1,i.addEventListener("loadedmetadata",function(){var e=n.end||i.duration,t=n.frameCount||(e-r)*c;a.width=i.videoWidth,a.height=i.videoHeight,i.currentTime=r,i.addEventListener("seeked",function(){!n.drop&&s.length<t?(events.emit("extractKeyframeProgress",t),i.currentTime+=1/c):events.emit("extractKeyframeDone",s)})}),d=events.on("extractKeyframeProgress",function(e){o.drawImage(i,0,0);var t=a.toDataURL("image/jpeg",m),r=new Image;r.crossOrigin="anonymous",r.src=t;r={image:r,time:i.currentTime};s.push(r),o.clearRect(0,0,a.width,a.height),"function"==typeof n.progress&&(pct=s.length/e*100,n.progress(r.image,pct))}),events.once("extractKeyframeDone",function(e){e.sort(function(e,t){return e.time-t.time});for(var t=0;t<e.length;t++)e[t]=e[t].image;n.done(e),events.removeListener(d),a.remove()}))}module.exports=extractFrames;